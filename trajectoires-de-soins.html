<!DOCTYPE html>

<html lang="fr" xml:lang="fr">

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Trajectoires de soins : un exemple de données longitudinales</title>

<script src="libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/paper.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="libs/navigation-1.1/tabsets.js"></script>
<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>
<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<script src="libs/d3-3.3.8/d3.min.js"></script>
<script src="libs/dagre-0.4.0/dagre-d3.min.js"></script>
<link href="libs/mermaid-0.3.0/dist/mermaid.css" rel="stylesheet" />
<script src="libs/mermaid-0.3.0/dist/mermaid.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/chromatography-0.1/chromatography.js"></script>
<script src="libs/DiagrammeR-binding-1.0.5/DiagrammeR.js"></script>
<meta name="robots" content="index, follow">
<link rel="stylesheet" href="./include/analyse-R.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js"></script>
<script type="text/javascript" src="./libs/bigfoot-2.1.4/bigfoot.min.js"></script>
<link rel="stylesheet" href="./libs/bigfoot-2.1.4/bigfoot-number.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<link rel="stylesheet" href="./libs/colorbox-1.6.1/colorbox.css" />
<script type="text/javascript" src="./libs/colorbox-1.6.1/jquery.colorbox-min.js"></script>
<!--- favicon --->
<link rel="apple-touch-icon" sizes="57x57" href="./images/favicon/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="./images/favicon/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="./images/favicon/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="./images/favicon/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="./images/favicon/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="./images/favicon/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="./images/favicon/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="./images/favicon/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="./images/favicon/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="./images/favicon/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="./images/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="./images/favicon/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="./images/favicon/favicon-16x16.png">
<link rel="manifest" href="./images/favicon/manifest.json">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="./images/favicon/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-121727005-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-121727005-1');
</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">



<nav>
<div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href=".">analyse-R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
          <a href="manipuler" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Manipuler <span class="caret"></span></a>
          <ul class="dropdown-menu multi-column columns-3" role="menu" id="menu_manipuler">
            <div class="row">
              <div class="col-sm-4">
  	            <ul class="multi-column-dropdown">
  		            <li class="dropdown-header">Prise en main</li>
                  <li><a href="presentation-et-philosophie.html">Présentation et Philosophie</a></li>
                  <li><a href="installation-de-R-et-RStudio.html">Installation de <strong>R</strong> et <strong>RStudio</strong></a></li>
                  <li><a href="premier-contact.html">Premier contact</a></li>
                  <li><a href="premier-travail-avec-les-donnees.html">Premier travail avec des données</a></li>
                  <li><a href="extensions.html">Extensions (installation, mise à jour)</a></li>
                  <li><a href="introduction-au-tidyverse.html">Introduction au <strong>tidyverse</strong></a></li>
                  <li><a href="vecteurs-indexation-et-assignation.html">Vecteurs, indexation et assignation</a></li>
                  <li><a href="listes-et-tableaux-de-donnes.html">Listes et Tableaux de données</a></li>
                  <li><a href="facteurs-et-vecteurs-labellises.html">Facteurs et vecteurs labellisés</a></li>
                  <li><a href="organiser-ses-fichiers.html">Organiser ses fichiers</a></li>
                  <li><a href="import-de-donnees.html">Import de données</a></li>
                  <li><a href="ou-trouver-de-l-aide.html">Où trouver de l'aide ?</a></li>
  	            </ul>
              </div>
              <div class="col-sm-4">
  	            <ul class="multi-column-dropdown">
  		            <li class="dropdown-header">Manipulation de données</li>
  		            <li><a href="visualiser-ses-donnees.html">Visualiser ses données</a></li>
  		            <li><a href="recodage.html">Recodage de variables</a></li>
                  <li><a href="manipuler-les-donnees-avec-dplyr.html">Manipuler les données avec <strong>dplyr</strong></a></li>
                  <li><a href="manipulations-avancees-avec-data-table.html">Manipulations avancées avec <strong>data.table</strong></a></li>
                  <li><a href="tris.html">Tris</a></li>
                  <li><a href="sous-ensembles.html">Sous-ensembles</a></li>
                  <li><a href="fusion-de-tables.html">Fusion de tables</a></li>
                  <li><a href="gestion-des-dates.html">Gestion des dates</a></li>
                  <li><a href="fonctions-a-fenetre.html">Fonctions à fenêtre</a></li>
                  <li><a href="manipuler-du-texte.html">Manipuler du texte avec <strong>stringr</strong></a></li>
                  <li><a href="reorganiser-ses-donnees-avec-tidyr.html">Réorganiser ses données avec <strong>tidyr</strong></a></li>
                  <li><a href="scraping.html">Scraping</a></li>
  	            </ul>
              </div>
              <div class="col-sm-4">
  	            <ul class="multi-column-dropdown">
                  <li class="dropdown-header">Exporter</li>
                  <li><a href="export-de-donnees.html">Export de données</a></li>
                  <li><a href="export-de-graphiques.html">Export de graphiques</a></li>
  	            </ul>
              </div>
            </div>
          </ul>
        </li>
        <li class="dropdown">
          <a href="analyser" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Analyser <span class="caret"></span></a>
          <ul class="dropdown-menu multi-column columns-3" role="menu" id="menu_analyser">
            <div class="row">
              <div class="col-sm-4">
  	            <ul class="multi-column-dropdown">
  		            <li class="dropdown-header">Statistiques introductives</li>
                  <li><a href="statistique-univariee.html">Statistique univariée</a></li>
                  <li><a href="statistique-bivariee.html">Statistique bivariée</a></li>
                  <li><a href="intro-ggplot2.html">Introduction à <strong>ggplot2</strong>, la grammaire des graphiques</a></li>
                  <li><a href="graphiques-bivaries-ggplot2.html">Graphiques univariés et bivariés avec <strong>ggplot2</strong></a></li>
                  <li><a href="donnees-ponderees.html">Données pondérées</a></li>
  	            </ul>
              </div>
              <div class="col-sm-4">
  	            <ul class="multi-column-dropdown">
  		            <li class="dropdown-header">Statistiques intermédiaires</li>
  		            <li><a href="intervalles-de-confiance.html">Intervalles de confiance</a></li>
                  <li><a href="comparaisons-moyennes-et-proportions.html">Comparaisons (moyennes et proportions)</a></li>
                  <li><a href="definir-un-plan-d-echantillonnage-complexe.html">Définir un plan d'échantillonnage complexe</a></li>
                  <li><a href="regression-lineaire.html">Régression linéaire</a></li>
                  <li><a href="regression-logistique.html">Régression logistique binaire, multinomiale et ordinale</a></li>
                  <li><a href="analyse-des-correspondances-multiples.html">Analyse des correspondances multiples (ACM)</a></li>
                  <li><a href="classification-ascendante-hierarchique.html">Classification ascendante hiérarchique (CAH)</a></li>
  	            </ul>
              </div>
              <div class="col-sm-4">
  	            <ul class="multi-column-dropdown">
                  <li class="dropdown-header">Statistiques avancées</li>
                  <li><a href="effets-d-interaction.html">Effets d'interaction dans un modèle</a></li>
                  <li><a href="multicolinearite.html">Multicolinéarité dans la régression</a></li>
                  <li><a href="analyse-de-survie.html">Analyse de survie</a></li>
                  <li><a href="analyse-de-sequences.html">Analyse de séquences</a></li>
                  <!--<li><a href="modeles-a-effets-aleatoires.html">Modèles à effets aléatoires (modèles mixtes et GEE)</a></li>-->
                  <li><a href="trajectoires-de-soins.html">Trajectoires de soins&nbsp;: un exemple de données longitudinales</a></li>
                  <li><a href="analyse-de-reseaux.html">Analyse de réseaux</a></li>
                  <li><a href="analyse-spatiale.html">Analyse spatiale</a></li>
  	            </ul>
              </div>
            </div>
          </ul>
        </li>
        <li class="dropdown">
          <a href="approfondir" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Approfondir <span class="caret"></span></a>
          <ul class="dropdown-menu multi-column columns-3" role="menu" id="menu_approfondir">
            <div class="row">
              <div class="col-sm-4">
  	            <ul class="multi-column-dropdown">
  		            <li class="dropdown-header">Graphiques</li>
                  <li><a href="ggplot2.html"><strong>ggplot2</strong> et la grammaire des graphiques</a></li>
                  <li><a href="etendre-ggplot2.html">Étendre <strong>ggplot2</strong></a></li>
                  <li><a href="combiner-plusieurs-graphiques.html">Combiner plusieurs graphiques</a></li>
                  <li><a href="graphiques-interactifs.html">Graphiques interactifs</a></li>
                  <li><a href="lattice-graphiques-et-formules.html"><strong>lattice</strong> : graphiques et formules</a></li>
                  <li><a href="cartes.html">Cartes</a></li>
                  <li><a href="autres-extensions-graphiques.html">Autres extensions graphiques</a></li>
  	            </ul>
              </div>
              <div class="col-sm-4">
  	            <ul class="multi-column-dropdown">
  		            <li class="dropdown-header">Programmation</li>
  		            <li><a href="conditions-et-comparaisons.html">Conditions et comparaisons</a></li>
                  <li><a href="formules.html">Formules</a></li>
                  <li><a href="structures-conditionnelles.html">Structures conditionnelles</a></li>
                  <li><a href="vectorisation.html">Vectorisation</a></li>
                  <li><a href="expressions-regulieres.html">Expressions régulières</a></li>
                  <!--<li class="dev"><a href="ecrire-ses-propres-fonctions.html">Écrire ses propres fonctions</a></li>-->
                  <li><a href="rmarkdown-les-rapports-automatises.html"><strong>R Markdown</strong> : les rapports automatisés</a></li>
  	            </ul>
              </div>
              <div class="col-sm-4">
  	            <ul class="multi-column-dropdown">
                  <li class="dropdown-header">Divers</li>
                  <li><a href="formater-nombres.html">Mettre en forme des nombres</a></li>
                  <li><a href="couleurs.html">Couleurs et Palettes</a></li>
                  <li><a href="annotations-mathematiques.html">Annotations mathématiques</a></li>
                  <li><a href="calculer-un-age.html">Calculer un âge</a></li>
                  <li><a href="diagramme-de-lexis.html">Diagramme de Lexis</a></li>
  	            </ul>
              </div>
            </div>
          </ul>
        </li>
        <li class="dropdown">
          <a href="index" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Index <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu" id="menu_naviguer">
            <li><a href="index-des-concepts.html">Index des concepts</a></li>
            <li><a href="index-des-fonctions.html">Index des fonctions</a></li>
            <li><a href="index-des-extensions.html">Index des extensions</a></li>
          </ul>
        </li>
        <li><a href="analyse-R.pdf">PDF</a></li>
        <!--<li><a href="https://github.com/larmarange/analyse-R">GitHub</a></li>-->
      </ul>
    <form id="rechercher" class="navbar-form navbar-right" role="search" style="padding-top: 5px;" method="get" action="https://duckduckgo.com/">
      <div class="form-group">
        <input name="q" type="text" class="form-control input-sm" placeholder="Rechercher">
      </div>
      <button type="submit" class="btn btn-default btn-sm" name="Rechercher">
        <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
      </button>
    </form>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->
</nav>

<div class="row">

<div class="visible-lg">
<a href="https://github.com/larmarange/analyse-R"><img style="position: absolute; top: 60px; left: 40px; border: 0;" src="images/fork_me.png" alt="Contribuer sur GitHub"></a>
</div>

<div class="col-sm-9" role="main">
<article>

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Trajectoires de soins : un exemple de données longitudinales</h1>

</div>

<div id="TOC">
<ul>
<li><a href="#première-description-des-données">Première description des données</a></li>
<li><a href="#évolution-de-la-cascade-de-soins-au-cours-du-temps">Évolution de la cascade de soins au cours du temps</a></li>
<li><a href="#analyse-de-survie-classique">Analyse de survie classique</a></li>
<li><a href="#une-première-analyse-de-séquences-sur-lensemble-du-fichier">Une première analyse de séquences sur l’ensemble du fichier</a></li>
<li><a href="#une-seconde-analyse-de-séquences-limitées-aux-18-premiers-mois">Une seconde analyse de séquences limitées aux 18 premiers mois</a></li>
<li><a href="#facteurs-associés-à-lappartenance-à-chaque-groupe">Facteurs associés à l’appartenance à chaque groupe</a></li>
<li><a href="#modèle-mixte-à-classes-latentes">Modèle mixte à classes latentes</a></li>
<li><a href="#modèle-à-observations-répétées">Modèle à observations répétées</a></li>
<li><a href="#modèle-de-survie-multi-états">Modèle de survie multi-états</a></li>
</ul>
</div>

<style>
.section{opacity: 1 !important;} /* contrer mermaid */
</style>
<p>Dans ce chapitre, nous allons aborder plusieurs méthodes d’analyse à partir d’un jeu de données longitudinales. Tout d’abord, importons les données dans <strong>R</strong> avec la commande suivante :</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">load</span>(<span class="kw">url</span>(<span class="st">&quot;http://larmarange.github.io/analyse-R/data/care_trajectories.RData&quot;</span>))</a></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">class</span>(care_trajectories)</a></code></pre></div>
<pre><code>[1] &quot;data.table&quot; &quot;data.frame&quot;</code></pre>
<p>Nous obtenons un objet appelé <code>care_trajectories</code>. La fonction <code data-pkg="base">class</code> nous montre qu’il s’agit d’un tableau de données au format <code class="pkg">data.table</code> (voir le <a href="manipulations-avancees-avec-data-table.html">chapitre dédié</a>). Chargeons donc cette extension ainsi que le <code class="pkg">tidyverse</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">library</span>(tidyverse, <span class="dt">quietly =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw">library</span>(data.table, <span class="dt">quietly =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div id="première-description-des-données" class="section level2">
<h2>Première description des données</h2>
<p>Jetons un premier regard aux données.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">head</span>(care_trajectories)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">id</th>
<th align="right">month</th>
<th align="left">care_status</th>
<th align="right">sex</th>
<th align="right">age</th>
<th align="right">education</th>
<th align="right">wealth</th>
<th align="right">distance_clinic</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">3</td>
<td align="right">0</td>
<td align="left">D</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">1</td>
<td align="left">D</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">2</td>
<td align="left">D</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">3</td>
<td align="left">D</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">4</td>
<td align="left">D</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">5</td>
<td align="left">D</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>Il apparaît que les données sont dans un format <q>long</q> et <em>tidy</em> (voir le <a href="reorganiser-ses-donnees-avec-tidyr.html#tidy-data">chapitre sur <strong>tidyr</strong></a> pour une présentation du concept de <dfn lang="en">tidy data</dfn>), avec une ligne par individu et par pas de temps. Il apparait également que les données sont stockées sous formes de vecteurs labellisés (voir le <a href="facteurs-et-vecteurs-labellises.html#labelled">chapitre dédié aux vecteurs labellisés</a>). Nous aurons donc besoin de l’extension <code class="pkg">labelled</code>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">library</span>(labelled)</a></code></pre></div>
<p>Pour une description des variables, on pourra avoir recours à <code data-pkg="questionr">describe</code> de <code>questionr</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">library</span>(questionr)</a>
<a class="sourceLine" id="cb7-2" title="2"><span class="kw">describe</span>(care_trajectories, <span class="dt">freq.n.max =</span> <span class="dv">10</span>)</a></code></pre></div>
<pre><code>care_trajectories 

 8  Variables      49365  Observations
------------------------------------------------------------
id : patient identifier 
       n  missing distinct     Info     Mean      Gmd 
   49365        0     2929        1     5022     3356 
     .05      .10      .25      .50      .75      .90 
     526     1042     2481     4961     7532     9050 
     .95 
    9557 

lowest :    3    9   13   15   18, highest: 9986 9988 9989 9996 9998
------------------------------------------------------------
month : month(s) since diagnosis 
       n  missing distinct     Info     Mean      Gmd 
   49365        0       51    0.998    11.19    10.01 
     .05      .10      .25      .50      .75      .90 
       0        1        4        9       16       25 
     .95 
      30 

lowest :  0  1  2  3  4, highest: 46 47 48 49 50
------------------------------------------------------------
care_status : care status 
       n  missing distinct 
   49365        0        4 
                                  
Value          C     D     S     T
Frequency   5886 25374 13509  4596
Proportion 0.119 0.514 0.274 0.093
------------------------------------------------------------
sex 
       n  missing distinct     Info      Sum     Mean 
   49365        0        2    0.691    31584   0.6398 
     Gmd 
  0.4609 

------------------------------------------------------------
age : age group 
       n  missing distinct     Info     Mean      Gmd 
   49365        0        3    0.749     1.72   0.5678 
                            
Value          1     2     3
Frequency  16911 29365  3089
Proportion 0.343 0.595 0.063
------------------------------------------------------------
education : education level 
       n  missing distinct     Info     Mean      Gmd 
   49365        0        3    0.868    2.193   0.8144 
                            
Value          1     2     3
Frequency  10417 19024 19924
Proportion 0.211 0.385 0.404
------------------------------------------------------------
wealth : wealth group (assets score) 
       n  missing distinct     Info     Mean      Gmd 
   49365        0        3    0.876    1.954   0.8209 
                            
Value          1     2     3
Frequency  15432 20769 13164
Proportion 0.313 0.421 0.267
------------------------------------------------------------
distance_clinic : distance to nearest clinic 
       n  missing distinct     Info     Mean      Gmd 
   49365        0        2    0.744    1.457   0.4963 
                      
Value          1     2
Frequency  26804 22561
Proportion 0.543 0.457
------------------------------------------------------------</code></pre>
<p>Dans cette étude, on a suivi des patients à partir du moment où ils ont été diagnostiqués pour une pathologie grave et chronique et on a suivi leurs parcours de soins chaque mois à partir du diagnostic. La variable <code>status</code> contient le statut dans les soins de chaque individu pour chaque mois de suivi :</p>
<ul>
<li><strong>D</strong> : s’il n’est pas actuellement suivi dans une clinique, soit que la personne n’est pas encore entrée en clinique après le diagnostic, soit qu’elle a quitté la clinique et qu’elle est donc sortie des soins ;</li>
<li><strong>C</strong> : indique que le patient est entré en soins (il est suivi dans une clinique) mais il n’a pas encore commencé le traitement, ou bien il a arrêté le traitement mais est toujours suivi en clinique ;</li>
<li><strong>T</strong> : la personne est sous traitement mais l’infections n’est pas <q>supprimée</q> ou <q>contrôlée</q>, soit que le traitement n’a pas encore eu le temps de faire effet, soit qu’il n’est plus efficace ;</li>
<li><strong>S</strong> : la personne est suivie en clinique, sous traitement et son infection est <q>supprimée</q> / <q>contrôlée</q>, indiquant que le traitement est efficace et produit son effet. Cette étape ultime du parcours de soins est celle dans laquelle on souhaite maintenir les individus le plus longtemps possible.</li>
</ul>
<p>Il est important de noter que nous avons ici des statuts <strong>hiérarchiquement ordonnés</strong> (D &lt; C &lt; T &lt; S), ce qui aura son importance pour les choix méthodologiques que nous aurons à faire.</p>
<p>Nous disposons également d’autres variables (âge, sexe, niveau d’éducation…) qui sont ici dépendantes du temps, c’est-à-dire que le cas échéant, elles peuvent varier d’un mois à l’autre en cas de changement.</p>
<p>Avant de démarrer les analyses, françisons certaines de ces variables.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="kw">var_label</span>(care_trajectories<span class="op">$</span>sex) &lt;-<span class="st"> &quot;Sexe&quot;</span></a>
<a class="sourceLine" id="cb9-2" title="2"><span class="kw">val_labels</span>(care_trajectories<span class="op">$</span>sex) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">homme =</span> <span class="dv">0</span>, <span class="dt">femme =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb9-3" title="3"><span class="kw">var_label</span>(care_trajectories<span class="op">$</span>age) &lt;-<span class="st"> &quot;Âge&quot;</span></a>
<a class="sourceLine" id="cb9-4" title="4"><span class="kw">var_label</span>(care_trajectories<span class="op">$</span>education) &lt;-<span class="st"> &quot;Education&quot;</span></a>
<a class="sourceLine" id="cb9-5" title="5"><span class="kw">val_labels</span>(care_trajectories<span class="op">$</span>education) &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb9-6" title="6">  <span class="dt">primaire =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb9-7" title="7">  <span class="dt">secondaire =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb9-8" title="8">  supé<span class="dt">rieur =</span> <span class="dv">3</span></a>
<a class="sourceLine" id="cb9-9" title="9">)</a></code></pre></div>
<p>Le fichier contient 49 365 lignes, ce qui ne veut pas dire qu’il y a ce nombre d’invidus suivis au cours du temps, puisque plusieurs lignes correspondent à un même individu. On peut obtenir le nombre d’individus différents assez facilement avec la commande :</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="kw">length</span>(<span class="kw">unique</span>(care_trajectories<span class="op">$</span>id))</a></code></pre></div>
<pre><code>[1] 2929</code></pre>
<p><strong>Précision :</strong> dans ce fichier, tous les individus ne sont pas suivis pendant la même durée, car ils n’ont pas tous été diagnostiqués au même moment. Cependant, il n’y a pas de <q>trous</q> dans le suivi (ce qui serait le cas si certains individus sortaient de l’observation pendant quelques mois puis re-rentraient dans la cohorte de suivi).</p>
<p>Avant d’aller plus avant, il nous faut avoir une idée du nombre d’individus observé au cours du temps, ce que l’on peut obtenir avec :</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">ggplot</span>(care_trajectories) <span class="op">+</span></a>
<a class="sourceLine" id="cb12-2" title="2"><span class="st">  </span><span class="kw">aes</span>(<span class="dt">x =</span> month) <span class="op">+</span></a>
<a class="sourceLine" id="cb12-3" title="3"><span class="st">  </span><span class="kw">geom_bar</span>()</a></code></pre></div>
<p><img src="graphs/trajectoires-de-soins/unnamed-chunk-10-1.png" width="1050" /></p>
<p>Améliorons ce graphique en y ajoutant la distribution selon le statut dans les soins chaque mois, en améliorant l’axe du temps (tous les 6 mois est plus facile à lire) et en y ajoutant un titre et des étiquettes appropriées. Afin de disposer d’une palette de couleurs à fort contraste, nous allons utiliser l’extension <code class="pkg">viridis</code>. Enfin, nous allons utiliser une petite astuce pour indiquer les effectifs sur l’axe horizontal. Au passage, nous allons également franciser les étiquettes de la variable <code>care_status</code> avec <code data-pkg="labelled">val_labels</code> (notez aussi le recours à <code data-pkg="labelled">to_factor</code> dans <code data-pkg="ggplot2">aes</code> qui nous permet de transformer à la volée la variable en facteur, format attendu par <code class="pkg">ggplot2</code> pour les variables catégorielles). On se référera au <a href="ggplot2.html">chapitre dédié à <strong>ggplot2</strong></a> pour plus de détails sur les différentes fonctions de cette extension graphique.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="kw">library</span>(viridis)</a>
<a class="sourceLine" id="cb13-2" title="2">n &lt;-<span class="st"> </span>care_trajectories[month <span class="op">%in%</span><span class="st"> </span>(<span class="dv">0</span><span class="op">:</span><span class="dv">8</span><span class="op">*</span><span class="dv">6</span>), .(<span class="dt">n =</span> .N), by =<span class="st"> </span>month]<span class="op">$</span>n</a>
<a class="sourceLine" id="cb13-3" title="3">etiquettes &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;M&quot;</span>, <span class="dv">0</span><span class="op">:</span><span class="dv">8</span><span class="op">*</span><span class="dv">6</span>, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">(n=&quot;</span>, n, <span class="st">&quot;)&quot;</span>)</a>
<a class="sourceLine" id="cb13-4" title="4"><span class="kw">val_labels</span>(care_trajectories<span class="op">$</span>care_status) &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb13-5" title="5">  <span class="st">&quot;diagnostiqué, mais pas suivi&quot;</span> =<span class="st"> &quot;D&quot;</span>,</a>
<a class="sourceLine" id="cb13-6" title="6">  <span class="st">&quot;suivi, mais pas sous traitement&quot;</span> =<span class="st"> &quot;C&quot;</span>,</a>
<a class="sourceLine" id="cb13-7" title="7">  <span class="st">&quot;sous traitement, mais infection non contrôlée&quot;</span> =<span class="st"> &quot;T&quot;</span>,</a>
<a class="sourceLine" id="cb13-8" title="8">  <span class="st">&quot;sous traitement et infection contrôlée&quot;</span> =<span class="st"> &quot;S&quot;</span></a>
<a class="sourceLine" id="cb13-9" title="9">)</a>
<a class="sourceLine" id="cb13-10" title="10"><span class="kw">ggplot</span>(care_trajectories) <span class="op">+</span></a>
<a class="sourceLine" id="cb13-11" title="11"><span class="st">  </span><span class="kw">aes</span>(<span class="dt">x =</span> month, <span class="dt">fill =</span> <span class="kw">to_factor</span>(care_status)) <span class="op">+</span></a>
<a class="sourceLine" id="cb13-12" title="12"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">color =</span> <span class="st">&quot;gray50&quot;</span>, <span class="dt">width =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb13-13" title="13"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">8</span><span class="op">*</span><span class="dv">6</span>, <span class="dt">labels =</span> etiquettes) <span class="op">+</span></a>
<a class="sourceLine" id="cb13-14" title="14"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Distribution du statut dans les soins chaque mois&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb13-15" title="15"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb13-16" title="16"><span class="st">  </span><span class="kw">theme_light</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb13-17" title="17"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb13-18" title="18"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">fill =</span> <span class="st">&quot;Statut dans les soins&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-19" title="19"><span class="st">  </span><span class="kw">scale_fill_viridis</span>(<span class="dt">discrete =</span> <span class="ot">TRUE</span>, <span class="dt">direction =</span> <span class="dv">-1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb13-20" title="20"><span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="kw">guide_legend</span>(<span class="dt">nrow =</span> <span class="dv">2</span>))</a></code></pre></div>
<p><img src="graphs/trajectoires-de-soins/unnamed-chunk-11-1.png" width="1050" /></p>
<p>On s’aperçoit qu’une majorité des personnes suivies ne l’ont été que peu de temps, avec une décroissance rapide des effectifs.</p>
</div>
<div id="évolution-de-la-cascade-de-soins-au-cours-du-temps" class="section level2">
<h2>Évolution de la cascade de soins au cours du temps</h2>
<p>On nomme communément <q>cascade de soins</q> la proportion d’individus dans chaque statut à un moment du temps donné. On peut facilement obtenir celle-ci à partir du code du graphique précédent en ajoutant l’option <code>position = fill</code> à <code data-pkg="ggplot2">geom_bar</code>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1"><span class="kw">ggplot</span>(care_trajectories) <span class="op">+</span></a>
<a class="sourceLine" id="cb14-2" title="2"><span class="st">  </span><span class="kw">aes</span>(<span class="dt">x =</span> month, <span class="dt">fill =</span> <span class="kw">to_factor</span>(care_status)) <span class="op">+</span></a>
<a class="sourceLine" id="cb14-3" title="3"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">color =</span> <span class="st">&quot;gray50&quot;</span>, <span class="dt">width =</span> <span class="dv">1</span>, <span class="dt">position =</span> <span class="st">&quot;fill&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb14-4" title="4"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">8</span><span class="op">*</span><span class="dv">6</span>, <span class="dt">labels =</span> etiquettes) <span class="op">+</span></a>
<a class="sourceLine" id="cb14-5" title="5"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>percent) <span class="op">+</span></a>
<a class="sourceLine" id="cb14-6" title="6"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Cascade des soins observée, selon le temps depuis le diagnostic&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb14-7" title="7"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb14-8" title="8"><span class="st">  </span><span class="kw">theme_light</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb14-9" title="9"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb14-10" title="10"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">fill =</span> <span class="st">&quot;Statut dans les soins&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb14-11" title="11"><span class="st">  </span><span class="kw">scale_fill_viridis</span>(<span class="dt">discrete =</span> <span class="ot">TRUE</span>, <span class="dt">direction =</span> <span class="dv">-1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb14-12" title="12"><span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="kw">guide_legend</span>(<span class="dt">nrow =</span> <span class="dv">2</span>))</a></code></pre></div>
<p><img src="graphs/trajectoires-de-soins/unnamed-chunk-12-1.png" width="1050" /></p>
<p>Les effectifs sont très faibles au-delà de 36 mois et il serait préférable de couper la cascade au-delà de M36, ce que l’on peut faire aisément ne gardant que les lignes correspondantes de <code>care_trajectories</code>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1">casc_obs &lt;-<span class="st"> </span><span class="kw">ggplot</span>(care_trajectories[month <span class="op">&lt;=</span><span class="st"> </span><span class="dv">36</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb15-2" title="2"><span class="st">  </span><span class="kw">aes</span>(<span class="dt">x =</span> month, <span class="dt">fill =</span> <span class="kw">to_factor</span>(care_status)) <span class="op">+</span></a>
<a class="sourceLine" id="cb15-3" title="3"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">color =</span> <span class="st">&quot;gray50&quot;</span>, <span class="dt">width =</span> <span class="dv">1</span>, <span class="dt">position =</span> <span class="st">&quot;fill&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb15-4" title="4"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">8</span><span class="op">*</span><span class="dv">6</span>, <span class="dt">labels =</span> etiquettes) <span class="op">+</span></a>
<a class="sourceLine" id="cb15-5" title="5"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>percent) <span class="op">+</span></a>
<a class="sourceLine" id="cb15-6" title="6"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Cascade des soins observée, selon le temps depuis le diagnostic&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb15-7" title="7"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb15-8" title="8"><span class="st">  </span><span class="kw">theme_light</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb15-9" title="9"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb15-10" title="10"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">fill =</span> <span class="st">&quot;Statut dans les soins&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb15-11" title="11"><span class="st">  </span><span class="kw">scale_fill_viridis</span>(<span class="dt">discrete =</span> <span class="ot">TRUE</span>, <span class="dt">direction =</span> <span class="dv">-1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb15-12" title="12"><span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="kw">guide_legend</span>(<span class="dt">nrow =</span> <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb15-13" title="13">casc_obs</a></code></pre></div>
<p><img src="graphs/trajectoires-de-soins/unnamed-chunk-13-1.png" width="1050" /></p>
</div>
<div id="analyse-de-survie-classique" class="section level2">
<h2>Analyse de survie classique</h2>
<p>L’<dfn>analyse de survie</dfn><dfn data-index="survie, analyse"></dfn> constitue l’approche statistique la plus fréquente pour appréhender des données biographiques. Dans sa version classique, l’analyse de survie modélise le temps mis pour vivre un événement particulier à partir d’un événement origine.</p>
<p>Dans notre exemple, l’événement d’origine commun à tous les individus est le diagnostic VIH. Les personnes suivies peuvent vivre trois événements principaux :</p>
<ul>
<li>entrée en soins (passage de <strong>D</strong> à <strong>C</strong>) ;</li>
<li>initiation du traitement (passage de <strong>C</strong> à <strong>T</strong>) ;</li>
<li>contrôle de l’infection (passage de <strong>T</strong> à <strong>S</strong>).</li>
</ul>
<p>En toute rigueur, il faudrait également considérer les transitions inverses (sortie de soins, arrêt du traitement, échec virologique). De même, il est possible que certains aient vécus plusieurs transitions successives (entrée en soin, initiation du traitement, sortie de soins et arrêt du traitement, nouvelle entrée en soins…).</p>
<p>Pour le moment, contentons-nous de regarder la <strong>première</strong> entrée en soins, la <strong>première</strong> initiation du traitement et la <strong>première</strong> atteinte du contrôle de l’infection et de calculer la date de ces trois événements, dans un fichier <code>ind</code> contenant une ligne par individu.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1">ind &lt;-<span class="st"> </span>care_trajectories[month <span class="op">==</span><span class="st"> </span><span class="dv">0</span>]</a>
<a class="sourceLine" id="cb16-2" title="2">ind<span class="op">$</span>diagnostic &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb16-3" title="3">ind &lt;-<span class="st"> </span><span class="kw">merge</span>(</a>
<a class="sourceLine" id="cb16-4" title="4">  ind,</a>
<a class="sourceLine" id="cb16-5" title="5">  care_trajectories[</a>
<a class="sourceLine" id="cb16-6" title="6">    care_status <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;C&quot;</span>, <span class="st">&quot;T&quot;</span>, <span class="st">&quot;S&quot;</span>), </a>
<a class="sourceLine" id="cb16-7" title="7">    .(<span class="dt">entree_soins =</span> <span class="kw">min</span>(month)),</a>
<a class="sourceLine" id="cb16-8" title="8">    <span class="dt">by =</span> id</a>
<a class="sourceLine" id="cb16-9" title="9">  ],</a>
<a class="sourceLine" id="cb16-10" title="10">  <span class="dt">by =</span> <span class="st">&quot;id&quot;</span>, </a>
<a class="sourceLine" id="cb16-11" title="11">  <span class="dt">all.x =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb16-12" title="12">)</a>
<a class="sourceLine" id="cb16-13" title="13">ind &lt;-<span class="st"> </span><span class="kw">merge</span>(</a>
<a class="sourceLine" id="cb16-14" title="14">  ind,</a>
<a class="sourceLine" id="cb16-15" title="15">  care_trajectories[</a>
<a class="sourceLine" id="cb16-16" title="16">    care_status <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;T&quot;</span>, <span class="st">&quot;S&quot;</span>), </a>
<a class="sourceLine" id="cb16-17" title="17">    .(<span class="dt">initiation_tt =</span> <span class="kw">min</span>(month)),</a>
<a class="sourceLine" id="cb16-18" title="18">    <span class="dt">by =</span> id</a>
<a class="sourceLine" id="cb16-19" title="19">  ],</a>
<a class="sourceLine" id="cb16-20" title="20">  <span class="dt">by =</span> <span class="st">&quot;id&quot;</span>, </a>
<a class="sourceLine" id="cb16-21" title="21">  <span class="dt">all.x =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb16-22" title="22">)</a>
<a class="sourceLine" id="cb16-23" title="23">ind &lt;-<span class="st"> </span><span class="kw">merge</span>(</a>
<a class="sourceLine" id="cb16-24" title="24">  ind,</a>
<a class="sourceLine" id="cb16-25" title="25">  care_trajectories[</a>
<a class="sourceLine" id="cb16-26" title="26">    care_status <span class="op">==</span><span class="st"> &quot;S&quot;</span>, </a>
<a class="sourceLine" id="cb16-27" title="27">    .(<span class="dt">controle =</span> <span class="kw">min</span>(month)),</a>
<a class="sourceLine" id="cb16-28" title="28">    <span class="dt">by =</span> id</a>
<a class="sourceLine" id="cb16-29" title="29">  ],</a>
<a class="sourceLine" id="cb16-30" title="30">  <span class="dt">by =</span> <span class="st">&quot;id&quot;</span>, </a>
<a class="sourceLine" id="cb16-31" title="31">  <span class="dt">all.x =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb16-32" title="32">)</a></code></pre></div>
<p>Il nous faut également la durée de suivi par individu.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1">ind &lt;-<span class="st"> </span><span class="kw">merge</span>(</a>
<a class="sourceLine" id="cb17-2" title="2">  ind,</a>
<a class="sourceLine" id="cb17-3" title="3">  care_trajectories[, .(<span class="dt">suivi =</span> <span class="kw">max</span>(month)), <span class="dt">by =</span> id],</a>
<a class="sourceLine" id="cb17-4" title="4">  <span class="dt">by =</span> <span class="st">&quot;id&quot;</span>, </a>
<a class="sourceLine" id="cb17-5" title="5">  <span class="dt">all.x =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb17-6" title="6">)</a></code></pre></div>
<p>Pour faciliter la suite des analyses, nous allons nous créer une petite fonction qui, en fonction de la date d’origine et la date d’événement retenues, calculera la courbe de <dfn>Kaplan-Meier</dfn> correspondante (voir le chapitre sur l’<a href="analyse-de-survie.html">analyse de suivie</a> pour le calcul de la courbe de survie et celui dédié à l’<a href="ecrire-ses-propres-fonctions.html">écriture de fonctions</a>).</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1">km &lt;-<span class="st"> </span><span class="cf">function</span>(date_origine, date_evenement, nom) {</a>
<a class="sourceLine" id="cb18-2" title="2">  <span class="kw">library</span>(survival)</a>
<a class="sourceLine" id="cb18-3" title="3">  </a>
<a class="sourceLine" id="cb18-4" title="4">  <span class="co"># ne garder que les observations avec date d&#39;origine</span></a>
<a class="sourceLine" id="cb18-5" title="5">  tmp &lt;-<span class="st"> </span>ind[<span class="op">!</span><span class="kw">is.na</span>(ind[[date_origine]]), ]</a>
<a class="sourceLine" id="cb18-6" title="6">  </a>
<a class="sourceLine" id="cb18-7" title="7">  <span class="co"># pre-remplir la variable time avec duree de suivi</span></a>
<a class="sourceLine" id="cb18-8" title="8">  <span class="co"># depuis date d&#39;origine</span></a>
<a class="sourceLine" id="cb18-9" title="9">  tmp<span class="op">$</span>time &lt;-<span class="st"> </span>tmp<span class="op">$</span>suivi <span class="op">-</span><span class="st"> </span>tmp[[date_origine]]</a>
<a class="sourceLine" id="cb18-10" title="10">  <span class="co"># et considérer que l&#39;événement n&#39;a pas été vécu</span></a>
<a class="sourceLine" id="cb18-11" title="11">  tmp<span class="op">$</span>event &lt;-<span class="st"> </span><span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb18-12" title="12">  </a>
<a class="sourceLine" id="cb18-13" title="13">  <span class="co"># si date_evement documentée, événement vécu</span></a>
<a class="sourceLine" id="cb18-14" title="14">  tmp[<span class="op">!</span><span class="kw">is.na</span>(tmp[[date_evenement]]), ]<span class="op">$</span>event &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb18-15" title="15">  tmp[tmp<span class="op">$</span>event <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>, ]<span class="op">$</span>time &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb18-16" title="16"><span class="st">    </span>tmp[tmp<span class="op">$</span>event <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>, ][[date_evenement]] <span class="op">-</span></a>
<a class="sourceLine" id="cb18-17" title="17"><span class="st">    </span>tmp[tmp<span class="op">$</span>event <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>, ][[date_origine]]</a>
<a class="sourceLine" id="cb18-18" title="18">  </a>
<a class="sourceLine" id="cb18-19" title="19">  kaplan &lt;-<span class="st"> </span><span class="kw">survfit</span>(<span class="kw">Surv</span>(time, event) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">data =</span> tmp)</a>
<a class="sourceLine" id="cb18-20" title="20">  res &lt;-<span class="st"> </span>broom<span class="op">::</span><span class="kw">tidy</span>(kaplan, <span class="dt">conf.int =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb18-21" title="21">  res<span class="op">$</span>nom &lt;-<span class="st"> </span>nom</a>
<a class="sourceLine" id="cb18-22" title="22">  res</a>
<a class="sourceLine" id="cb18-23" title="23">}</a></code></pre></div>
<p>Une première approche consiste à regarder la survenue de chacun des trois événements mentions plus haut en fonction du temps depuis le diagnostic.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1">depuis_diag &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">bind_rows</span>(</a>
<a class="sourceLine" id="cb19-2" title="2">  <span class="kw">km</span>(<span class="st">&quot;diagnostic&quot;</span>, <span class="st">&quot;entree_soins&quot;</span>, <span class="st">&quot;entrée en soins&quot;</span>),</a>
<a class="sourceLine" id="cb19-3" title="3">  <span class="kw">km</span>(<span class="st">&quot;diagnostic&quot;</span>, <span class="st">&quot;initiation_tt&quot;</span>, <span class="st">&quot;initiation du traitement&quot;</span>),</a>
<a class="sourceLine" id="cb19-4" title="4">  <span class="kw">km</span>(<span class="st">&quot;diagnostic&quot;</span>, <span class="st">&quot;controle&quot;</span>, <span class="st">&quot;contrôle de l&#39;infection&quot;</span>)</a>
<a class="sourceLine" id="cb19-5" title="5">)</a>
<a class="sourceLine" id="cb19-6" title="6"></a>
<a class="sourceLine" id="cb19-7" title="7">g_diag &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> depuis_diag) <span class="op">+</span></a>
<a class="sourceLine" id="cb19-8" title="8"><span class="st">  </span><span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>estimate, </a>
<a class="sourceLine" id="cb19-9" title="9">      <span class="dt">color =</span> <span class="kw">as_factor</span>(nom), <span class="dt">fill =</span> <span class="kw">as_factor</span>(nom),</a>
<a class="sourceLine" id="cb19-10" title="10">      <span class="dt">ymin =</span> <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>conf.high, <span class="dt">ymax =</span> <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>conf.low) <span class="op">+</span></a>
<a class="sourceLine" id="cb19-11" title="11"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">alpha =</span> <span class="fl">.25</span>, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">color =</span> <span class="ot">NULL</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb19-12" title="12"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb19-13" title="13"><span class="st">  </span><span class="kw">theme_classic</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb19-14" title="14"><span class="st">  </span><span class="kw">theme</span>(</a>
<a class="sourceLine" id="cb19-15" title="15">    <span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</a>
<a class="sourceLine" id="cb19-16" title="16">    <span class="dt">panel.grid.major.y =</span> <span class="kw">element_line</span>(<span class="dt">colour =</span> <span class="st">&quot;grey&quot;</span>)</a>
<a class="sourceLine" id="cb19-17" title="17">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb19-18" title="18"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">6</span><span class="op">*</span><span class="dv">6</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">36</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb19-19" title="19"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>percent, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb19-20" title="20"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;mois depuis le diagnostic&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-21" title="21"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">color =</span> <span class="st">&quot;&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb19-22" title="22">g_diag</a></code></pre></div>
<p><img src="graphs/trajectoires-de-soins/unnamed-chunk-17-1.png" width="1050" /></p>
<p>Ce graphique ressemble à la cascade des soins observée que nous avions calculée plus haut, à quelques différences près :</p>
<ul>
<li>avec la méthode de Kaplan-Meier, la censure à droite, i.e. le fait que tous les individus n’ont pas la même durée de suivi, est correctement prise en compte et la courbe est corrigée en conséquence ;</li>
<li>par contre, les transitions inverses ne sont pas considérées : lorsqu’un individu a atteint une étape, on ne regarde pas s’il en ressort.</li>
</ul>
<p>Une autre manière d’appréhender nos trajectoires est de considérer le temps requis pour atteindre une étape une fois la précédente étape atteinte. Ce qu’on obtient facilement en adaptant légèrement notre code précédent.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1">depuis_prec &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">bind_rows</span>(</a>
<a class="sourceLine" id="cb20-2" title="2">  <span class="kw">km</span>(<span class="st">&quot;diagnostic&quot;</span>, <span class="st">&quot;entree_soins&quot;</span>, <span class="st">&quot;entrée en soins&quot;</span>),</a>
<a class="sourceLine" id="cb20-3" title="3">  <span class="kw">km</span>(<span class="st">&quot;entree_soins&quot;</span>, <span class="st">&quot;initiation_tt&quot;</span>, <span class="st">&quot;initiation du traitement&quot;</span>),</a>
<a class="sourceLine" id="cb20-4" title="4">  <span class="kw">km</span>(<span class="st">&quot;initiation_tt&quot;</span>, <span class="st">&quot;controle&quot;</span>, <span class="st">&quot;contrôle de l&#39;infection&quot;</span>)</a>
<a class="sourceLine" id="cb20-5" title="5">)</a>
<a class="sourceLine" id="cb20-6" title="6"></a>
<a class="sourceLine" id="cb20-7" title="7">g_prec &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> depuis_prec) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-8" title="8"><span class="st">  </span><span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>estimate, </a>
<a class="sourceLine" id="cb20-9" title="9">      <span class="dt">color =</span> <span class="kw">as_factor</span>(nom), <span class="dt">fill =</span> <span class="kw">as_factor</span>(nom),</a>
<a class="sourceLine" id="cb20-10" title="10">      <span class="dt">ymin =</span> <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>conf.high, <span class="dt">ymax =</span> <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>conf.low) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-11" title="11"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">alpha =</span> <span class="fl">.25</span>, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">color =</span> <span class="ot">NULL</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-12" title="12"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-13" title="13"><span class="st">  </span><span class="kw">theme_classic</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb20-14" title="14"><span class="st">  </span><span class="kw">theme</span>(</a>
<a class="sourceLine" id="cb20-15" title="15">    <span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</a>
<a class="sourceLine" id="cb20-16" title="16">    <span class="dt">panel.grid.major.y =</span> <span class="kw">element_line</span>(<span class="dt">colour =</span> <span class="st">&quot;grey&quot;</span>)</a>
<a class="sourceLine" id="cb20-17" title="17">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-18" title="18"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">6</span><span class="op">*</span><span class="dv">6</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">36</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-19" title="19"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>percent, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-20" title="20"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;mois depuis l&#39;étape précédente&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-21" title="21"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">color =</span> <span class="st">&quot;&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb20-22" title="22"></a>
<a class="sourceLine" id="cb20-23" title="23">g_prec</a></code></pre></div>
<p><img src="graphs/trajectoires-de-soins/unnamed-chunk-18-1.png" width="1050" /></p>
<p>Attention : cette représentation graphique peut éventuellement prêter à confusion dans sa lecture car l’échelle de temps n’est pas tout à fait la même pour chaque courbe, dans la mesure où la date d’origine diffère pour chacune. Dès lors, il peut être plus pertinent de présenter chaque courbe l’une à côté de l’autre.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1">g_prec <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(<span class="op">~</span><span class="st"> </span><span class="kw">as_factor</span>(nom))</a></code></pre></div>
<p><img src="graphs/trajectoires-de-soins/unnamed-chunk-19-1.png" width="1050" /></p>
<p>Ici, on voit plus clairement que l’étape où il y a le plus de <q>perdition</q> est celle de l’entrée en soins, moins des trois quarts des personnes diagnostiquées étant venu en clinique au mois une fois dans les trois ans suivant le diagnostic. Par contre, l’initiation du traitement une fois entré en clinique et le contrôle de l’infection une fois le traitement initié sont beaucoup plus rapide.</p>
<p>Pour aller plus loin avec les outils de l’analyse de survie classique, il serait possible de faire des analyses bivariées (Kaplan-Meier) ou multivariées (Cox) pour chacune de ces étapes. Cependant, il serait plus intéressant de trouver une approache statistique permettant de considérer dans un même modèle l’ensemble des transitions possibles.</p>
</div>
<div id="une-première-analyse-de-séquences-sur-lensemble-du-fichier" class="section level2">
<h2>Une première analyse de séquences sur l’ensemble du fichier</h2>
<p>L’<dfn>analyse de séquences</dfn><dfn data-index="séquence, analyse"></dfn> permet d’appréhender l’ensemble de la trajectoire de soins à travers la succession des états dans lesquels se trouvent les patients observés.</p>
<p>Nous allons donc réaliser une analyse de séquences (voir le <a href="analyse-de-sequences.html">chapitre dédié</a>) sur l’ensemble de notre fichier. Pour cela, il va falloir préalable que nous transformions nos donnée actuellement dans un format <q>long</q> en un tableau <q>large</q>, c’est-à-dire avec une ligne par individu et une variable différentes par pas de temps. On peut réaliser cela facilement avec <code data-pkg="tidyr">spread</code> de <code class="pkg">tidyr</code> (voir le <a href="reorganiser-ses-donnees-avec-tidyr.html#spread-disperser-des-lignes">chapitre dédié à <strong>tidyr</strong></a>).</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1"><span class="kw">library</span>(tidyr)</a>
<a class="sourceLine" id="cb22-2" title="2">large &lt;-<span class="st"> </span>care_trajectories <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb22-3" title="3"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(id, <span class="dt">m =</span> month, care_status) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb22-4" title="4"><span class="st">  </span><span class="kw">spread</span>(<span class="dt">key =</span> m, <span class="dt">value =</span> care_status, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>) </a>
<a class="sourceLine" id="cb22-5" title="5"><span class="kw">head</span>(large)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">id</th>
<th align="left">m0</th>
<th align="left">m1</th>
<th align="left">m2</th>
<th align="left">m3</th>
<th align="left">m4</th>
<th align="left">m5</th>
<th align="left">m6</th>
<th align="left">m7</th>
<th align="left">m8</th>
<th align="left">m9</th>
<th align="left">m10</th>
<th align="left">m11</th>
<th align="left">m12</th>
<th align="left">m13</th>
<th align="left">m14</th>
<th align="left">m15</th>
<th align="left">m16</th>
<th align="left">m17</th>
<th align="left">m18</th>
<th align="left">m19</th>
<th align="left">m20</th>
<th align="left">m21</th>
<th align="left">m22</th>
<th align="left">m23</th>
<th align="left">m24</th>
<th align="left">m25</th>
<th align="left">m26</th>
<th align="left">m27</th>
<th align="left">m28</th>
<th align="left">m29</th>
<th align="left">m30</th>
<th align="left">m31</th>
<th align="left">m32</th>
<th align="left">m33</th>
<th align="left">m34</th>
<th align="left">m35</th>
<th align="left">m36</th>
<th align="left">m37</th>
<th align="left">m38</th>
<th align="left">m39</th>
<th align="left">m40</th>
<th align="left">m41</th>
<th align="left">m42</th>
<th align="left">m43</th>
<th align="left">m44</th>
<th align="left">m45</th>
<th align="left">m46</th>
<th align="left">m47</th>
<th align="left">m48</th>
<th align="left">m49</th>
<th align="left">m50</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">3</td>
<td align="left">D</td>
<td align="left">D</td>
<td align="left">D</td>
<td align="left">D</td>
<td align="left">D</td>
<td align="left">D</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">9</td>
<td align="left">D</td>
<td align="left">D</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">13</td>
<td align="left">D</td>
<td align="left">D</td>
<td align="left">D</td>
<td align="left">D</td>
<td align="left">D</td>
<td align="left">D</td>
<td align="left">D</td>
<td align="left">D</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">15</td>
<td align="left">D</td>
<td align="left">D</td>
<td align="left">D</td>
<td align="left">D</td>
<td align="left">T</td>
<td align="left">T</td>
<td align="left">T</td>
<td align="left">C</td>
<td align="left">D</td>
<td align="left">D</td>
<td align="left">D</td>
<td align="left">D</td>
<td align="left">D</td>
<td align="left">D</td>
<td align="left">D</td>
<td align="left">C</td>
<td align="left">C</td>
<td align="left">C</td>
<td align="left">C</td>
<td align="left">C</td>
<td align="left">C</td>
<td align="left">C</td>
<td align="left">C</td>
<td align="left">C</td>
<td align="left">T</td>
<td align="left">T</td>
<td align="left">T</td>
<td align="left">T</td>
<td align="left">T</td>
<td align="left">T</td>
<td align="left">T</td>
<td align="left">T</td>
<td align="left">T</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">18</td>
<td align="left">D</td>
<td align="left">D</td>
<td align="left">S</td>
<td align="left">S</td>
<td align="left">S</td>
<td align="left">S</td>
<td align="left">S</td>
<td align="left">S</td>
<td align="left">S</td>
<td align="left">S</td>
<td align="left">S</td>
<td align="left">S</td>
<td align="left">S</td>
<td align="left">S</td>
<td align="left">S</td>
<td align="left">S</td>
<td align="left">S</td>
<td align="left">S</td>
<td align="left">S</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">21</td>
<td align="left">D</td>
<td align="left">D</td>
<td align="left">D</td>
<td align="left">D</td>
<td align="left">D</td>
<td align="left">D</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<p>On utilise <code data-pkg="TraMineR">seqdef</code> de <code class="pkg">TraMineR</code> pour créer nos séquences, avec les arguments <code>alphabet</code> pour forcer l’ordre de l’alphabet, <code>states</code> pour spécifier des étiquettes courtes à chaque état et <code>cpal</code> pour indiquer le code couleur de chaque état (et être raccord avec nos graphiques précédents).</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1"><span class="kw">library</span>(TraMineR, <span class="dt">quietly =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb23-2" title="2">seq_all &lt;-<span class="st"> </span><span class="kw">seqdef</span>(</a>
<a class="sourceLine" id="cb23-3" title="3">  large[, m0<span class="op">:</span>m50],</a>
<a class="sourceLine" id="cb23-4" title="4">  <span class="dt">id =</span> large<span class="op">$</span>id,</a>
<a class="sourceLine" id="cb23-5" title="5">  <span class="dt">alphabet =</span> <span class="kw">c</span>(<span class="st">&quot;D&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;T&quot;</span>, <span class="st">&quot;S&quot;</span>),</a>
<a class="sourceLine" id="cb23-6" title="6">  <span class="dt">states =</span> <span class="kw">c</span>(<span class="st">&quot;diagnostiqué&quot;</span>, <span class="st">&quot;en soins&quot;</span>, <span class="st">&quot;sous traitement&quot;</span>, <span class="st">&quot;inf. contrôlée&quot;</span>),</a>
<a class="sourceLine" id="cb23-7" title="7">  <span class="dt">cpal =</span> <span class="kw">viridis</span>(<span class="dv">4</span>, <span class="dt">direction =</span> <span class="dv">-1</span>)</a>
<a class="sourceLine" id="cb23-8" title="8">)</a></code></pre></div>
<pre><code> [&gt;] found missing values (&#39;NA&#39;) in sequence data</code></pre>
<pre><code> [&gt;] preparing 2929 sequences</code></pre>
<pre><code> [&gt;] coding void elements with &#39;%&#39; and missing values with &#39;*&#39;</code></pre>
<pre><code> [&gt;] state coding:</code></pre>
<pre><code>       [alphabet]  [label]         [long label] </code></pre>
<pre><code>     1  D           diagnostiqué    diagnostiqué</code></pre>
<pre><code>     2  C           en soins        en soins</code></pre>
<pre><code>     3  T           sous traitement sous traitement</code></pre>
<pre><code>     4  S           inf. contrôlée  inf. contrôlée</code></pre>
<pre><code> [&gt;] 2929 sequences in the data set</code></pre>
<pre><code> [&gt;] min/max sequence length: 1/51</code></pre>
<p>On peut retrouver la cascade de soins avec <code data-pkg="TraMineR" data-rdoc="seqplot">seqdplot</code>.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" title="1"><span class="kw">seqdplot</span>(seq_all, <span class="dt">legend.prop =</span> <span class="fl">.25</span>)</a></code></pre></div>
<p><img src="graphs/trajectoires-de-soins/unnamed-chunk-22-1.png" width="1050" /></p>
<p>Nous allons maintenant calculer une matrice des distances entre individus par <dfn lang="en">optimal matching</dfn>. Dans le cas présent, nos différents status sont hiérarchiquement ordonnés. Il n’est donc pas raisonnable de penser que les coûts sont constants entre les différents statuts, puisqu’en un sens, passer directement de <strong>D</strong> à <strong>T</strong> peut être considéré comme être passé d’abord de <strong>D</strong> à <strong>C</strong> puis de <strong>C</strong> à <strong>D</strong>. Nous allons donc faire une matrice de coûts hiérarchisée. <code data-pkg="TraMineR">seqcost</code> nous permets de produire une matrice de coûts constants, que nous allons ensuite modifier manuellement. Pour le coût <em>indel</em>, le plus simple est de considérer la moitié du coût de substitution maximum.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" title="1">couts &lt;-<span class="st"> </span><span class="kw">seqcost</span>(seq_all, <span class="dt">method =</span> <span class="st">&quot;CONSTANT&quot;</span>)</a></code></pre></div>
<pre><code> [&gt;] creating 4x4 substitution-cost matrix using 2 as constant value</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" title="1">couts</a></code></pre></div>
<pre><code>$indel
[1] 1

$sm
                  diagnostiqué-&gt; en soins-&gt;
diagnostiqué-&gt;                 0          2
en soins-&gt;                     2          0
sous traitement-&gt;              2          2
inf. contrôlée-&gt;               2          2
                  sous traitement-&gt; inf. contrôlée-&gt;
diagnostiqué-&gt;                    2                2
en soins-&gt;                        2                2
sous traitement-&gt;                 0                2
inf. contrôlée-&gt;                  2                0</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" title="1">couts<span class="op">$</span>sm[<span class="dv">1</span>, ] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb40-2" title="2">couts<span class="op">$</span>sm[<span class="dv">2</span>, ] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb40-3" title="3">couts<span class="op">$</span>sm[<span class="dv">3</span>, ] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb40-4" title="4">couts<span class="op">$</span>sm[<span class="dv">4</span>, ] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb40-5" title="5">couts<span class="op">$</span>indel &lt;-<span class="st"> </span><span class="kw">max</span>(couts<span class="op">$</span>sm) <span class="op">/</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb40-6" title="6">couts</a></code></pre></div>
<pre><code>$indel
[1] 1.5

$sm
                  diagnostiqué-&gt; en soins-&gt;
diagnostiqué-&gt;                 0          1
en soins-&gt;                     1          0
sous traitement-&gt;              2          1
inf. contrôlée-&gt;               3          2
                  sous traitement-&gt; inf. contrôlée-&gt;
diagnostiqué-&gt;                    2                3
en soins-&gt;                        1                2
sous traitement-&gt;                 0                1
inf. contrôlée-&gt;                  1                0</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" title="1">dist_all &lt;-<span class="st"> </span><span class="kw">seqdist</span>(seq_all, <span class="dt">method =</span> <span class="st">&quot;OM&quot;</span>, <span class="dt">sm =</span> couts<span class="op">$</span>sm, <span class="dt">indel =</span> couts<span class="op">$</span>indel)</a></code></pre></div>
<pre><code> [&gt;] 2929 sequences with 4 distinct states</code></pre>
<pre><code> [&gt;] checking &#39;sm&#39; (one value for each state, triangle inequality)</code></pre>
<pre><code> [&gt;] 1370 distinct sequences</code></pre>
<pre><code> [&gt;] min/max sequence length: 1/51</code></pre>
<pre><code> [&gt;] computing distances using the OM metric</code></pre>
<pre><code> [&gt;] elapsed time: 1.54 secs</code></pre>
<p>Calculons le dendrogramme et représentons le avec le tapis de séquence grace à <code data-pkg="JLutils">seq_heatmap</code> de l’extension <code class="pkg">JLutils</code>. Pour rappel, cette extension est seulement disponible sur <a href="https://github.com/larmarange/JLutils">GitHUb</a>. On l’installera donc (ou on la mettra à jour) avec la commande <code>devtools::install_github("larmarange/JLutils")</code>.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" title="1">arbre_all &lt;-<span class="st"> </span><span class="kw">hclust</span>(<span class="kw">as.dist</span>(dist_all), <span class="dt">method =</span> <span class="st">&quot;ward.D2&quot;</span>)</a>
<a class="sourceLine" id="cb49-2" title="2"><span class="kw">library</span>(JLutils, <span class="dt">quietly =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb49-3" title="3"><span class="kw">seq_heatmap</span>(seq_all, arbre_all)</a></code></pre></div>
<p><img src="graphs/trajectoires-de-soins/unnamed-chunk-24-1.png" width="1050" /></p>
<p>Il apparaît que les différentes séquences sont principalement regroupées en fonction de leur longueur. En effet, pour passer d’une séquence courte à une séquence longue il faut <q>ajouter</q> des statuts pour compléter la séquence ce qui induit <em>de facto</em> une distance élevée (en raison du coût <em>indel</em>). Dès lors, lorsque l’on travaille avec des séquences aux longueurs très disparates, une <dfn>classification ascendante hiérarchique</dfn> va produire une typologie de séquences courtes et de séquences longues, ce qui n’est pas forcément ce que l’on recherche.</p>
<p>Dans notre exemple, nous pouvons considérer que les séquences courtes ne sont pas pertinentes à retenir dans l’analyse car l’observation n’est pas assez longue pour voir le parcours de soins des patients. Une solution consiste à ne retenir que les individus observées au moins <code>n</code> mois et analyser leur trajectoire sur seulement <code>n</code> mois, ce qui permet de n’avoir que des séquences de même longueur. Dès lors, la distance entre deux séquences ne dépendra plus que des différences de parcours. On serait tenté de prendre un <code>n</code> élévé pour avoir ainsi des parcours de soins longs. Mais dans ce cas là, l’analyse ne se fera que sur un tout petit nombre d’individus et on manquera de puissance. Si, à l’inverse, on prends un <code>n</code> petit, nous aurons des effectifs élevés mais les séquences seront peut-être trop courtes pour mettre en évidence la variété des trajectoires. Il faut dès lors trouver un compromis entre ces deux contraintes.</p>
<p>Si l’on regarde notre premier graphique montrant le nombre d’observations au cours du temps, il apparaît une sorte de point d’inflexion au niveau de M18 avec un brusque décrochage. D’un autre côté, 18 mois offre un minimum de durée d’observations pour espérer voir émerger des trajectoires plus complexes.</p>
</div>
<div id="une-seconde-analyse-de-séquences-limitées-aux-18-premiers-mois" class="section level2">
<h2>Une seconde analyse de séquences limitées aux 18 premiers mois</h2>
<p>Reprenons notre analyse en se limitant aux individus observés au moins 18 mois (soit 19 status entre M0 et M18) et en se limitant aux 18 premiers mois pour modéliser les séquences. La fonction <code data-pkg="TraMineR">seqlength</code> permets de récupérer la longueur de chaque séquence.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" title="1">large<span class="op">$</span>seq_length &lt;-<span class="st"> </span><span class="kw">seqlength</span>(seq_all)</a>
<a class="sourceLine" id="cb50-2" title="2">large_m18 &lt;-<span class="st"> </span>large[seq_length <span class="op">&gt;=</span><span class="st"> </span><span class="dv">19</span>, id<span class="op">:</span>m18]</a>
<a class="sourceLine" id="cb50-3" title="3">seq_m18 &lt;-<span class="st"> </span><span class="kw">seqdef</span>(</a>
<a class="sourceLine" id="cb50-4" title="4">  large_m18[, m0<span class="op">:</span>m18],</a>
<a class="sourceLine" id="cb50-5" title="5">  <span class="dt">id =</span> large_m18<span class="op">$</span>id,</a>
<a class="sourceLine" id="cb50-6" title="6">  <span class="dt">alphabet =</span> <span class="kw">c</span>(<span class="st">&quot;D&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;T&quot;</span>, <span class="st">&quot;S&quot;</span>),</a>
<a class="sourceLine" id="cb50-7" title="7">  <span class="dt">states =</span> <span class="kw">c</span>(<span class="st">&quot;diagnostiqué&quot;</span>, <span class="st">&quot;en soins&quot;</span>, <span class="st">&quot;sous traitement&quot;</span>, <span class="st">&quot;inf. contrôlée&quot;</span>),</a>
<a class="sourceLine" id="cb50-8" title="8">  <span class="dt">cpal =</span> <span class="kw">viridis</span>(<span class="dv">4</span>, <span class="dt">direction =</span> <span class="dv">-1</span>)</a>
<a class="sourceLine" id="cb50-9" title="9">)</a></code></pre></div>
<pre><code> [&gt;] state coding:</code></pre>
<pre><code>       [alphabet]  [label]         [long label] </code></pre>
<pre><code>     1  D           diagnostiqué    diagnostiqué</code></pre>
<pre><code>     2  C           en soins        en soins</code></pre>
<pre><code>     3  T           sous traitement sous traitement</code></pre>
<pre><code>     4  S           inf. contrôlée  inf. contrôlée</code></pre>
<pre><code> [&gt;] 1317 sequences in the data set</code></pre>
<pre><code> [&gt;] min/max sequence length: 19/19</code></pre>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" title="1">dist_m18 &lt;-<span class="st"> </span><span class="kw">seqdist</span>(seq_m18, <span class="dt">method =</span> <span class="st">&quot;OM&quot;</span>, <span class="dt">sm =</span> couts<span class="op">$</span>sm, <span class="dt">indel =</span> couts<span class="op">$</span>indel)</a></code></pre></div>
<pre><code> [&gt;] 1317 sequences with 4 distinct states</code></pre>
<pre><code> [&gt;] checking &#39;sm&#39; (one value for each state, triangle inequality)</code></pre>
<pre><code> [&gt;] 578 distinct sequences</code></pre>
<pre><code> [&gt;] min/max sequence length: 19/19</code></pre>
<pre><code> [&gt;] computing distances using the OM metric</code></pre>
<pre><code> [&gt;] elapsed time: 0.2 secs</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" title="1">arbre_m18 &lt;-<span class="st"> </span><span class="kw">hclust</span>(<span class="kw">as.dist</span>(dist_m18), <span class="dt">method =</span> <span class="st">&quot;ward.D2&quot;</span>)</a>
<a class="sourceLine" id="cb66-2" title="2"><span class="kw">seq_heatmap</span>(seq_m18, arbre_m18)</a></code></pre></div>
<p><img src="graphs/trajectoires-de-soins/unnamed-chunk-25-1.png" width="1050" /></p>
<p>Reste maintenant à décider du nombre de classes à retenir. Encore une fois, c’est un équilibre à trouver entre le niveau de détails voulus et le niveau de simplification requis pour permettre l’analyse.</p>
<p>Pour faciliter ce choix, on peut avoir recours à la fonction <code data-pkg="WeightedCluster">as.seqtree</code> de l’extension <code class="pkg">WeightedCluster</code>, couplée à la fonction <code data-pkg="TraMineR">seqtreedisplay</code>. <strong>ATTENTION :</strong> pour que le graphique puisse être produit, il faut que le logiciel libre <strong>GraphViz</strong> (<a href="https://graphviz.gitlab.io/" class="uri">https://graphviz.gitlab.io/</a>) soit installé sur votre PC. On peut également installer <strong>GraphViz</strong> avec le code ci-dessous :</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" title="1"><span class="cf">if</span> (<span class="op">!</span><span class="kw">requireNamespace</span>(<span class="st">&quot;BiocManager&quot;</span>, <span class="dt">quietly =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb67-2" title="2">    <span class="kw">install.packages</span>(<span class="st">&quot;BiocManager&quot;</span>)</a>
<a class="sourceLine" id="cb67-3" title="3">BiocManager<span class="op">::</span><span class="kw">install</span>(<span class="st">&quot;Rgraphviz&quot;</span>)</a></code></pre></div>
<p>La combinaison des deux fonctions va permettre de représenter l’évolution des catégories au fur-et-à-mesure que l’on coupe le dendrogramme plus bas. On peut choisir le type de graphique utilisé avec l’argument <code>type</code> (voir l’aide de <code data-pkg="TraMineR">seqplot</code>) et le nombre maximum de clusters avec <code>nclust</code>.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb68-1" title="1"><span class="kw">library</span>(WeightedCluster, <span class="dt">quietly =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb68-2" title="2">seqtree_m18 &lt;-<span class="st"> </span><span class="kw">as.seqtree</span>(arbre_m18, <span class="dt">seqdata =</span> seq_m18, <span class="dt">diss =</span> dist_m18, <span class="dt">ncluster =</span> <span class="dv">7</span>)</a>
<a class="sourceLine" id="cb68-3" title="3"><span class="kw">seqtreedisplay</span>(seqtree_m18, <span class="dt">type=</span><span class="st">&quot;I&quot;</span>, <span class="dt">border=</span><span class="ot">NA</span>, <span class="dt">show.depth=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<div class="figure">
<img src="images/trajectoires_soins_seqtreedisplay_m18.png" alt="Représentation graphique produite par seqtreedisplay" />
<p class="caption">Représentation graphique produite par seqtreedisplay</p>
</div>
<p>Afin d’éviter de multiplier les sous-groupes, nous n’allons conserver que 4 catégories.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" title="1">large_m18<span class="op">$</span>typo_cah &lt;-<span class="st"> </span><span class="kw">cutree</span>(arbre_m18, <span class="dv">4</span>)</a></code></pre></div>
<div class="note">
<p>Il est aussi possible de se baser sur divers indicateurs statistiques sur la <q>qualité</q> de chaque partition. Pour cela, on pourra par exemple avoir recours à la fonction <code data-pkg="WeightedCluster">as.clustrange</code> de l’extension <code class="pkg">WeightedCluster</code>. Essayez par exemple les commandes ci-après :</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb70-1" title="1">nc &lt;-<span class="st"> </span><span class="kw">as.clustrange</span>(arbre_m18, dist_m18)</a>
<a class="sourceLine" id="cb70-2" title="2"><span class="kw">summary</span>(nc, <span class="dt">max.rank =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb70-3" title="3"><span class="kw">plot</span>(nc, <span class="dt">norm =</span> <span class="st">&quot;zscore&quot;</span>)</a></code></pre></div>
<p>Pour plus d’informations, voir le <a href="https://cran.r-project.org/web/packages/WeightedCluster/vignettes/WeightedClusterFR.pdf"><em>manuel de la librairie WeightedCluster</em></a>, chapitre 7.</p>
</div>
<p>On peut représenter le découpage du dendrogramme avec <code data-pkg="JLutils">A2Rplot</code> fournie par <code class="pkg">JLutils</code></p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb71-1" title="1"><span class="kw">A2Rplot</span>(arbre_m18, <span class="dt">k =</span> <span class="dv">4</span>, <span class="dt">show.labels =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p><img src="graphs/trajectoires-de-soins/unnamed-chunk-31-1.png" width="1050" /></p>
<p>Comme expliqué par Matthias Studer dans le <a href="https://cran.r-project.org/web/packages/WeightedCluster/vignettes/WeightedClusterFR.pdf"><em>manuel de la librairie WeightedCluster</em></a>, plusieurs critiques peuvent être adressées aux procédures hiérarchiques, en particulier le fait que la fusion de deux groupes se fait en maximisant un critère local.</p>
<p>L’algorithme <dfn>PAM</dfn> pour <dfn lang="en">Partitioning Around Medoids</dfn> suit une autre logique que les algorithmes hiérarchiques et vise à obtenir la meilleure partition d’un ensemble de données en un nombre prédéfini de groupes. Il a l’avantage de maximiser un critère global et non uniquement un critère local. Par contre, le nombre de classes doit être fixé à l’avance.</p>
<p>Ayant décidé de retenir 4 classes au regard de notre classification ascendante hiérarchique, nous pouvons voir si l’algorithme PAM permets d’améliorer nos 4 classes. Nous allons utiliser la fonction <code data-pkg="WeightedCluster">wcKMedoids</code> de l’extension <code class="pkg">WeightedCluster</code> en lui indiquant comme partition initiale celle obtenue avec la classigication hiérarchique.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" title="1">pam_m18 &lt;-<span class="st"> </span><span class="kw">wcKMedoids</span>(dist_m18, <span class="dt">k =</span> <span class="dv">4</span>, <span class="dt">initialclust =</span> arbre_m18)</a>
<a class="sourceLine" id="cb72-2" title="2">large_m18<span class="op">$</span>typo_pam &lt;-<span class="st"> </span>pam_m18<span class="op">$</span>clustering</a></code></pre></div>
<p>Un tableau croisé nous permets de voir que les deux typologies restent proches.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb73-1" title="1"><span class="kw">table</span>(large_m18<span class="op">$</span>typo_cah, large_m18<span class="op">$</span>typo_pam)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">/</th>
<th align="right">6</th>
<th align="right">23</th>
<th align="right">85</th>
<th align="right">410</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">522</td>
<td align="right">4</td>
<td align="right">0</td>
<td align="right">39</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">330</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="right">1</td>
<td align="right">203</td>
<td align="right">59</td>
<td align="right">13</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="right">23</td>
<td align="right">0</td>
<td align="right">5</td>
<td align="right">112</td>
</tr>
</tbody>
</table>
<p>Regardons les tapis de séquence des deux typologies.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb74-1" title="1">large_m18<span class="op">$</span>ordre_cmd &lt;-<span class="st"> </span><span class="kw">cmdscale</span>(<span class="kw">as.dist</span>(dist_m18), <span class="dt">k =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb74-2" title="2"><span class="kw">seqIplot</span>(seq_m18, <span class="dt">group =</span> large_m18<span class="op">$</span>typo_cah, <span class="dt">sortv =</span> large_m18<span class="op">$</span>ordre_cmd)</a></code></pre></div>
<p><img src="graphs/trajectoires-de-soins/unnamed-chunk-34-1.png" width="1050" /></p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" title="1"><span class="kw">seqIplot</span>(seq_m18, <span class="dt">group =</span> large_m18<span class="op">$</span>typo_pam, <span class="dt">sortv =</span> large_m18<span class="op">$</span>ordre_cmd)</a></code></pre></div>
<p><img src="graphs/trajectoires-de-soins/unnamed-chunk-34-2.png" width="1050" /></p>
<p>Comme on le voit les deux typologies obtenues sont très proches. Suivant le cas, à vous de choisir celle qui semble la plus pertinente d’un point de vue sociologique. Il existe également divers indicateurs statisques pour mesurer la qualité d’une partition (voir le <a href="https://cran.r-project.org/web/packages/WeightedCluster/vignettes/WeightedClusterFR.pdf"><em>manuel de la librairie WeightedCluster</em></a> de Matthias Studer). Ils peuvent être calculés avec la fonction <code data-pkg="WeightedCluster">wcClusterQuality</code>. Comparons les deux typologies obtenues.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb76-1" title="1">tab &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb76-2" title="2">  <span class="dt">stat =</span> <span class="kw">names</span>(<span class="kw">wcClusterQuality</span>(dist_m18, large_m18<span class="op">$</span>typo_cah)<span class="op">$</span>stats),</a>
<a class="sourceLine" id="cb76-3" title="3">  <span class="dt">cah =</span> <span class="kw">wcClusterQuality</span>(dist_m18, large_m18<span class="op">$</span>typo_cah)<span class="op">$</span>stats,</a>
<a class="sourceLine" id="cb76-4" title="4">  <span class="dt">pam =</span> <span class="kw">wcClusterQuality</span>(dist_m18, large_m18<span class="op">$</span>typo_pam)<span class="op">$</span>stats</a>
<a class="sourceLine" id="cb76-5" title="5">)</a>
<a class="sourceLine" id="cb76-6" title="6">knitr<span class="op">::</span><span class="kw">kable</span>(tab, <span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">stat</th>
<th align="right">cah</th>
<th align="right">pam</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">PBC</td>
<td align="right">0.703</td>
<td align="right">0.712</td>
</tr>
<tr class="even">
<td align="left">HG</td>
<td align="right">0.933</td>
<td align="right">0.950</td>
</tr>
<tr class="odd">
<td align="left">HGSD</td>
<td align="right">0.930</td>
<td align="right">0.946</td>
</tr>
<tr class="even">
<td align="left">ASW</td>
<td align="right">0.528</td>
<td align="right">0.568</td>
</tr>
<tr class="odd">
<td align="left">ASWw</td>
<td align="right">0.530</td>
<td align="right">0.569</td>
</tr>
<tr class="even">
<td align="left">CH</td>
<td align="right">938.972</td>
<td align="right">1023.120</td>
</tr>
<tr class="odd">
<td align="left">R2</td>
<td align="right">0.682</td>
<td align="right">0.700</td>
</tr>
<tr class="even">
<td align="left">CHsq</td>
<td align="right">3351.212</td>
<td align="right">3980.601</td>
</tr>
<tr class="odd">
<td align="left">R2sq</td>
<td align="right">0.884</td>
<td align="right">0.901</td>
</tr>
<tr class="even">
<td align="left">HC</td>
<td align="right">0.028</td>
<td align="right">0.021</td>
</tr>
</tbody>
</table>
<p>Selon ces indicateurs calculés, l’approche PAM obtiendrait une partition légèrement de meilleure qualité que celle obtenuepar CAH.</p>
<p>L’extension <code class="pkg">WeightedCluster</code> fournie aussi une fonction <code data-pkg="WeightedCluster">wcSilhouetteObs</code> permettant de mesurer la <q>silhouette</q> de chaque séquence. Plus cette métrique est élevée et proche de 1, plus la séquence est proche du centre de classe et <q>caractéristique</q> de la classe. On peut utiliser cette métrique pour classer les séquences sur le tapis de séquences.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" title="1">large_m18<span class="op">$</span>sil &lt;-<span class="st"> </span><span class="kw">wcSilhouetteObs</span>(dist_m18, large_m18<span class="op">$</span>typo_pam)</a>
<a class="sourceLine" id="cb77-2" title="2"><span class="kw">seqIplot</span>(seq_m18, <span class="dt">group =</span> large_m18<span class="op">$</span>typo_pam, <span class="dt">sortv =</span> large_m18<span class="op">$</span>sil)</a></code></pre></div>
<p><img src="graphs/trajectoires-de-soins/unnamed-chunk-36-1.png" width="1050" /></p>
<p>Nous voyons émerger quatre groupes distincts :</p>
<ul>
<li>les <em>rapides</em>, qui entrent en soins et initient le traitement dès les premiers mois suivant le diagnostic ;</li>
<li>les <em>lents</em>, qui entrent en soins et initient le traitement plus tardivement, après M6 ;</li>
<li>les <em>inaboutis</em>, qui entrent en soins mais n’initient pas le traitement ;</li>
<li>les <em>hors soins</em>, qui ne sont pas entrés en soins où n’y sont pas restés.</li>
</ul>
<p>Le graphique obtenu avec <code data-pkg="TraMineR" data-rdoc="seqplot">seqIplot</code> affiche visuellement chaque groupe avec la même hauteur, pouvant laisser accroire que chaque groupe a le même poids dans l’échantillon. Pour produire une représentation graphique des tapis de séquences plus <q>correcte</q>, où chaque la hauteur de chaque groupe correspondrait à son poids dans l’échantillon, nous allons passer par <code class="pkg">ggplot2</code>. Un tapis de séquences peut-être vu comme un <q>raster</q> et dès lors représenté avec <code data-pkg="ggplot2">geom_raster</code>. Pour travailler avec <code class="pkg">ggplot2</code>, nos données doivent être au format <em>tidy</em>, c’est-à-dire avec une ligne par point d’observation, soit une ligne par personne et par jour. Nous allons donc repartir du fichier <code>care_trajectories</code>. Le mois d’observation indiquera la position en abscisse. Quant à la position en ordonnée, il faudra que nous la calculions, séparément pour chaque groupe, afin d’éviter des <q>lignes vides</q> dans le graphique.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb78-1" title="1"><span class="co"># nommer les groupes</span></a>
<a class="sourceLine" id="cb78-2" title="2">large_m18<span class="op">$</span>groupe &lt;-<span class="st"> </span><span class="kw">factor</span>(</a>
<a class="sourceLine" id="cb78-3" title="3">  large_m18<span class="op">$</span>typo_pam,</a>
<a class="sourceLine" id="cb78-4" title="4">  <span class="kw">c</span>(<span class="dv">85</span>, <span class="dv">23</span>, <span class="dv">410</span>, <span class="dv">6</span>),</a>
<a class="sourceLine" id="cb78-5" title="5">  <span class="kw">c</span>(<span class="st">&quot;Rapides&quot;</span>, <span class="st">&quot;Lents&quot;</span>, <span class="st">&quot;Inaboutis&quot;</span>, <span class="st">&quot;Hors soins&quot;</span>)</a>
<a class="sourceLine" id="cb78-6" title="6">)</a>
<a class="sourceLine" id="cb78-7" title="7"></a>
<a class="sourceLine" id="cb78-8" title="8"><span class="co"># calculer le rang des individus dans chaque groupe</span></a>
<a class="sourceLine" id="cb78-9" title="9"><span class="kw">setorder</span>(large_m18, <span class="st">&quot;ordre_cmd&quot;</span>)</a>
<a class="sourceLine" id="cb78-10" title="10">large_m18[, rang_cmd <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="dv">1</span><span class="op">:</span>.N, by =<span class="st"> </span>groupe]</a>
<a class="sourceLine" id="cb78-11" title="11"></a>
<a class="sourceLine" id="cb78-12" title="12"><span class="co"># créer un fichier long</span></a>
<a class="sourceLine" id="cb78-13" title="13">long_m18 &lt;-<span class="st"> </span>care_trajectories[id <span class="op">%in%</span><span class="st"> </span>large_m18<span class="op">$</span>id <span class="op">&amp;</span><span class="st"> </span>month <span class="op">&lt;=</span><span class="st"> </span><span class="dv">18</span>]</a>
<a class="sourceLine" id="cb78-14" title="14">long_m18 &lt;-<span class="st"> </span><span class="kw">merge</span>(</a>
<a class="sourceLine" id="cb78-15" title="15">  long_m18,</a>
<a class="sourceLine" id="cb78-16" title="16">  large_m18[, .(id, groupe, rang_cmd)],</a>
<a class="sourceLine" id="cb78-17" title="17">  <span class="dt">by =</span> <span class="st">&quot;id&quot;</span>,</a>
<a class="sourceLine" id="cb78-18" title="18">  <span class="dt">all.x =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb78-19" title="19">)</a>
<a class="sourceLine" id="cb78-20" title="20">long_m18<span class="op">$</span>care_statusF &lt;-<span class="st"> </span><span class="kw">to_factor</span>(long_m18<span class="op">$</span>care_status)</a>
<a class="sourceLine" id="cb78-21" title="21"></a>
<a class="sourceLine" id="cb78-22" title="22"><span class="co"># calculer les effectifs par groupe</span></a>
<a class="sourceLine" id="cb78-23" title="23">tmp &lt;-<span class="st"> </span>large_m18[, .(<span class="dt">n =</span> .N), by =<span class="st"> </span>groupe]</a>
<a class="sourceLine" id="cb78-24" title="24">tmp[, groupe_n <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">paste0</span>(groupe, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">(n=&quot;</span>, n, <span class="st">&quot;)&quot;</span>)]</a>
<a class="sourceLine" id="cb78-25" title="25">long_m18 &lt;-<span class="st"> </span><span class="kw">merge</span>(</a>
<a class="sourceLine" id="cb78-26" title="26">  long_m18,</a>
<a class="sourceLine" id="cb78-27" title="27">  tmp[, .(groupe, groupe_n)],</a>
<a class="sourceLine" id="cb78-28" title="28">  <span class="dt">by =</span> <span class="st">&quot;groupe&quot;</span>,</a>
<a class="sourceLine" id="cb78-29" title="29">  <span class="dt">all.x =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb78-30" title="30">)</a></code></pre></div>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb79-1" title="1"><span class="co"># graphique des tapis de séquences</span></a>
<a class="sourceLine" id="cb79-2" title="2"><span class="kw">ggplot</span>(long_m18) <span class="op">+</span></a>
<a class="sourceLine" id="cb79-3" title="3"><span class="st">  </span><span class="kw">aes</span>(<span class="dt">x =</span> month, <span class="dt">y =</span> rang_cmd, <span class="dt">fill =</span> care_statusF) <span class="op">+</span></a>
<a class="sourceLine" id="cb79-4" title="4"><span class="st">  </span><span class="kw">geom_raster</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb79-5" title="5"><span class="st">  </span><span class="kw">facet_grid</span>(groupe_n <span class="op">~</span><span class="st"> </span>., <span class="dt">space =</span> <span class="st">&quot;free&quot;</span>, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb79-6" title="6"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">6</span><span class="op">*</span><span class="dv">3</span>, <span class="dt">labels =</span> <span class="kw">paste0</span>(<span class="st">&quot;M&quot;</span>, <span class="dv">0</span><span class="op">:</span><span class="dv">6</span><span class="op">*</span><span class="dv">3</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb79-7" title="7"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">5</span><span class="op">*</span><span class="dv">100</span>, <span class="dt">minor_breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb79-8" title="8"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb79-9" title="9"><span class="st">  </span><span class="kw">theme_light</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb79-10" title="10"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb79-11" title="11"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">fill =</span> <span class="st">&quot;Statut dans les soins&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb79-12" title="12"><span class="st">  </span><span class="kw">scale_fill_viridis</span>(<span class="dt">discrete =</span> <span class="ot">TRUE</span>, <span class="dt">direction =</span> <span class="dv">-1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb79-13" title="13"><span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="kw">guide_legend</span>(<span class="dt">nrow =</span> <span class="dv">2</span>))</a></code></pre></div>
<p><img src="graphs/trajectoires-de-soins/unnamed-chunk-38-1.png" width="1050" /></p>
</div>
<div id="facteurs-associés-à-lappartenance-à-chaque-groupe" class="section level2">
<h2>Facteurs associés à l’appartenance à chaque groupe</h2>
<p>Une fois les différents groupes de trajectoires identifiés, il est courant de vouloir regarder si certains facteurs influencent l’appartenance à un groupe plutôt qu’un autre. Dans nos données d’exemple, nous nous intéresserons aux variables suivantes : sexe, groupe d’âges et niveau d’éducation.</p>
<p>Ces différentes variables sont renseignées pour chaque mois dans le tableau de données <code>care_trajectories</code>, en tenant compte des éventuels changements au cours du temps. Ici, notre analyse est menée au niveau individuel. Nous allons donc récupérer la valeur de ces différentes variables au moment du diagnostic, à savoir à M0.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb80-1" title="1">large_m18 &lt;-<span class="st"> </span><span class="kw">merge</span>(</a>
<a class="sourceLine" id="cb80-2" title="2">  large_m18,</a>
<a class="sourceLine" id="cb80-3" title="3">  care_trajectories[</a>
<a class="sourceLine" id="cb80-4" title="4">    month <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, </a>
<a class="sourceLine" id="cb80-5" title="5">    .(id, sex, age, education)</a>
<a class="sourceLine" id="cb80-6" title="6">  ],</a>
<a class="sourceLine" id="cb80-7" title="7">  <span class="dt">by =</span> <span class="st">&quot;id&quot;</span>,</a>
<a class="sourceLine" id="cb80-8" title="8">  <span class="dt">all.x =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb80-9" title="9">)</a></code></pre></div>
<p>L’extension <code class="pkg">finalfit</code>, présentée dans le chapite sur la <a href="regression-logistique.html#tableaux-all-in-one">régression logistique</a>, permets via sa fonction <code data-pkg="finalfit">summary_factorlist</code> de produire rapidement le tableau de l’analyse bivariée. En l’occurence, le code ci-dessous permets de sortir les effectifs, les pourcentages en colonnes et les p-values correspondant au <dfn>test du Chi²</dfn><dfn data-index="Chi², test"></dfn>.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb81-1" title="1"><span class="kw">library</span>(finalfit, <span class="dt">quietly =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb81-2" title="2">explanatory &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;age&quot;</span>, <span class="st">&quot;education&quot;</span>)</a>
<a class="sourceLine" id="cb81-3" title="3">dependent &lt;-<span class="st"> &quot;groupe&quot;</span></a>
<a class="sourceLine" id="cb81-4" title="4">tab &lt;-<span class="st"> </span><span class="kw">summary_factorlist</span>(</a>
<a class="sourceLine" id="cb81-5" title="5">  <span class="kw">to_factor</span>(large_m18), dependent, explanatory,</a>
<a class="sourceLine" id="cb81-6" title="6">  <span class="dt">p=</span><span class="ot">TRUE</span>, <span class="dt">column =</span> <span class="ot">TRUE</span>, <span class="dt">total_col =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb81-7" title="7">)</a>
<a class="sourceLine" id="cb81-8" title="8">knitr<span class="op">::</span><span class="kw">kable</span>(tab, <span class="dt">row.names =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">label</th>
<th align="left">levels</th>
<th align="left">Rapides</th>
<th align="left">Lents</th>
<th align="left">Inaboutis</th>
<th align="left">Hors soins</th>
<th align="left">Total</th>
<th align="left">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Sexe</td>
<td align="left">homme</td>
<td align="left">104 (26.4)</td>
<td align="left">61 (29.0)</td>
<td align="left">42 (25.1)</td>
<td align="left">243 (44.5)</td>
<td align="left">450 (34.2)</td>
<td align="left">&lt;0.001</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">femme</td>
<td align="left">290 (73.6)</td>
<td align="left">149 (71.0)</td>
<td align="left">125 (74.9)</td>
<td align="left">303 (55.5)</td>
<td align="left">867 (65.8)</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Âge</td>
<td align="left">16-29</td>
<td align="left">96 (24.4)</td>
<td align="left">71 (33.8)</td>
<td align="left">62 (37.1)</td>
<td align="left">235 (43.0)</td>
<td align="left">464 (35.2)</td>
<td align="left">&lt;0.001</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">30-59</td>
<td align="left">269 (68.3)</td>
<td align="left">128 (61.0)</td>
<td align="left">91 (54.5)</td>
<td align="left">281 (51.5)</td>
<td align="left">769 (58.4)</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">60+</td>
<td align="left">29 (7.4)</td>
<td align="left">11 (5.2)</td>
<td align="left">14 (8.4)</td>
<td align="left">30 (5.5)</td>
<td align="left">84 (6.4)</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Education</td>
<td align="left">primaire</td>
<td align="left">63 (16.0)</td>
<td align="left">47 (22.4)</td>
<td align="left">30 (18.0)</td>
<td align="left">123 (22.5)</td>
<td align="left">263 (20.0)</td>
<td align="left">0.002</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">secondaire</td>
<td align="left">126 (32.0)</td>
<td align="left">83 (39.5)</td>
<td align="left">61 (36.5)</td>
<td align="left">212 (38.8)</td>
<td align="left">482 (36.6)</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">supérieur</td>
<td align="left">205 (52.0)</td>
<td align="left">80 (38.1)</td>
<td align="left">76 (45.5)</td>
<td align="left">211 (38.6)</td>
<td align="left">572 (43.4)</td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p>Une manière de présenter ces mêmes données de manière plus visuelle consiste à réaliser un <dfn data-index="diagramme en barres cumulées">diagramme en barres cumulées</dfn><dfn data-index="barres cumulées, diagramme en"></dfn> (voir le chapitre sur les <a href="graphiques-bivaries-ggplot2.html#diagrammes-en-barres">graphiques bivariés</a>). Ici, nous utilisons une boucle <code data-pkg="base" data-rdoc="Control">for</code> (voir le chapitre sur les <a href="structures-conditionnelles.html">structures conditionnelles</a>) pour calculer les différents tableaux croisés et les fusionner avec <code data-pkg="dplyr" data-rdoc="bind">bind_rows</code> (voir la section <a href="manipuler-les-donnees-avec-dplyr.html#concatenation">concaténation de tables</a> du chapitre dédié à <code class="pkg">dplyr</code>). Nous en profitions également pour calculer le test du Chi² et l’afficher avec le nom de la variable sur le graphique.</p>
<p>Note : pour afficher les proportions sur le graphique, aurons recours recours à la statistique <code data-pkg="JLutils">stat_prop</code> de l’extension <code class="pkg">JLutils</code><a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb82-1" title="1">res &lt;-<span class="st"> </span><span class="kw">tibble</span>()</a>
<a class="sourceLine" id="cb82-2" title="2">explanatory &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb82-3" title="3">  <span class="st">&quot;sex&quot;</span> =<span class="st"> &quot;Sexe&quot;</span>, </a>
<a class="sourceLine" id="cb82-4" title="4">  <span class="st">&quot;age&quot;</span> =<span class="st"> &quot;Âge&quot;</span>,</a>
<a class="sourceLine" id="cb82-5" title="5">  <span class="st">&quot;education&quot;</span> =<span class="st"> &quot;Education&quot;</span></a>
<a class="sourceLine" id="cb82-6" title="6">)</a>
<a class="sourceLine" id="cb82-7" title="7"><span class="cf">for</span> (v <span class="cf">in</span> <span class="kw">names</span>(explanatory)) {</a>
<a class="sourceLine" id="cb82-8" title="8">  tmp &lt;-<span class="st"> </span>tibble<span class="op">::</span><span class="kw">as_tibble</span>(<span class="kw">table</span>(large_m18<span class="op">$</span>groupe, <span class="kw">to_factor</span>(large_m18[[v]])), <span class="dt">.name_repair =</span> <span class="st">&quot;unique&quot;</span>)</a>
<a class="sourceLine" id="cb82-9" title="9">  <span class="kw">names</span>(tmp) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;groupe&quot;</span>, <span class="st">&quot;level&quot;</span>, <span class="st">&quot;n&quot;</span>)</a>
<a class="sourceLine" id="cb82-10" title="10">  test &lt;-<span class="st"> </span><span class="kw">chisq.test</span>(large_m18<span class="op">$</span>groupe, <span class="kw">to_factor</span>(large_m18[[v]]))</a>
<a class="sourceLine" id="cb82-11" title="11">  tmp<span class="op">$</span>var &lt;-<span class="st"> </span><span class="kw">paste0</span>(</a>
<a class="sourceLine" id="cb82-12" title="12">    explanatory[v],</a>
<a class="sourceLine" id="cb82-13" title="13">    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb82-14" title="14">    scales<span class="op">::</span><span class="kw">pvalue</span>(test<span class="op">$</span>p.value, <span class="dt">add_p =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb82-15" title="15">  )</a>
<a class="sourceLine" id="cb82-16" title="16">  res &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(res, tmp)</a>
<a class="sourceLine" id="cb82-17" title="17">}</a>
<a class="sourceLine" id="cb82-18" title="18"></a>
<a class="sourceLine" id="cb82-19" title="19"></a>
<a class="sourceLine" id="cb82-20" title="20"><span class="co"># stat_prop() a besoin d&#39;un facteur</span></a>
<a class="sourceLine" id="cb82-21" title="21">res<span class="op">$</span>level &lt;-<span class="st"> </span><span class="kw">factor</span>(res<span class="op">$</span>level)</a>
<a class="sourceLine" id="cb82-22" title="22"></a>
<a class="sourceLine" id="cb82-23" title="23"><span class="kw">library</span>(JLutils)</a>
<a class="sourceLine" id="cb82-24" title="24"><span class="kw">ggplot</span>(res) <span class="op">+</span></a>
<a class="sourceLine" id="cb82-25" title="25"><span class="st">  </span><span class="kw">aes</span>(<span class="dt">x =</span> level, <span class="dt">fill =</span> groupe, <span class="dt">weight =</span> n) <span class="op">+</span></a>
<a class="sourceLine" id="cb82-26" title="26"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">position =</span> <span class="st">&quot;fill&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb82-27" title="27"><span class="st">  </span><span class="kw">geom_text</span>(</a>
<a class="sourceLine" id="cb82-28" title="28">    <span class="kw">aes</span>(<span class="dt">by =</span> level, <span class="dt">label =</span> scales<span class="op">::</span><span class="kw">percent</span>(..prop.., <span class="dt">accuracy =</span> <span class="dv">1</span>)), </a>
<a class="sourceLine" id="cb82-29" title="29">    <span class="dt">stat =</span> <span class="st">&quot;prop&quot;</span>, <span class="dt">position =</span> <span class="kw">position_fill</span>(.<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb82-30" title="30">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb82-31" title="31"><span class="st">  </span><span class="kw">facet_grid</span>(var <span class="op">~</span><span class="st"> </span>., <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="dt">space =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb82-32" title="32"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>percent, <span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">5</span><span class="op">/</span><span class="dv">5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb82-33" title="33"><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb82-34" title="34"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb82-35" title="35"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">fill =</span> <span class="st">&quot;&quot;</span>)</a></code></pre></div>
<p><img src="graphs/trajectoires-de-soins/unnamed-chunk-41-1.png" width="900" /></p>
<p>Pour mieux visualiser les relations entre les variables, on peut avoir recours à la fonction <code data-pkg="JLutils">ggcross</code> de l’extension <code class="pkg">JLutils</code> qui permets de représenter les <dfn data-index="résidus, test du Chi²">résidus du Chi²</dfn><dfn data-index="test du Chi², résidus"></dfn><dfn data-index="Chi², résidus">.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb83-1" title="1"><span class="kw">library</span>(JLutils)</a>
<a class="sourceLine" id="cb83-2" title="2"><span class="kw">ggcross</span>(</a>
<a class="sourceLine" id="cb83-3" title="3">  sex <span class="op">+</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>education <span class="op">~</span><span class="st"> </span>groupe,</a>
<a class="sourceLine" id="cb83-4" title="4">  <span class="dt">data =</span> <span class="kw">to_factor</span>(large_m18),</a>
<a class="sourceLine" id="cb83-5" title="5">  <span class="dt">labels =</span> <span class="st">&quot;percent0(col.prop)&quot;</span>,</a>
<a class="sourceLine" id="cb83-6" title="6">  <span class="dt">fill_breaks =</span> <span class="kw">c</span>(<span class="op">-</span><span class="ot">Inf</span>, <span class="dv">-4</span>, <span class="dv">-2</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="ot">Inf</span>),</a>
<a class="sourceLine" id="cb83-7" title="7">  <span class="dt">fill_title =</span> <span class="st">&quot;Résidus de Pearson&quot;</span>,</a>
<a class="sourceLine" id="cb83-8" title="8">  <span class="dt">size =</span> <span class="ot">NULL</span></a>
<a class="sourceLine" id="cb83-9" title="9">) <span class="op">+</span></a>
<a class="sourceLine" id="cb83-10" title="10"><span class="st">  </span><span class="kw">theme_minimal</span>()</a></code></pre></div>
<p><img src="graphs/trajectoires-de-soins/unnamed-chunk-42-1.png" width="900" /></p>
<p>On peut ainsi noter que les hommes, les jeunes et ceux vivant à plus de 10 kilomètres d’une clinique sont plus souvent dans le groupe <q>Hors soins</q>. Inversement, les femmes et les plus éduqués sont plus souvent dans le groupe des <q>Rapides</q>. Résultat inattendu, les ménages les plus riches sont moins souvent dans les groupes ayant initiés un traitement (<q>Rapides</q> et <q>Lents</q>), ce résultat pouvant s’expliquer en partie par le fait que les plus aisés peuvent plus facilement accéder à des soins dans le secteur privé, et donc <q>faussement</q> apparaître <q>Hors soins<q>, car seuls les soins reçus dans le secteur public ont été mesurés dans cette étude.</p>
<p>Pour affiner les résultats, on aura recours à un modèle multivarié en exécutant une <dfn>régression logistique multinomiale</dfn><dfn data-index="multinomiale, régression logistique"></dfn> avec <code data-pkg="&quot;nnet">multinom</code> de l’extension <code class="pkg">nnet</code> (pour plus de détails, voir le <a href="regression-logistique.html#regression-logistique-multinomiale">chapitre dédié</a>).</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb84-1" title="1"><span class="kw">library</span>(nnet)</a>
<a class="sourceLine" id="cb84-2" title="2">large_m18<span class="op">$</span>groupe2 &lt;-<span class="st"> </span><span class="kw">relevel</span>(large_m18<span class="op">$</span>groupe, <span class="st">&quot;Hors soins&quot;</span>)</a>
<a class="sourceLine" id="cb84-3" title="3">regm &lt;-<span class="st"> </span><span class="kw">multinom</span>(</a>
<a class="sourceLine" id="cb84-4" title="4">  groupe2 <span class="op">~</span><span class="st"> </span>sex <span class="op">+</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>education, </a>
<a class="sourceLine" id="cb84-5" title="5">  <span class="dt">data =</span> <span class="kw">to_factor</span>(large_m18)</a>
<a class="sourceLine" id="cb84-6" title="6">)</a></code></pre></div>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb85-1" title="1">tmp &lt;-<span class="st"> </span>JLutils<span class="op">::</span><span class="kw">tidy_detailed</span>(regm, <span class="dt">exponentiate =</span> T, <span class="dt">conf.int =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb85-2" title="2">tmp &lt;-<span class="st"> </span>tmp[tmp<span class="op">$</span>term <span class="op">!=</span><span class="st"> &quot;(Intercept)&quot;</span>, ]</a>
<a class="sourceLine" id="cb85-3" title="3"><span class="kw">ggplot</span>(tmp) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb85-4" title="4"><span class="st">  </span><span class="kw">aes</span>(<span class="dt">x =</span> label, <span class="dt">y =</span> estimate, <span class="dt">ymin =</span> conf.low, <span class="dt">ymax =</span> conf.high, <span class="dt">color =</span> y.level) <span class="op">+</span></a>
<a class="sourceLine" id="cb85-5" title="5"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">1</span>, <span class="dt">color =</span> <span class="st">&quot;gray25&quot;</span>, <span class="dt">linetype =</span> <span class="st">&quot;dotted&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb85-6" title="6"><span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="fl">0.5</span>), <span class="dt">width =</span> <span class="dv">0</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb85-7" title="7"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width =</span> <span class="fl">0.5</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb85-8" title="8"><span class="st">  </span><span class="kw">scale_y_log10</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb85-9" title="9"><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb85-10" title="10"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Facteurs&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Odds Ratios&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb85-11" title="11"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">color =</span> <span class="st">&quot;vs. Hors Soins&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb85-12" title="12"><span class="st">  </span><span class="kw">theme_light</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb85-13" title="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid.major.y =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="graphs/trajectoires-de-soins/unnamed-chunk-44-1.png" width="900" /></p>
<p>Nous pouvons représenter les effets des variables du modèle avec la fonction <code data-pkg="&quot;ggeffects">ggeffect</code> de <code class="pkg">ggeffects</code>.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb86-1" title="1"><span class="kw">library</span>(ggeffects)</a>
<a class="sourceLine" id="cb86-2" title="2">cowplot<span class="op">::</span><span class="kw">plot_grid</span>(<span class="dt">plotlist =</span> <span class="kw">plot</span>(<span class="kw">ggeffect</span>(regm)), <span class="dt">ncol =</span> <span class="dv">3</span>)</a></code></pre></div>
<p><img src="graphs/trajectoires-de-soins/unnamed-chunk-45-1.png" width="1800" /></p>
</div>
<div id="modèle-mixte-à-classes-latentes" class="section level2">
<h2>Modèle mixte à classes latentes</h2>
<p>Un autre type d’approche envisageable pour identifier des classes de trajectoires est celle des <dfn data-index="modèle mixte à classes latentes">modèles mixtes à classes latentes</dfn><dfn data-index="mixte, modèle mixte à classes latentes"></dfn><dfn data-index="classes latentes, modèle mixte"></dfn><dfn data-index="latente, modèle mixte à classes latentes"></dfn>. Ce type de modèles peut prendre en compte une grande variété d’indicateurs, continus, binaires ou ordinaux. On peut y intégrer des co-variables et il n’est pas nécessaire de disposer du même nombre d’observations par individu.</p>
<p>Nous n’aborderons que brièvement ici ce type de modèles complexes. Sous <strong>R</strong>, ils peuvent être réalisés via l’extension <code class="pkg">lcmm</code> et sa fonction homonyme <code data-pkg="lcmm">lcmm</code>.</p>
<p>Commençons par préparer les données.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb87-1" title="1">care_trajectories<span class="op">$</span>num_status &lt;-<span class="st"> </span><span class="kw">as.integer</span>(<span class="kw">to_factor</span>(care_trajectories<span class="op">$</span>care_status))</a>
<a class="sourceLine" id="cb87-2" title="2">care_trajectories[, sexF <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">to_factor</span>(sex)]</a>
<a class="sourceLine" id="cb87-3" title="3">care_trajectories[, ageF <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">to_factor</span>(age)]</a>
<a class="sourceLine" id="cb87-4" title="4">care_trajectories[, educationF <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">to_factor</span>(education)]</a></code></pre></div>
<p>Ici, nous allons modéliser le statut dans les soins en fonction du temps. Il faut indiquer au modèle, via le paramètre <code>ng</code> le nombre de groupes ou classes latentes souhaité. Ici, nous avons retenu 4 en lien avec les résultats de notre analyse de séquences. L’argument <code>link = "thresholds"</code> permets d’indiquer que notre variable d’intérêt est ordinale. Les modèles <code data-pkg="lcmm">lcmm</code> peuvent également prendre en compte des variables continues.</p>
<p><strong>Attention :</strong> le temps de calcul de ce type de modèle peut être long (plusieurs heures dans notre exemple), suivant le nombre de paramètres, le nombre d’observations et la puissance de votre machine.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb88-1" title="1"><span class="kw">library</span>(lcmm)</a>
<a class="sourceLine" id="cb88-2" title="2">mod4 &lt;-<span class="kw">lcmm</span>(</a>
<a class="sourceLine" id="cb88-3" title="3">  num_status <span class="op">~</span><span class="st"> </span>month, <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span>month, <span class="dt">subject =</span> <span class="st">&#39;id&#39;</span>, </a>
<a class="sourceLine" id="cb88-4" title="4">  <span class="dt">mixture =</span> <span class="op">~</span><span class="st"> </span>month, <span class="dt">ng =</span> <span class="dv">4</span>, <span class="dt">idiag =</span> <span class="ot">TRUE</span>, <span class="dt">data =</span> care_trajectories, </a>
<a class="sourceLine" id="cb88-5" title="5">  <span class="dt">link =</span> <span class="st">&quot;thresholds&quot;</span></a>
<a class="sourceLine" id="cb88-6" title="6">)</a></code></pre></div>
<p>Voyons comment se présentent les résultats.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb89-1" title="1"><span class="kw">summary</span>(mod4)</a></code></pre></div>
<pre><code>General latent class mixed model 
     fitted by maximum likelihood method 
 
lcmm(fixed = num_status ~ month, mixture = ~month, random = ~month, 
    subject = &quot;id&quot;, ng = 4, idiag = TRUE, link = &quot;thresholds&quot;, 
    data = care_trajectories)
 
Statistical Model: 
     Dataset: care_trajectories 
     Number of subjects: 2929 
     Number of observations: 49365 
     Number of latent classes: 4 
     Number of parameters: 15  
     Link function: thresholds  
 
Iteration process: 
     Convergence criteria satisfied 
     Number of iterations:  52 
     Convergence criteria: parameters= 5.2e-10 
                         : likelihood= 5.4e-07 
                         : second derivatives= 3.5e-07 
 
Goodness-of-fit statistics: 
     maximum log-likelihood: -26612.74  
     AIC: 53255.48  
     BIC: 53345.22  
 
     Discrete posterior log-likelihood: -26612.74  
     Discrete AIC: 53255.48  
 
     Mean discrete AIC per subject: 9.0911  
     Mean UACV per subject: 9.1045  
     Mean discrete LL per subject: -9.0859  
 
Maximum Likelihood Estimates: 
 
Fixed effects in the class-membership model:
(the class of reference is the last class) 

                     coef      Se    Wald p-value
intercept class1  0.00832 0.04503   0.185 0.85334
intercept class2 -0.42002 0.12990  -3.233 0.00122
intercept class3 -0.02992 0.09675  -0.309 0.75712

Fixed effects in the longitudinal model:

                                     coef      Se    Wald
intercept class1 (not estimated)        0                
intercept class2                 -1.49825 0.08163 -18.355
intercept class3                 -0.41418 0.05228  -7.923
intercept class4                 -2.50344 0.09211 -27.179
month class1                      0.21757 0.00332  65.447
month class2                      0.01032 0.00506   2.039
month class3                      0.17720 0.00338  52.373
month class4                      0.00449 0.00512   0.876
                                 p-value
intercept class1 (not estimated)        
intercept class2                 0.00000
intercept class3                 0.00000
intercept class4                 0.00000
month class1                     0.00000
month class2                     0.04142
month class3                     0.00000
month class4                     0.38090


Variance-covariance matrix of the random-effects:
          intercept  month
intercept     4.395       
month         0.000 0.1265

Residual standard error (not estimated) = 1

Parameters of the link function:

                  coef      Se    Wald p-value
thresh. parm1  0.94803 0.04753  19.945 0.00000
thresh. parm2  1.10727 0.00652 169.922 0.00000
thresh. parm3  1.08980 0.00727 149.816 0.00000</code></pre>
<p>On dispose d’un AIC et d’un BIC. Ainsi, une stratégie possible pour déterminer le nombre de classes consiste à calculer un modèle différent pour chaque nombre de classes envisagé puis à retenir le modèle ayant le plus faible AIC ou BIC.</p>
<p>Pour chaque observation, le modèle a calculé la probabilité qu’elle appartienne à chacune des 4 classes identifiées. La fonction <code data-pkg="lcmm">postprob</code> fournit des statistiques sur cette classification.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb91-1" title="1"><span class="kw">postprob</span>(mod4)</a></code></pre></div>
<pre><code> 
Posterior classification: 
  class1 class2 class3  class4
N 844.00 153.00 424.00 1508.00
%  28.82   5.22  14.48   51.49
 
Posterior classification table: 
     --&gt; mean of posterior probabilities in each class 
        prob1  prob2  prob3  prob4
class1 0.5945 0.0735 0.2476 0.0844
class2 0.0924 0.7257 0.0881 0.0938
class3 0.1576 0.1103 0.6561 0.0760
class4 0.1522 0.2052 0.1865 0.4561
 
Posterior probabilities above a threshold (%): 
         class1 class2 class3 class4
prob&gt;0.7  23.58  54.90  38.68   6.90
prob&gt;0.8  15.88  48.37  30.19   4.97
prob&gt;0.9  11.26  33.99  21.93   3.51
 </code></pre>
<p>Les classes et les probabilités d’appartenance à chacune sont disponibles aisément.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb93-1" title="1"><span class="kw">head</span>(mod4<span class="op">$</span>pprob)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">id</th>
<th align="right">class</th>
<th align="right">prob1</th>
<th align="right">prob2</th>
<th align="right">prob3</th>
<th align="right">prob4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">3</td>
<td align="right">4</td>
<td align="right">0.1687</td>
<td align="right">0.2219</td>
<td align="right">0.2016</td>
<td align="right">0.4079</td>
</tr>
<tr class="even">
<td align="right">9</td>
<td align="right">4</td>
<td align="right">0.2124</td>
<td align="right">0.2052</td>
<td align="right">0.2329</td>
<td align="right">0.3495</td>
</tr>
<tr class="odd">
<td align="right">13</td>
<td align="right">4</td>
<td align="right">0.1590</td>
<td align="right">0.2260</td>
<td align="right">0.1880</td>
<td align="right">0.4270</td>
</tr>
<tr class="even">
<td align="right">15</td>
<td align="right">1</td>
<td align="right">0.9992</td>
<td align="right">0.0000</td>
<td align="right">0.0000</td>
<td align="right">0.0008</td>
</tr>
<tr class="odd">
<td align="right">18</td>
<td align="right">1</td>
<td align="right">0.5616</td>
<td align="right">0.0473</td>
<td align="right">0.3479</td>
<td align="right">0.0432</td>
</tr>
<tr class="even">
<td align="right">21</td>
<td align="right">4</td>
<td align="right">0.1687</td>
<td align="right">0.2219</td>
<td align="right">0.2016</td>
<td align="right">0.4079</td>
</tr>
</tbody>
</table>
<p>Récupérons la classe dans notre fichier de données.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb94-1" title="1">care_trajectories &lt;-<span class="st"> </span><span class="kw">merge</span>(</a>
<a class="sourceLine" id="cb94-2" title="2">  care_trajectories,</a>
<a class="sourceLine" id="cb94-3" title="3">  mod4<span class="op">$</span>pprob <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(id, <span class="dt">mod4_class =</span> class),</a>
<a class="sourceLine" id="cb94-4" title="4">  <span class="dt">by =</span> <span class="st">&quot;id&quot;</span>,</a>
<a class="sourceLine" id="cb94-5" title="5">  <span class="dt">all.x =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb94-6" title="6">)</a></code></pre></div>
<p>Améliorons les intitulés des classes et ajoutons le nombre d’individu par classes.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb95-1" title="1">n_par_classe &lt;-<span class="st"> </span><span class="kw">table</span>(mod4<span class="op">$</span>pprob<span class="op">$</span>class)</a>
<a class="sourceLine" id="cb95-2" title="2">n_par_classe</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">1</th>
<th align="right">2</th>
<th align="right">3</th>
<th align="right">4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">844</td>
<td align="right">153</td>
<td align="right">424</td>
<td align="right">1508</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb96-1" title="1">care_trajectories<span class="op">$</span>mod4_class2 &lt;-<span class="st"> </span><span class="kw">factor</span>(</a>
<a class="sourceLine" id="cb96-2" title="2">  care_trajectories<span class="op">$</span>mod4_class,</a>
<a class="sourceLine" id="cb96-3" title="3">  <span class="dt">levels =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,</a>
<a class="sourceLine" id="cb96-4" title="4">  <span class="dt">labels =</span> <span class="kw">paste0</span>(</a>
<a class="sourceLine" id="cb96-5" title="5">    <span class="st">&quot;Classe &quot;</span>,</a>
<a class="sourceLine" id="cb96-6" title="6">    <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,</a>
<a class="sourceLine" id="cb96-7" title="7">    <span class="st">&quot; (n=&quot;</span>,</a>
<a class="sourceLine" id="cb96-8" title="8">    n_par_classe,</a>
<a class="sourceLine" id="cb96-9" title="9">    <span class="st">&quot;)&quot;</span></a>
<a class="sourceLine" id="cb96-10" title="10">  )</a>
<a class="sourceLine" id="cb96-11" title="11">)</a></code></pre></div>
<p>Représentons la cascade observée dans chacune de ces classes.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb97-1" title="1">care_trajectories<span class="op">$</span>care_statusF &lt;-<span class="st"> </span><span class="kw">to_factor</span>(care_trajectories<span class="op">$</span>care_status)</a>
<a class="sourceLine" id="cb97-2" title="2"><span class="kw">ggplot</span>(care_trajectories[month <span class="op">&lt;=</span><span class="st"> </span><span class="dv">36</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb97-3" title="3"><span class="st">  </span><span class="kw">aes</span>(<span class="dt">x =</span> month, <span class="dt">fill =</span> care_statusF) <span class="op">+</span></a>
<a class="sourceLine" id="cb97-4" title="4"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">color =</span> <span class="st">&quot;gray50&quot;</span>, <span class="dt">width =</span> <span class="dv">1</span>, <span class="dt">position =</span> <span class="st">&quot;fill&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb97-5" title="5"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">6</span><span class="op">*</span><span class="dv">6</span>, <span class="dt">labels =</span> <span class="kw">paste0</span>(<span class="st">&quot;M&quot;</span>, <span class="dv">0</span><span class="op">:</span><span class="dv">6</span><span class="op">*</span><span class="dv">6</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb97-6" title="6"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>percent) <span class="op">+</span></a>
<a class="sourceLine" id="cb97-7" title="7"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb97-8" title="8"><span class="st">  </span><span class="kw">theme_light</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb97-9" title="9"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb97-10" title="10"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">fill =</span> <span class="st">&quot;Statut dans les soins&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb97-11" title="11"><span class="st">  </span><span class="kw">scale_fill_viridis</span>(<span class="dt">discrete =</span> <span class="ot">TRUE</span>, <span class="dt">direction =</span> <span class="dv">-1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb97-12" title="12"><span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="kw">guide_legend</span>(<span class="dt">nrow =</span> <span class="dv">2</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb97-13" title="13"><span class="st">  </span><span class="kw">facet_grid</span>(<span class="op">~</span><span class="st"> </span>mod4_class2)</a></code></pre></div>
<p><img src="graphs/trajectoires-de-soins/unnamed-chunk-54-1.png" width="1500" /></p>
<p>Une manière alternative de présenter les classes consiste à représenter chaque mois, non pas la distribution dans chaque état, mais un <q>état moyen</q> en considérant que le statut dans les soins peut être assimilé à un score allant de 1 à 4.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb98-1" title="1">moyennes_mensuelles &lt;-<span class="st"> </span>care_trajectories[</a>
<a class="sourceLine" id="cb98-2" title="2">  month <span class="op">&lt;=</span><span class="st"> </span><span class="dv">36</span>, </a>
<a class="sourceLine" id="cb98-3" title="3">  .(<span class="dt">status_moyen =</span> <span class="kw">mean</span>(num_status)), </a>
<a class="sourceLine" id="cb98-4" title="4">  by =<span class="st"> </span>.(month, mod4_class2)</a>
<a class="sourceLine" id="cb98-5" title="5">]</a></code></pre></div>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb99-1" title="1"><span class="kw">ggplot</span>(moyennes_mensuelles) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb99-2" title="2"><span class="st">  </span><span class="kw">aes</span>(<span class="dt">x =</span> month, <span class="dt">y =</span> status_moyen, <span class="dt">color =</span> mod4_class2) <span class="op">+</span></a>
<a class="sourceLine" id="cb99-3" title="3"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb99-4" title="4"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">6</span><span class="op">*</span><span class="dv">6</span>, <span class="dt">labels =</span> <span class="kw">paste0</span>(<span class="st">&quot;M&quot;</span>, <span class="dv">0</span><span class="op">:</span><span class="dv">6</span><span class="op">*</span><span class="dv">6</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb99-5" title="5"><span class="st">  </span><span class="kw">scale_y_continuous</span>(</a>
<a class="sourceLine" id="cb99-6" title="6">    <span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">4</span>),</a>
<a class="sourceLine" id="cb99-7" title="7">    <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;diagnostiqué&quot;</span>, <span class="st">&quot;suivi&quot;</span>, <span class="st">&quot;sous traitement&quot;</span>, <span class="st">&quot;contrôlé&quot;</span>)</a>
<a class="sourceLine" id="cb99-8" title="8">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb99-9" title="9"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Statut moyen&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">color =</span> <span class="st">&quot;&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb99-10" title="10"><span class="st">  </span><span class="kw">theme_classic</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb99-11" title="11"><span class="st">  </span><span class="kw">theme</span>(</a>
<a class="sourceLine" id="cb99-12" title="12">    <span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>, </a>
<a class="sourceLine" id="cb99-13" title="13">    <span class="dt">panel.grid.major =</span> <span class="kw">element_line</span>(<span class="dt">colour =</span> <span class="st">&quot;grey80&quot;</span>)</a>
<a class="sourceLine" id="cb99-14" title="14">  )</a></code></pre></div>
<p><img src="graphs/trajectoires-de-soins/unnamed-chunk-56-1.png" width="1050" /></p>
<p>Il faut cependant rester vigilant, dans la mesure où ce type de représentation synthétique peut masquer la diversité des trajectoires sous-jacentes, notamment en termes de durée ou d’enchaînement des événements. Même si cela est peut-être plus difficile à lire, il est toujours bon de regarder les tapis de séquences.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb100-1" title="1">care_trajectories[, tmp_rang <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">as.integer</span>(<span class="kw">fct_infreq</span>(<span class="kw">factor</span>(id))), by =<span class="st"> </span>mod4_class]</a></code></pre></div>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb101-1" title="1"><span class="kw">ggplot</span>(care_trajectories[month <span class="op">&lt;=</span><span class="st"> </span><span class="dv">36</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb101-2" title="2"><span class="st">  </span><span class="kw">aes</span>(<span class="dt">x =</span> month, <span class="dt">y =</span> tmp_rang, <span class="dt">fill =</span> care_statusF) <span class="op">+</span></a>
<a class="sourceLine" id="cb101-3" title="3"><span class="st">  </span><span class="kw">geom_raster</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb101-4" title="4"><span class="st">  </span><span class="kw">facet_grid</span>(mod4_class2 <span class="op">~</span><span class="st"> </span>., <span class="dt">space =</span> <span class="st">&quot;free&quot;</span>, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb101-5" title="5"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">6</span><span class="op">*</span><span class="dv">6</span>, <span class="dt">labels =</span> <span class="kw">paste0</span>(<span class="st">&quot;M&quot;</span>, <span class="dv">0</span><span class="op">:</span><span class="dv">6</span><span class="op">*</span><span class="dv">6</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb101-6" title="6"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">5</span><span class="op">*</span><span class="dv">200</span>, <span class="dt">minor_breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb101-7" title="7"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb101-8" title="8"><span class="st">  </span><span class="kw">theme_light</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb101-9" title="9"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb101-10" title="10"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">fill =</span> <span class="st">&quot;Statut dans les soins&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb101-11" title="11"><span class="st">  </span><span class="kw">scale_fill_viridis</span>(<span class="dt">discrete =</span> <span class="ot">TRUE</span>, <span class="dt">direction =</span> <span class="dv">-1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb101-12" title="12"><span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="kw">guide_legend</span>(<span class="dt">nrow =</span> <span class="dv">2</span>))</a></code></pre></div>
<p><img src="graphs/trajectoires-de-soins/unnamed-chunk-58-1.png" width="900" /></p>
</div>
<div id="modèle-à-observations-répétées" class="section level2">
<h2>Modèle à observations répétées</h2>
<p>Pour prendre en considération l’ensemble des observations présentes (sans se limiter aux individus observés au moins sur une certaine période), nous pouvons avoir recours à un <dfn>modèle à observations répétées</dfn><dfn data-index="observations répétées, modèle"></dfn>.</p>
<p>Il s’agit de modèles classiques sauf qu’au lieu de considérer une ligne par individu, nous allons intégrer dans le modèle une ligne par individu et par pas de temps. Dans la mesure où nous avons plusieurs observations pour une même personne, cela doit être pris en compte par l’ajout d’un <dfn>effet aléatoire</dfn><dfn data-index="aléatoire, effet"></dfn> dans le cadre d’un <dfn>modèle mixte</dfn><dfn data-index="mixte, modèle"></dfn> ou en ayant recours à un <dfn data-index="modèle GEE"></dfn><dfn data-index="GEE, modèle"></dfn> (voir le chapitre sur les <a href="modeles-a-effets-aleatoires.html">modèles à effets aléatoires</a>).</p>
<p>Vue la nature de notre variable d’intérêt (plusieurs modalités ordonnées), nous aurons recours à une <dfn>régression logistique ordinale</dfn><dfn data-index="ordinale, régression logistique"></dfn> (voir le <a href="regression-logistique.html#regression-logistique-ordinale">chapitre dédié</a>). Pour un modèle mixte ordinal on peut utiliser la fonction <code data-pkg="ordinal">clmm</code> de l’extension <code class="pkg">ordinal</code>. Pour un modèle GEE ordinal, citons <code data-pkg="geepack">ordgee</code> de l’extension <code class="pkg">geepack</code> ou encore <code data-pkg="multgee">ordLORgee</code> de <code class="pkg">multgee</code>. Il importe également que la dimension temporelle soit inclue dans les variables du modèle.</p>
<p>Ici, nous allons utiliser <code data-pkg="geepack">ordgee</code>. Il nous faut tout d’abord transformer notre variable d’intérêt en un facteur ordonné.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb102-1" title="1">care_trajectories[, care_statusF <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">to_factor</span>(care_status, <span class="dt">ordered =</span> <span class="ot">TRUE</span>)]</a></code></pre></div>
<p>Nous allons transformer nos variables explicatives en facteurs. Pour le temps, dans la mesure où sont effet n’est pas forcément linéaire, nous allons l’intégrer en tant que variable catégorielle. Par contre, comme nous n’avons que très peu d’observations individuelles après 3 ans, nous ne prendrons en compte que les observations des 36 premiers mois. Nous allons aussi retirer les observations à M0 puisqu’à ce moment précis tous les individus sont dans la même situation (diagnostiqués mais pas en soins.)</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb103-1" title="1">ct36 &lt;-<span class="st"> </span>care_trajectories[month <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>month <span class="op">&lt;=</span><span class="st"> </span><span class="dv">36</span>, ]</a>
<a class="sourceLine" id="cb103-2" title="2">ct36[, sexF <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">to_factor</span>(sex)]</a>
<a class="sourceLine" id="cb103-3" title="3">ct36[, ageF <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">to_factor</span>(age)]</a>
<a class="sourceLine" id="cb103-4" title="4">ct36[, educationF <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">to_factor</span>(education)]</a>
<a class="sourceLine" id="cb103-5" title="5">ct36[, monthF <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">to_factor</span>(month)]</a></code></pre></div>
<p>Calculons notre modèle.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb104-1" title="1"><span class="kw">library</span>(geepack)</a>
<a class="sourceLine" id="cb104-2" title="2">mod_td &lt;-<span class="st"> </span><span class="kw">ordgee</span>(</a>
<a class="sourceLine" id="cb104-3" title="3">  care_statusF <span class="op">~</span><span class="st"> </span>sexF <span class="op">+</span><span class="st"> </span>ageF <span class="op">+</span><span class="st"> </span>educationF <span class="op">+</span><span class="st"> </span>monthF,</a>
<a class="sourceLine" id="cb104-4" title="4">  <span class="dt">data =</span> ct36,</a>
<a class="sourceLine" id="cb104-5" title="5">  <span class="dt">id =</span> ct36<span class="op">$</span>id</a>
<a class="sourceLine" id="cb104-6" title="6">)</a></code></pre></div>
<p>Les coefficients du modèle s’obtiennent avec <code data-pkg="base">summary</code>. Malheureusement, il n’existe pas de <em>tieder</em> pour ce type de modèle. Nous allons donc procéder manuellement.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb105-1" title="1">res &lt;-<span class="st"> </span><span class="kw">summary</span>(mod_td)<span class="op">$</span>mean</a>
<a class="sourceLine" id="cb105-2" title="2">res<span class="op">$</span>term &lt;-<span class="st"> </span><span class="kw">rownames</span>(res)</a>
<a class="sourceLine" id="cb105-3" title="3"><span class="kw">head</span>(res)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th></th>
<th align="right">estimate</th>
<th align="right">san.se</th>
<th align="right">wald</th>
<th align="right">p</th>
<th align="left">term</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Inter:diagnostiqué, mais pas suivi</td>
<td align="right">-2.8570</td>
<td align="right">0.1272</td>
<td align="right">504.18</td>
<td align="right">0e+00</td>
<td align="left">Inter:diagnostiqué, mais pas suivi</td>
</tr>
<tr class="even">
<td>Inter:suivi, mais pas sous traitement</td>
<td align="right">-3.4248</td>
<td align="right">0.1289</td>
<td align="right">705.54</td>
<td align="right">0e+00</td>
<td align="left">Inter:suivi, mais pas sous traitement</td>
</tr>
<tr class="odd">
<td>Inter:sous traitement, mais infection non contrôlée</td>
<td align="right">-3.9464</td>
<td align="right">0.1320</td>
<td align="right">893.37</td>
<td align="right">0e+00</td>
<td align="left">Inter:sous traitement, mais infection non contrôlée</td>
</tr>
<tr class="even">
<td>sexFfemme</td>
<td align="right">0.7420</td>
<td align="right">0.0868</td>
<td align="right">73.11</td>
<td align="right">0e+00</td>
<td align="left">sexFfemme</td>
</tr>
<tr class="odd">
<td>ageF30-59</td>
<td align="right">0.5577</td>
<td align="right">0.0890</td>
<td align="right">39.26</td>
<td align="right">0e+00</td>
<td align="left">ageF30-59</td>
</tr>
<tr class="even">
<td>ageF60+</td>
<td align="right">0.7147</td>
<td align="right">0.1930</td>
<td align="right">13.71</td>
<td align="right">2e-04</td>
<td align="left">ageF60+</td>
</tr>
</tbody>
</table>
<p>Les intervalles de confiance à 95% ne sont pas déjà calculés. Faisons-le donc nous même.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb106-1" title="1">mult &lt;-<span class="st"> </span>stats<span class="op">::</span><span class="kw">qnorm</span>((<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="fl">.95</span>) <span class="op">/</span><span class="st"> </span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb106-2" title="2">res<span class="op">$</span>conf.low &lt;-<span class="st"> </span>res<span class="op">$</span>estimate <span class="op">-</span><span class="st"> </span>mult <span class="op">*</span><span class="st"> </span>res<span class="op">$</span>san.se</a>
<a class="sourceLine" id="cb106-3" title="3">res<span class="op">$</span>conf.high &lt;-<span class="st"> </span>res<span class="op">$</span>estimate <span class="op">+</span><span class="st"> </span>mult <span class="op">*</span><span class="st"> </span>res<span class="op">$</span>san.se</a></code></pre></div>
<p>Enfin, nous souhaitons disposer des <em>odds ratios</em> et non des coefficients bruts. Il faut avoir recours à la fonction <code data-pkg="base" data-rdoc="log">exp</code> (exponentielle).</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb107-1" title="1">res<span class="op">$</span>estimate &lt;-<span class="st"> </span><span class="kw">exp</span>(res<span class="op">$</span>estimate)</a>
<a class="sourceLine" id="cb107-2" title="2">res<span class="op">$</span>conf.low &lt;-<span class="st"> </span><span class="kw">exp</span>(res<span class="op">$</span>conf.low)</a>
<a class="sourceLine" id="cb107-3" title="3">res<span class="op">$</span>conf.high &lt;-<span class="st"> </span><span class="kw">exp</span>(res<span class="op">$</span>conf.high)</a></code></pre></div>
<p>Préparons un tableau avec les résultats. Pour le rendre plus lisible, nous allons mettre en forme les <em>odds ratios</em> avec une seule décimale. Améliorer le rendu des <em>p-values</em> et nous allons utiliser la virgule comme séparateur de décimal, comme il se doit. Nous aurons recours aux fonctions <code data-pkg="scales" data-rdoc="number_format">number</code> et <code data-pkg="scales" data-rdoc="pvalue_format">pvalue</code> de l’extension <code class="pkg">scales</code> (voir le chapitre sur la <a href="formater-nombres.html">mise en forme des nombres</a>).</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb108-1" title="1">tab &lt;-<span class="st"> </span>res <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb108-2" title="2"><span class="st">  </span><span class="kw">mutate</span> (</a>
<a class="sourceLine" id="cb108-3" title="3">    <span class="dt">estimate =</span> scales<span class="op">::</span><span class="kw">number</span>(estimate, <span class="dt">accuracy =</span> <span class="fl">.01</span>, <span class="dt">decimal.mark =</span> <span class="st">&quot;,&quot;</span>),</a>
<a class="sourceLine" id="cb108-4" title="4">    <span class="dt">p =</span> scales<span class="op">::</span><span class="kw">pvalue</span>(p, <span class="dt">decimal.mark =</span> <span class="st">&quot;,&quot;</span>),</a>
<a class="sourceLine" id="cb108-5" title="5">    <span class="dt">conf.low =</span> scales<span class="op">::</span><span class="kw">number</span>(conf.low, <span class="dt">accuracy =</span> <span class="fl">.1</span>, <span class="dt">decimal.mark =</span> <span class="st">&quot;,&quot;</span>),</a>
<a class="sourceLine" id="cb108-6" title="6">    <span class="dt">conf.high =</span> scales<span class="op">::</span><span class="kw">number</span>(conf.high, <span class="dt">accuracy =</span> <span class="fl">.1</span>, <span class="dt">decimal.mark =</span> <span class="st">&quot;,&quot;</span>)</a>
<a class="sourceLine" id="cb108-7" title="7">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb108-8" title="8"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(</a>
<a class="sourceLine" id="cb108-9" title="9">    <span class="dt">Facteur =</span> term, <span class="dt">OR =</span> estimate, <span class="st">&quot;p-value&quot;</span> =<span class="st"> </span>p, </a>
<a class="sourceLine" id="cb108-10" title="10">    <span class="st">&quot;IC 95% bas&quot;</span> =<span class="st"> </span>conf.low, <span class="st">&quot;IC 95% haut&quot;</span> =<span class="st"> </span>conf.high</a>
<a class="sourceLine" id="cb108-11" title="11">  )</a></code></pre></div>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb109-1" title="1">knitr<span class="op">::</span><span class="kw">kable</span>(tab, <span class="dt">row.names =</span> <span class="ot">FALSE</span>, <span class="dt">align =</span> <span class="st">&quot;lrrrr&quot;</span>)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">Facteur</th>
<th align="right">OR</th>
<th align="right">p-value</th>
<th align="right">IC 95% bas</th>
<th align="right">IC 95% haut</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Inter:diagnostiqué, mais pas suivi</td>
<td align="right">0,06</td>
<td align="right">&lt;0,001</td>
<td align="right">0,0</td>
<td align="right">0,1</td>
</tr>
<tr class="even">
<td align="left">Inter:suivi, mais pas sous traitement</td>
<td align="right">0,03</td>
<td align="right">&lt;0,001</td>
<td align="right">0,0</td>
<td align="right">0,0</td>
</tr>
<tr class="odd">
<td align="left">Inter:sous traitement, mais infection non contrôlée</td>
<td align="right">0,02</td>
<td align="right">&lt;0,001</td>
<td align="right">0,0</td>
<td align="right">0,0</td>
</tr>
<tr class="even">
<td align="left">sexFfemme</td>
<td align="right">2,10</td>
<td align="right">&lt;0,001</td>
<td align="right">1,8</td>
<td align="right">2,5</td>
</tr>
<tr class="odd">
<td align="left">ageF30-59</td>
<td align="right">1,75</td>
<td align="right">&lt;0,001</td>
<td align="right">1,5</td>
<td align="right">2,1</td>
</tr>
<tr class="even">
<td align="left">ageF60+</td>
<td align="right">2,04</td>
<td align="right">&lt;0,001</td>
<td align="right">1,4</td>
<td align="right">3,0</td>
</tr>
<tr class="odd">
<td align="left">educationFsecondaire</td>
<td align="right">1,17</td>
<td align="right">0,109</td>
<td align="right">1,0</td>
<td align="right">1,4</td>
</tr>
<tr class="even">
<td align="left">educationFsupérieur</td>
<td align="right">1,40</td>
<td align="right">0,002</td>
<td align="right">1,1</td>
<td align="right">1,7</td>
</tr>
<tr class="odd">
<td align="left">monthF2</td>
<td align="right">1,06</td>
<td align="right">0,147</td>
<td align="right">1,0</td>
<td align="right">1,1</td>
</tr>
<tr class="even">
<td align="left">monthF3</td>
<td align="right">1,36</td>
<td align="right">&lt;0,001</td>
<td align="right">1,2</td>
<td align="right">1,5</td>
</tr>
<tr class="odd">
<td align="left">monthF4</td>
<td align="right">2,79</td>
<td align="right">&lt;0,001</td>
<td align="right">2,5</td>
<td align="right">3,1</td>
</tr>
<tr class="even">
<td align="left">monthF5</td>
<td align="right">3,82</td>
<td align="right">&lt;0,001</td>
<td align="right">3,4</td>
<td align="right">4,3</td>
</tr>
<tr class="odd">
<td align="left">monthF6</td>
<td align="right">4,69</td>
<td align="right">&lt;0,001</td>
<td align="right">4,1</td>
<td align="right">5,4</td>
</tr>
<tr class="even">
<td align="left">monthF7</td>
<td align="right">5,63</td>
<td align="right">&lt;0,001</td>
<td align="right">4,9</td>
<td align="right">6,4</td>
</tr>
<tr class="odd">
<td align="left">monthF8</td>
<td align="right">6,40</td>
<td align="right">&lt;0,001</td>
<td align="right">5,6</td>
<td align="right">7,3</td>
</tr>
<tr class="even">
<td align="left">monthF9</td>
<td align="right">7,02</td>
<td align="right">&lt;0,001</td>
<td align="right">6,1</td>
<td align="right">8,1</td>
</tr>
<tr class="odd">
<td align="left">monthF10</td>
<td align="right">7,49</td>
<td align="right">&lt;0,001</td>
<td align="right">6,5</td>
<td align="right">8,6</td>
</tr>
<tr class="even">
<td align="left">monthF11</td>
<td align="right">7,96</td>
<td align="right">&lt;0,001</td>
<td align="right">6,9</td>
<td align="right">9,2</td>
</tr>
<tr class="odd">
<td align="left">monthF12</td>
<td align="right">8,42</td>
<td align="right">&lt;0,001</td>
<td align="right">7,3</td>
<td align="right">9,8</td>
</tr>
<tr class="even">
<td align="left">monthF13</td>
<td align="right">9,31</td>
<td align="right">&lt;0,001</td>
<td align="right">8,0</td>
<td align="right">10,8</td>
</tr>
<tr class="odd">
<td align="left">monthF14</td>
<td align="right">10,11</td>
<td align="right">&lt;0,001</td>
<td align="right">8,6</td>
<td align="right">11,8</td>
</tr>
<tr class="even">
<td align="left">monthF15</td>
<td align="right">10,74</td>
<td align="right">&lt;0,001</td>
<td align="right">9,2</td>
<td align="right">12,6</td>
</tr>
<tr class="odd">
<td align="left">monthF16</td>
<td align="right">11,46</td>
<td align="right">&lt;0,001</td>
<td align="right">9,8</td>
<td align="right">13,4</td>
</tr>
<tr class="even">
<td align="left">monthF17</td>
<td align="right">11,43</td>
<td align="right">&lt;0,001</td>
<td align="right">9,7</td>
<td align="right">13,4</td>
</tr>
<tr class="odd">
<td align="left">monthF18</td>
<td align="right">11,53</td>
<td align="right">&lt;0,001</td>
<td align="right">9,8</td>
<td align="right">13,6</td>
</tr>
<tr class="even">
<td align="left">monthF19</td>
<td align="right">11,50</td>
<td align="right">&lt;0,001</td>
<td align="right">9,7</td>
<td align="right">13,6</td>
</tr>
<tr class="odd">
<td align="left">monthF20</td>
<td align="right">11,70</td>
<td align="right">&lt;0,001</td>
<td align="right">9,7</td>
<td align="right">14,1</td>
</tr>
<tr class="even">
<td align="left">monthF21</td>
<td align="right">11,67</td>
<td align="right">&lt;0,001</td>
<td align="right">9,6</td>
<td align="right">14,2</td>
</tr>
<tr class="odd">
<td align="left">monthF22</td>
<td align="right">12,60</td>
<td align="right">&lt;0,001</td>
<td align="right">10,3</td>
<td align="right">15,4</td>
</tr>
<tr class="even">
<td align="left">monthF23</td>
<td align="right">12,78</td>
<td align="right">&lt;0,001</td>
<td align="right">10,4</td>
<td align="right">15,7</td>
</tr>
<tr class="odd">
<td align="left">monthF24</td>
<td align="right">12,76</td>
<td align="right">&lt;0,001</td>
<td align="right">10,4</td>
<td align="right">15,7</td>
</tr>
<tr class="even">
<td align="left">monthF25</td>
<td align="right">13,11</td>
<td align="right">&lt;0,001</td>
<td align="right">10,6</td>
<td align="right">16,2</td>
</tr>
<tr class="odd">
<td align="left">monthF26</td>
<td align="right">13,60</td>
<td align="right">&lt;0,001</td>
<td align="right">11,0</td>
<td align="right">16,9</td>
</tr>
<tr class="even">
<td align="left">monthF27</td>
<td align="right">14,40</td>
<td align="right">&lt;0,001</td>
<td align="right">11,6</td>
<td align="right">17,9</td>
</tr>
<tr class="odd">
<td align="left">monthF28</td>
<td align="right">15,65</td>
<td align="right">&lt;0,001</td>
<td align="right">12,5</td>
<td align="right">19,6</td>
</tr>
<tr class="even">
<td align="left">monthF29</td>
<td align="right">14,89</td>
<td align="right">&lt;0,001</td>
<td align="right">11,9</td>
<td align="right">18,7</td>
</tr>
<tr class="odd">
<td align="left">monthF30</td>
<td align="right">14,98</td>
<td align="right">&lt;0,001</td>
<td align="right">11,9</td>
<td align="right">18,9</td>
</tr>
<tr class="even">
<td align="left">monthF31</td>
<td align="right">14,02</td>
<td align="right">&lt;0,001</td>
<td align="right">11,0</td>
<td align="right">17,9</td>
</tr>
<tr class="odd">
<td align="left">monthF32</td>
<td align="right">14,27</td>
<td align="right">&lt;0,001</td>
<td align="right">11,0</td>
<td align="right">18,5</td>
</tr>
<tr class="even">
<td align="left">monthF33</td>
<td align="right">14,41</td>
<td align="right">&lt;0,001</td>
<td align="right">11,0</td>
<td align="right">18,9</td>
</tr>
<tr class="odd">
<td align="left">monthF34</td>
<td align="right">14,73</td>
<td align="right">&lt;0,001</td>
<td align="right">11,0</td>
<td align="right">19,7</td>
</tr>
<tr class="even">
<td align="left">monthF35</td>
<td align="right">16,17</td>
<td align="right">&lt;0,001</td>
<td align="right">11,8</td>
<td align="right">22,1</td>
</tr>
<tr class="odd">
<td align="left">monthF36</td>
<td align="right">16,07</td>
<td align="right">&lt;0,001</td>
<td align="right">11,4</td>
<td align="right">22,6</td>
</tr>
</tbody>
</table>
<p>On peut facilement représenter tout cela graphiquement. On va supprimer les termes <q>seuils</q>, grâce à <code data-pkg="stringr">str_detect</code> de <code class="pkg">stringr</code>. On notera le recours à <code data-pkg="forcats">fct_inorder</code> de <code class="pkg">forcats</code> pour conserver l’ordre des termes selon leur ordre d’apparition.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb110-1" title="1">res &lt;-<span class="st"> </span>res[<span class="op">!</span><span class="kw">str_detect</span>(res<span class="op">$</span>term, <span class="st">&quot;Inter&quot;</span>),]</a>
<a class="sourceLine" id="cb110-2" title="2">res<span class="op">$</span>term &lt;-<span class="st"> </span><span class="kw">fct_inorder</span>(res<span class="op">$</span>term)</a>
<a class="sourceLine" id="cb110-3" title="3">res<span class="op">$</span>term &lt;-<span class="st"> </span><span class="kw">fct_recode</span>(res<span class="op">$</span>term,</a>
<a class="sourceLine" id="cb110-4" title="4">               <span class="st">&quot;femme vs. homme&quot;</span> =<span class="st"> &quot;sexFfemme&quot;</span>,</a>
<a class="sourceLine" id="cb110-5" title="5">               <span class="st">&quot;âge : 30-59 vs. 16-29&quot;</span> =<span class="st"> &quot;ageF30-59&quot;</span>,</a>
<a class="sourceLine" id="cb110-6" title="6">               <span class="st">&quot;âge : 60+ vs 16-29&quot;</span> =<span class="st"> &quot;ageF60+&quot;</span>,</a>
<a class="sourceLine" id="cb110-7" title="7">               <span class="st">&quot;éducation : secondaire vs. primaire&quot;</span> =<span class="st"> &quot;educationFsecondaire&quot;</span>,</a>
<a class="sourceLine" id="cb110-8" title="8">               <span class="st">&quot;éducation : supérieure vs. primaire&quot;</span> =<span class="st"> &quot;educationFsupérieur&quot;</span>,</a>
<a class="sourceLine" id="cb110-9" title="9">               <span class="st">&quot;M2&quot;</span> =<span class="st"> &quot;monthF2&quot;</span>,</a>
<a class="sourceLine" id="cb110-10" title="10">               <span class="st">&quot;M3&quot;</span> =<span class="st"> &quot;monthF3&quot;</span>,</a>
<a class="sourceLine" id="cb110-11" title="11">               <span class="st">&quot;M4&quot;</span> =<span class="st"> &quot;monthF4&quot;</span>,</a>
<a class="sourceLine" id="cb110-12" title="12">               <span class="st">&quot;M5&quot;</span> =<span class="st"> &quot;monthF5&quot;</span>,</a>
<a class="sourceLine" id="cb110-13" title="13">               <span class="st">&quot;M6&quot;</span> =<span class="st"> &quot;monthF6&quot;</span>,</a>
<a class="sourceLine" id="cb110-14" title="14">               <span class="st">&quot;M7&quot;</span> =<span class="st"> &quot;monthF7&quot;</span>,</a>
<a class="sourceLine" id="cb110-15" title="15">               <span class="st">&quot;M8&quot;</span> =<span class="st"> &quot;monthF8&quot;</span>,</a>
<a class="sourceLine" id="cb110-16" title="16">               <span class="st">&quot;M9&quot;</span> =<span class="st"> &quot;monthF9&quot;</span>,</a>
<a class="sourceLine" id="cb110-17" title="17">               <span class="st">&quot;M10&quot;</span> =<span class="st"> &quot;monthF10&quot;</span>,</a>
<a class="sourceLine" id="cb110-18" title="18">               <span class="st">&quot;M11&quot;</span> =<span class="st"> &quot;monthF11&quot;</span>,</a>
<a class="sourceLine" id="cb110-19" title="19">               <span class="st">&quot;M12&quot;</span> =<span class="st"> &quot;monthF12&quot;</span>,</a>
<a class="sourceLine" id="cb110-20" title="20">               <span class="st">&quot;M13&quot;</span> =<span class="st"> &quot;monthF13&quot;</span>,</a>
<a class="sourceLine" id="cb110-21" title="21">               <span class="st">&quot;M14&quot;</span> =<span class="st"> &quot;monthF14&quot;</span>,</a>
<a class="sourceLine" id="cb110-22" title="22">               <span class="st">&quot;M15&quot;</span> =<span class="st"> &quot;monthF15&quot;</span>,</a>
<a class="sourceLine" id="cb110-23" title="23">               <span class="st">&quot;M16&quot;</span> =<span class="st"> &quot;monthF16&quot;</span>,</a>
<a class="sourceLine" id="cb110-24" title="24">               <span class="st">&quot;M17&quot;</span> =<span class="st"> &quot;monthF17&quot;</span>,</a>
<a class="sourceLine" id="cb110-25" title="25">               <span class="st">&quot;M18&quot;</span> =<span class="st"> &quot;monthF18&quot;</span>,</a>
<a class="sourceLine" id="cb110-26" title="26">               <span class="st">&quot;M19&quot;</span> =<span class="st"> &quot;monthF19&quot;</span>,</a>
<a class="sourceLine" id="cb110-27" title="27">               <span class="st">&quot;M20&quot;</span> =<span class="st"> &quot;monthF20&quot;</span>,</a>
<a class="sourceLine" id="cb110-28" title="28">               <span class="st">&quot;M21&quot;</span> =<span class="st"> &quot;monthF21&quot;</span>,</a>
<a class="sourceLine" id="cb110-29" title="29">               <span class="st">&quot;M22&quot;</span> =<span class="st"> &quot;monthF22&quot;</span>,</a>
<a class="sourceLine" id="cb110-30" title="30">               <span class="st">&quot;M23&quot;</span> =<span class="st"> &quot;monthF23&quot;</span>,</a>
<a class="sourceLine" id="cb110-31" title="31">               <span class="st">&quot;M24&quot;</span> =<span class="st"> &quot;monthF24&quot;</span>,</a>
<a class="sourceLine" id="cb110-32" title="32">               <span class="st">&quot;M25&quot;</span> =<span class="st"> &quot;monthF25&quot;</span>,</a>
<a class="sourceLine" id="cb110-33" title="33">               <span class="st">&quot;M26&quot;</span> =<span class="st"> &quot;monthF26&quot;</span>,</a>
<a class="sourceLine" id="cb110-34" title="34">               <span class="st">&quot;M27&quot;</span> =<span class="st"> &quot;monthF27&quot;</span>,</a>
<a class="sourceLine" id="cb110-35" title="35">               <span class="st">&quot;M28&quot;</span> =<span class="st"> &quot;monthF28&quot;</span>,</a>
<a class="sourceLine" id="cb110-36" title="36">               <span class="st">&quot;M29&quot;</span> =<span class="st"> &quot;monthF29&quot;</span>,</a>
<a class="sourceLine" id="cb110-37" title="37">               <span class="st">&quot;M30&quot;</span> =<span class="st"> &quot;monthF30&quot;</span>,</a>
<a class="sourceLine" id="cb110-38" title="38">               <span class="st">&quot;M31&quot;</span> =<span class="st"> &quot;monthF31&quot;</span>,</a>
<a class="sourceLine" id="cb110-39" title="39">               <span class="st">&quot;M32&quot;</span> =<span class="st"> &quot;monthF32&quot;</span>,</a>
<a class="sourceLine" id="cb110-40" title="40">               <span class="st">&quot;M33&quot;</span> =<span class="st"> &quot;monthF33&quot;</span>,</a>
<a class="sourceLine" id="cb110-41" title="41">               <span class="st">&quot;M34&quot;</span> =<span class="st"> &quot;monthF34&quot;</span>,</a>
<a class="sourceLine" id="cb110-42" title="42">               <span class="st">&quot;M35&quot;</span> =<span class="st"> &quot;monthF35&quot;</span>,</a>
<a class="sourceLine" id="cb110-43" title="43">               <span class="st">&quot;M36&quot;</span> =<span class="st"> &quot;monthF36&quot;</span>)</a>
<a class="sourceLine" id="cb110-44" title="44">res<span class="op">$</span>var_group &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="kw">rep</span>(<span class="st">&quot;d&quot;</span>, <span class="dv">35</span>))</a>
<a class="sourceLine" id="cb110-45" title="45"></a>
<a class="sourceLine" id="cb110-46" title="46">GGally<span class="op">::</span><span class="kw">ggcoef</span>(</a>
<a class="sourceLine" id="cb110-47" title="47">    res, <span class="dt">exponentiate =</span> <span class="ot">TRUE</span>, </a>
<a class="sourceLine" id="cb110-48" title="48">    <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> estimate, <span class="dt">y =</span> <span class="kw">fct_rev</span>(term), <span class="dt">color =</span> var_group)</a>
<a class="sourceLine" id="cb110-49" title="49">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb110-50" title="50"><span class="st">  </span><span class="kw">theme_classic</span>() <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Odds Ratio&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb110-51" title="51"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<p><img src="graphs/trajectoires-de-soins/unnamed-chunk-67-1.png" width="1050" /></p>
<p>Sur ce graphique, on visualise bien l’évolution temporelle traduite par les odds ratios associés à chaque mois, ainsi que les effets globaux de nos covariables : les femmes ont une meilleure progression dans la cascade de soins que les hommes, de même que les plus éduqués et les plus âgés.</p>
</div>
<div id="modèle-de-survie-multi-états" class="section level2">
<h2>Modèle de survie multi-états</h2>
<p>Depuis la fin du XX<sup>e</sup> siècle, de nombreux développements ont réalisés pour étendre les modèles de survie à des processus <dfn data-index="modèle de survie multi-états">multi-états</dfn><dfn data-index="survie, modèle multi-états"></dfn><dfn data-index="multi-états, modèle de survie"></dfn>. Ces modèles permettent de considérer une grande variété de processus. Plusieurs implémentations existent dans <strong>R</strong><a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>. Ici, nous allons utiliser l’extension <code class="pkg">msm</code> qui repose sur des modèles de Markov multi-états et peut prendre en compte des co-variables dans le modèle.</p>
<p>En premier lieu, pour cette extension, ils nous faut disposer des données sous une forme longue, c’est-à-dire avec une ligne par individu et point d’observation dans le temps, ce qui est déjà le cas du fichier <code>care_trajectories</code>. Les différents status possibles doivent également être codés sous la forme de nombres entiers croissants (ici 1 correspondra à D, 2 à C, 3 à T et 4 à S).</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb111-1" title="1"><span class="kw">library</span>(msm)</a>
<a class="sourceLine" id="cb111-2" title="2">care_trajectories<span class="op">$</span>status &lt;-<span class="st"> </span><span class="kw">as.integer</span>(<span class="kw">to_factor</span>(care_trajectories<span class="op">$</span>care_status))</a>
<a class="sourceLine" id="cb111-3" title="3"><span class="kw">setorder</span>(care_trajectories, id, month)</a></code></pre></div>
<p>Par ailleurs, nous n’allons concerver dans l’analyse que les individus avec au moins deux points d’observation, ici ceux observés au moins jusqu’à un mois.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb112-1" title="1">ct &lt;-<span class="st"> </span>care_trajectories[id <span class="op">%in%</span><span class="st"> </span>care_trajectories[month <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, id]]</a></code></pre></div>
<p>La fonction <code data-pkg="msm">statetable.msm</code> permet de calculer le nombre et le type de transitions observées dans les données.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb113-1" title="1"><span class="kw">statetable.msm</span>(status, id, <span class="dt">data =</span> ct)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">from/to</th>
<th align="right">1</th>
<th align="right">2</th>
<th align="right">3</th>
<th align="right">4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">21916</td>
<td align="right">1168</td>
<td align="right">467</td>
<td align="right">247</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">501</td>
<td align="right">4323</td>
<td align="right">597</td>
<td align="right">210</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="right">26</td>
<td align="right">141</td>
<td align="right">3489</td>
<td align="right">770</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="right">33</td>
<td align="right">230</td>
<td align="right">43</td>
<td align="right">12275</td>
</tr>
</tbody>
</table>
<p>Il faut ensuite définir les transitions possibles dans le modèle en faisant une matrice carrée. On indiquera 0 si la transition n’est pas possible, une valeur positive sinon.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb114-1" title="1">tr &lt;-<span class="st"> </span><span class="kw">rbind</span>(</a>
<a class="sourceLine" id="cb114-2" title="2">  <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="co"># de 1 : vers 2</span></a>
<a class="sourceLine" id="cb114-3" title="3">  <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="co"># de 2 : vers 1 ou vers 3</span></a>
<a class="sourceLine" id="cb114-4" title="4">  <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="co"># de 3 : vers 2 ou vers 4</span></a>
<a class="sourceLine" id="cb114-5" title="5">  <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)  <span class="co"># de 4 : vers 3</span></a>
<a class="sourceLine" id="cb114-6" title="6">)</a></code></pre></div>
<p>Dans notre matrice de transitions, nous n’avons pas défini de transition directe entre le statut 1 et le statut 3, alors que de telles transitions sont pourtant observées dans notre fichier. En fait, nous pouvons considérer qu’une transition de 1 vers 3 correspond en fait à deux transitions successives, de 1 vers 2 puis de 2 vers 3. La fonction <code data-pkg="msm">msm</code> s’aura identifier d’elle-mêmes ces doubles, voire triples, transitions.</p>
<p>On peut facilement représenter notre matrice de transition sous forme de schéma à l’aide de l’excellente extension <code class="pkg">DiagrammeR</code>.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb115-1" title="1"><span class="kw">library</span>(DiagrammeR)</a>
<a class="sourceLine" id="cb115-2" title="2"><span class="kw">mermaid</span>(<span class="st">&quot;</span></a>
<a class="sourceLine" id="cb115-3" title="3"><span class="st">graph TD</span></a>
<a class="sourceLine" id="cb115-4" title="4"><span class="st">1[diagnostiqué, mais pas suivi]</span></a>
<a class="sourceLine" id="cb115-5" title="5"><span class="st">2[suivi, mais pas sous traitement]</span></a>
<a class="sourceLine" id="cb115-6" title="6"><span class="st">3[sous traitement, mais infection non contrôlée]</span></a>
<a class="sourceLine" id="cb115-7" title="7"><span class="st">4[sous traitement et infection contrôlée]</span></a>
<a class="sourceLine" id="cb115-8" title="8"></a>
<a class="sourceLine" id="cb115-9" title="9"><span class="st">1--entrée&lt;br /&gt;en soins--&gt;2</span></a>
<a class="sourceLine" id="cb115-10" title="10"><span class="st">2--initiation&lt;br /&gt;traitement--&gt;3</span></a>
<a class="sourceLine" id="cb115-11" title="11"><span class="st">2--sortie&lt;br /&gt;de soins--&gt;1</span></a>
<a class="sourceLine" id="cb115-12" title="12"><span class="st">3--contrôle&lt;br /&gt;infection--&gt;4</span></a>
<a class="sourceLine" id="cb115-13" title="13"><span class="st">3--arrêt&lt;br /&gt;traitement--&gt;2</span></a>
<a class="sourceLine" id="cb115-14" title="14"><span class="st">4--échec&lt;br/&gt;virologique--&gt;3</span></a>
<a class="sourceLine" id="cb115-15" title="15"><span class="st">&quot;</span>, <span class="dt">height =</span> <span class="dv">300</span>)</a></code></pre></div>
<div id="htmlwidget-2af7d1bc8be232c79118" style="width:1050px;height:300px;" class="DiagrammeR html-widget"></div>
<script type="application/json" data-for="htmlwidget-2af7d1bc8be232c79118">{"x":{"diagram":"\ngraph TD\n1[diagnostiqué, mais pas suivi]\n2[suivi, mais pas sous traitement]\n3[sous traitement, mais infection non contrôlée]\n4[sous traitement et infection contrôlée]\n\n1--entrée<br />en soins-->2\n2--initiation<br />traitement-->3\n2--sortie<br />de soins-->1\n3--contrôle<br />infection-->4\n3--arrêt<br />traitement-->2\n4--échec<br/>virologique-->3\n"},"evals":[],"jsHooks":[]}</script>
<p>Il ne nous reste plus qu’à spécifier notre modèle. L’option <code>obstype = 1</code> indique à <code data-pkg="msm">msm</code> que nos données correspondent à des <em>snapshots</em> à certains moments donnés (ici tous les mois) et donc que les transitions d’un état à un autre ont eu lieu entre nos points d’observation. Les types 2 et 3 correspondent à des dates de transition exactes (voir l’aide la fonction pour plus de détails).</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb116-1" title="1">ms_mod &lt;-<span class="st"> </span><span class="kw">msm</span>(</a>
<a class="sourceLine" id="cb116-2" title="2">  status <span class="op">~</span><span class="st"> </span>month, <span class="dt">subject =</span> id, <span class="dt">data =</span> ct, <span class="dt">qmatrix =</span> tr, <span class="dt">obstype =</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb116-3" title="3">)</a></code></pre></div>
<p>En exécutant cette commande, vous risquez d’obtenir le message d’erreur suivant :</p>
<pre class="last"><code>Error in Ccall.msm(params, do.what = &quot;lik&quot;, ...) : numerical overflow in calculating likelihood</code></pre>
<p>Cela est dû à un problème d’échelle dans l’optimisation du modèle qui génère des nombres plus grands que ce que peux gérer l’ordinateur. Il peut être résolu de la manière suivante. Tout d’abord, on reexécute le modèle avec l’option <code>control = list(trace = TRUE)</code>.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb118-1" title="1">ms_mod &lt;-<span class="st"> </span><span class="kw">msm</span>(</a>
<a class="sourceLine" id="cb118-2" title="2">  status <span class="op">~</span><span class="st"> </span>month, <span class="dt">subject =</span> id, <span class="dt">data =</span> ct, <span class="dt">qmatrix =</span> tr, <span class="dt">obstype =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb118-3" title="3">  <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">trace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb118-4" title="4">)</a></code></pre></div>
<p>On obtient le message suivant :</p>
<pre class="last"><code>initial  value 74796.800445 
Error in Ccall.msm(params, do.what = &quot;lik&quot;, ...) : numerical overflow in calculating likelihood</code></pre>
<p>Ce qui importe de retenir, c’est la valeur initiale du paramètre d’optimisation avant que l’erreur ne se produise. On va l’utiliser (ou une valeur proche) comme paramètre d’échelle pour l’optimation avec l’option <code>fnscale</code> :</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb120-1" title="1">ms_mod &lt;-<span class="st"> </span><span class="kw">msm</span>(</a>
<a class="sourceLine" id="cb120-2" title="2">  status <span class="op">~</span><span class="st"> </span>month, <span class="dt">subject =</span> id, <span class="dt">data =</span> ct, <span class="dt">qmatrix =</span> tr, <span class="dt">obstype =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb120-3" title="3">  <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">fnscale =</span> <span class="dv">75000</span>, <span class="dt">trace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb120-4" title="4">)</a></code></pre></div>
<pre><code>initial  value 0.997291 
iter  10 value 0.520302
iter  20 value 0.497598
iter  30 value 0.497487
final  value 0.497484 
converged
Used 39 function and 37 gradient evaluations</code></pre>
<p>On peut comparer la prévalence dans chaque état au cours du temps telle que modélisée par le modèle avec les valeurs observées avec la fonction <code data-pkg="msm">plot.prevalence.msm</code>.</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb122-1" title="1"><span class="kw">plot.prevalence.msm</span>(ms_mod)</a></code></pre></div>
<p><img src="graphs/trajectoires-de-soins/unnamed-chunk-76-1.png" width="1050" /></p>
<p>Par défaut, <code data-pkg="msm">msm</code> considère que les intensités de transition d’un état à un autre sont constantes au cours du temps. Or, dans notre example, il apparait que les prévalences observées varient différemment pendant les premiers mois après le diagnostic. Nous allons donc recalculer le modèle en spécifiant avec le paramètre <code>pci</code> que nous souhaitons considérer des intensités de transition différentes pour les trois premiers mois, la première année, la seconde année et après la seconde année. Comme il faudra plus d’itérations pour faire converger notre modèle, nous avons également augmenter la valeur du paramètre <code>maxit</code> (100 par défaut).</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" title="1">ms_mod &lt;-<span class="st"> </span><span class="kw">msm</span>(</a>
<a class="sourceLine" id="cb123-2" title="2">  status <span class="op">~</span><span class="st"> </span>month, <span class="dt">subject =</span> id, <span class="dt">data =</span> ct, <span class="dt">qmatrix =</span> tr, <span class="dt">obstype =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb123-3" title="3">  <span class="dt">pci =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">12</span>, <span class="dv">24</span>),</a>
<a class="sourceLine" id="cb123-4" title="4">  <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">fnscale =</span> <span class="dv">75000</span>, <span class="dt">trace =</span> <span class="ot">TRUE</span>, <span class="dt">maxit =</span> <span class="dv">500</span>)</a>
<a class="sourceLine" id="cb123-5" title="5">)</a></code></pre></div>
<p>Comparons à nouveau les prévalences estimées avec les prévalences observées.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb124-1" title="1"><span class="kw">plot.prevalence.msm</span>(ms_mod)</a></code></pre></div>
<p><img src="graphs/trajectoires-de-soins/unnamed-chunk-79-1.png" width="1050" /></p>
<p>Comme on peut le voir, l’ajustement entre les deux a été amélioré. Les prévalences elles-mêmes peuvent s’obtenir avec <code data-pkg="msm">prevalence.msm</code>.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb125-1" title="1"><span class="kw">prevalence.msm</span>(ms_mod)</a></code></pre></div>
<pre><code>$Observed
   State 1 State 2 State 3 State 4 Total
0     2799      24       0       7  2830
5     1551     292     297     460  2600
10     958     257     210     623  2048
15     578     168     104     603  1453
20     283      87      65     327   762
25     192      63      39     267   561
30     147      41      23     245   456
35      69      17      12     136   234
40      14       2       2      27    45
45       7       0       0      12    19
50       0       0       0       1     1

$Expected
     State 1   State 2   State 3  State 4 Total
0  2799.0000  24.00000   0.00000   7.0000  2830
5  1436.9518 424.94481 358.54921 379.5542  2600
10 1017.4845 258.18413 191.08425 581.2471  2048
15  667.5132 168.10101  98.36234 519.0235  1453
20  331.9788  81.73411  46.82692 301.4602   762
25  233.1379  55.54030  32.92028 239.4015   561
30  184.4058  40.32826  24.41823 206.8477   456
35   91.3576  19.57230  12.12106 110.9490   234
40   16.9423   3.63905   2.30425  22.1144    45
45    6.9063   1.49869   0.96897   9.6261    19
50    0.3516   0.07725   0.05092   0.5202     1

$`Observed percentages`
   State 1 State 2 State 3  State 4
0    98.90  0.8481   0.000   0.2473
5    59.65 11.2308  11.423  17.6923
10   46.78 12.5488  10.254  30.4199
15   39.78 11.5623   7.158  41.5003
20   37.14 11.4173   8.530  42.9134
25   34.22 11.2299   6.952  47.5936
30   32.24  8.9912   5.044  53.7281
35   29.49  7.2650   5.128  58.1197
40   31.11  4.4444   4.444  60.0000
45   36.84  0.0000   0.000  63.1579
50    0.00  0.0000   0.000 100.0000

$`Expected percentages`
   State 1 State 2 State 3 State 4
0    98.90  0.8481   0.000  0.2473
5    55.27 16.3440  13.790 14.5982
10   49.68 12.6066   9.330 28.3812
15   45.94 11.5692   6.770 35.7208
20   43.57 10.7263   6.145 39.5617
25   41.56  9.9002   5.868 42.6741
30   40.44  8.8439   5.355 45.3613
35   39.04  8.3642   5.180 47.4141
40   37.65  8.0868   5.121 49.1431
45   36.35  7.8879   5.100 50.6635
50   35.16  7.7253   5.092 52.0236</code></pre>
<p>Ceci dit, le format dans lequel sont renvoyées les prévalences n’est que peu pratique pour les exploiter ensuite, par exemple avec <code class="pkg">ggplot2</code>. L’extension <code class="pkg">JLutils</code> fournit une fonction expérimentale <code data-pjg="JLutils">tidy.prevalence.msm</code><a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a> permettant de transformer ce résultat dans un format <dfn data-index="tidy data" lang="en">tidy</dfn>.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb127-1" title="1"><span class="kw">library</span>(JLutils)</a>
<a class="sourceLine" id="cb127-2" title="2">prev &lt;-<span class="st"> </span><span class="kw">tidy.prevalence.msm</span>(<span class="kw">prevalence.msm</span>(ms_mod, <span class="dt">times =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">36</span>))</a>
<a class="sourceLine" id="cb127-3" title="3"><span class="kw">head</span>(prev)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">time</th>
<th align="left">status</th>
<th align="right">observed</th>
<th align="right">expected</th>
<th align="right">observed.percentage</th>
<th align="right">expected.percentage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="left">State 1</td>
<td align="right">2799</td>
<td align="right">2799</td>
<td align="right">98.90</td>
<td align="right">98.90</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">State 1</td>
<td align="right">1942</td>
<td align="right">2329</td>
<td align="right">68.62</td>
<td align="right">82.31</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="left">State 1</td>
<td align="right">1766</td>
<td align="right">1905</td>
<td align="right">63.55</td>
<td align="right">68.56</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="left">State 1</td>
<td align="right">1651</td>
<td align="right">1553</td>
<td align="right">60.77</td>
<td align="right">57.15</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="left">State 1</td>
<td align="right">1589</td>
<td align="right">1500</td>
<td align="right">59.58</td>
<td align="right">56.24</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="left">State 1</td>
<td align="right">1551</td>
<td align="right">1437</td>
<td align="right">59.65</td>
<td align="right">55.27</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb128-1" title="1">prev<span class="op">$</span>status &lt;-<span class="st"> </span><span class="kw">to_factor</span>(prev<span class="op">$</span>status)</a>
<a class="sourceLine" id="cb128-2" title="2">casc_status &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb128-3" title="3">  <span class="st">&quot;diagnostiqué, mais pas suivi&quot;</span>,</a>
<a class="sourceLine" id="cb128-4" title="4">  <span class="st">&quot;suivi, mais pas sous traitement&quot;</span>,</a>
<a class="sourceLine" id="cb128-5" title="5">  <span class="st">&quot;sous traitement, mais infection non contrôlée&quot;</span>,</a>
<a class="sourceLine" id="cb128-6" title="6">  <span class="st">&quot;sous traitement et infection contrôlée&quot;</span></a>
<a class="sourceLine" id="cb128-7" title="7">)</a>
<a class="sourceLine" id="cb128-8" title="8"><span class="kw">levels</span>(prev<span class="op">$</span>status) &lt;-<span class="st"> </span>casc_status</a></code></pre></div>
<p>Il est alors ensuite facile de produire le graphique de la cascade de soins, estimée par le modèle, que l’on pourra mettre en comparaison de la cascade observée que nous avions calculé tout à l’heure.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb129-1" title="1">casc_est &lt;-<span class="st"> </span><span class="kw">ggplot</span>(prev) <span class="op">+</span></a>
<a class="sourceLine" id="cb129-2" title="2"><span class="st">  </span><span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">fill =</span> status, <span class="dt">weight =</span> expected) <span class="op">+</span></a>
<a class="sourceLine" id="cb129-3" title="3"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">color =</span> <span class="st">&quot;gray50&quot;</span>, <span class="dt">width =</span> <span class="dv">1</span>, <span class="dt">position =</span> <span class="st">&quot;fill&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb129-4" title="4"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">6</span><span class="op">*</span><span class="dv">6</span>, <span class="dt">labels =</span> <span class="kw">paste0</span>(<span class="st">&quot;M&quot;</span>, <span class="dv">0</span><span class="op">:</span><span class="dv">6</span><span class="op">*</span><span class="dv">6</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb129-5" title="5"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>percent) <span class="op">+</span></a>
<a class="sourceLine" id="cb129-6" title="6"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Cascade des soins estimée, selon le temps depuis le diagnostic&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb129-7" title="7"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb129-8" title="8"><span class="st">  </span><span class="kw">theme_light</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb129-9" title="9"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb129-10" title="10"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">fill =</span> <span class="st">&quot;Statut dans les soins&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb129-11" title="11"><span class="st">  </span><span class="kw">scale_fill_viridis</span>(<span class="dt">discrete =</span> <span class="ot">TRUE</span>, <span class="dt">direction =</span> <span class="dv">-1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb129-12" title="12"><span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="kw">guide_legend</span>(<span class="dt">nrow =</span> <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb129-13" title="13"><span class="kw">multiplot</span>(casc_obs, casc_est)</a></code></pre></div>
<p><img src="graphs/trajectoires-de-soins/unnamed-chunk-82-1.png" width="1200" /></p>
<p>Comme on peut le voir, dans le modèle, l’évolution est plus <q>lissée</q> comparativement aux données brutes observées.</p>
<p>Un des intérêts de <code data-pkg="msm">msm</code> est la possibilité d’y intégrer des covariables, permettant ainsi de calculer un modèle multivarié. Les variables peuvent être dépendantes du temps, puisqu’il suffit de renseigner leur valeur à chaque point d’observation.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb130-1" title="1">ct<span class="op">$</span>sex &lt;-<span class="st"> </span><span class="kw">to_factor</span>(ct<span class="op">$</span>sex)</a>
<a class="sourceLine" id="cb130-2" title="2">ct<span class="op">$</span>age &lt;-<span class="st"> </span><span class="kw">to_factor</span>(ct<span class="op">$</span>age)</a>
<a class="sourceLine" id="cb130-3" title="3">ct<span class="op">$</span>education &lt;-<span class="st"> </span><span class="kw">to_factor</span>(ct<span class="op">$</span>education)</a></code></pre></div>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb131-1" title="1">ms_mod_mult &lt;-<span class="st"> </span><span class="kw">msm</span>(</a>
<a class="sourceLine" id="cb131-2" title="2">  status <span class="op">~</span><span class="st"> </span>month, <span class="dt">subject =</span> id, <span class="dt">data =</span> ct, <span class="dt">qmatrix =</span> tr, <span class="dt">obstype =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb131-3" title="3">  <span class="dt">pci =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">12</span>, <span class="dv">24</span>),</a>
<a class="sourceLine" id="cb131-4" title="4">  <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">fnscale =</span> <span class="dv">75000</span>, <span class="dt">trace =</span> <span class="ot">TRUE</span>, <span class="dt">maxit =</span> <span class="dv">500</span>),</a>
<a class="sourceLine" id="cb131-5" title="5">  <span class="dt">covariates =</span> <span class="op">~</span><span class="st"> </span>sex <span class="op">+</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>education</a>
<a class="sourceLine" id="cb131-6" title="6">)</a></code></pre></div>
<p>Les <dfn data-index="risque relatif">risques relatifs</dfn>, ou <dfn data-index="hazard ratio" lang="en">hazard ratios</dfn> en anglais, associés à chaque covariable et à chaque transition s’obtiennent avec <code data-pkg="msm">hazard.msm</code>. Une fois encore, le format de sortie n’est pas le plus adapté pour un traitement graphique, mais on pourra avoir recours à <code data-pkg="JLutils">tidy.hazard.msm</code> de <code class="pkg">JLutils</code>.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb132-1" title="1">hr &lt;-<span class="st"> </span><span class="kw">tidy.hazard.msm</span>(<span class="kw">hazard.msm</span>(ms_mod_mult))</a>
<a class="sourceLine" id="cb132-2" title="2"><span class="kw">head</span>(hr)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="left">transition</th>
<th align="left">from</th>
<th align="left">to</th>
<th align="right">estimate</th>
<th align="right">conf.low</th>
<th align="right">conf.high</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">sexfemme</td>
<td align="left">State 1 - State 2</td>
<td align="left">State 1</td>
<td align="left">State 2</td>
<td align="right">1.8855</td>
<td align="right">1.7060</td>
<td align="right">2.084</td>
</tr>
<tr class="even">
<td align="left">sexfemme</td>
<td align="left">State 2 - State 1</td>
<td align="left">State 2</td>
<td align="left">State 1</td>
<td align="right">0.9246</td>
<td align="right">0.7656</td>
<td align="right">1.117</td>
</tr>
<tr class="odd">
<td align="left">sexfemme</td>
<td align="left">State 2 - State 3</td>
<td align="left">State 2</td>
<td align="left">State 3</td>
<td align="right">0.9016</td>
<td align="right">0.8044</td>
<td align="right">1.010</td>
</tr>
<tr class="even">
<td align="left">sexfemme</td>
<td align="left">State 3 - State 2</td>
<td align="left">State 3</td>
<td align="left">State 2</td>
<td align="right">1.0960</td>
<td align="right">0.8855</td>
<td align="right">1.357</td>
</tr>
<tr class="odd">
<td align="left">sexfemme</td>
<td align="left">State 3 - State 4</td>
<td align="left">State 3</td>
<td align="left">State 4</td>
<td align="right">1.3985</td>
<td align="right">1.2301</td>
<td align="right">1.590</td>
</tr>
<tr class="even">
<td align="left">sexfemme</td>
<td align="left">State 4 - State 3</td>
<td align="left">State 4</td>
<td align="left">State 3</td>
<td align="right">0.8610</td>
<td align="right">0.6679</td>
<td align="right">1.110</td>
</tr>
</tbody>
</table>
<p>On va recoder certaines étiquettes en vue de faire un graphique des résultats.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb133-1" title="1">hr<span class="op">$</span>type &lt;-<span class="st"> &quot;Transition ascendante&quot;</span></a>
<a class="sourceLine" id="cb133-2" title="2">hr[hr<span class="op">$</span>transition <span class="op">==</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;State 2 - State 1&quot;</span>),]<span class="op">$</span>type &lt;-<span class="st"> &quot;Transition descendante&quot;</span></a>
<a class="sourceLine" id="cb133-3" title="3">hr[hr<span class="op">$</span>transition <span class="op">==</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;State 3 - State 2&quot;</span>),]<span class="op">$</span>type &lt;-<span class="st"> &quot;Transition descendante&quot;</span></a>
<a class="sourceLine" id="cb133-4" title="4">hr[hr<span class="op">$</span>transition <span class="op">==</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;State 4 - State 3&quot;</span>),]<span class="op">$</span>type &lt;-<span class="st"> &quot;Transition descendante&quot;</span></a>
<a class="sourceLine" id="cb133-5" title="5"></a>
<a class="sourceLine" id="cb133-6" title="6">hr<span class="op">$</span>term &lt;-<span class="st"> </span><span class="kw">fct_recode</span>(</a>
<a class="sourceLine" id="cb133-7" title="7">  <span class="kw">fct_inorder</span>(hr<span class="op">$</span>term),</a>
<a class="sourceLine" id="cb133-8" title="8">  <span class="st">&quot;femme vs. homme&quot;</span> =<span class="st"> &quot;sexfemme&quot;</span>,</a>
<a class="sourceLine" id="cb133-9" title="9">  <span class="st">&quot;30-59 vs. 16-29&quot;</span> =<span class="st"> &quot;age30-59&quot;</span>,</a>
<a class="sourceLine" id="cb133-10" title="10">  <span class="st">&quot;60+ vs. 16-29&quot;</span> =<span class="st"> &quot;age60+&quot;</span>,</a>
<a class="sourceLine" id="cb133-11" title="11">  <span class="st">&quot;éduc. secondaire vs. primaire&quot;</span> =<span class="st"> &quot;educationsecondaire&quot;</span>,</a>
<a class="sourceLine" id="cb133-12" title="12">  <span class="st">&quot;éduc. supérieure vs. primaire&quot;</span> =<span class="st"> &quot;educationsupérieur&quot;</span></a>
<a class="sourceLine" id="cb133-13" title="13">)</a>
<a class="sourceLine" id="cb133-14" title="14"></a>
<a class="sourceLine" id="cb133-15" title="15">hr<span class="op">$</span>transition &lt;-<span class="st"> </span><span class="kw">fct_recode</span>(</a>
<a class="sourceLine" id="cb133-16" title="16">  <span class="kw">fct_inorder</span>(hr<span class="op">$</span>transition),</a>
<a class="sourceLine" id="cb133-17" title="17">  <span class="st">&quot;entrée en soins&quot;</span> =<span class="st"> &quot;State 1 - State 2&quot;</span>,</a>
<a class="sourceLine" id="cb133-18" title="18">  <span class="st">&quot;sortie de soins&quot;</span> =<span class="st"> &quot;State 2 - State 1&quot;</span>,</a>
<a class="sourceLine" id="cb133-19" title="19">  <span class="st">&quot;initiation traitement&quot;</span> =<span class="st"> &quot;State 2 - State 3&quot;</span>,</a>
<a class="sourceLine" id="cb133-20" title="20">  <span class="st">&quot;arrêt traitement&quot;</span> =<span class="st"> &quot;State 3 - State 2&quot;</span>,</a>
<a class="sourceLine" id="cb133-21" title="21">  <span class="st">&quot;contrôle infection&quot;</span> =<span class="st"> &quot;State 3 - State 4&quot;</span>,</a>
<a class="sourceLine" id="cb133-22" title="22">  <span class="st">&quot;échec virologique&quot;</span> =<span class="st"> &quot;State 4 - State 3&quot;</span></a>
<a class="sourceLine" id="cb133-23" title="23">)</a>
<a class="sourceLine" id="cb133-24" title="24"></a>
<a class="sourceLine" id="cb133-25" title="25"><span class="kw">head</span>(hr)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="left">transition</th>
<th align="left">from</th>
<th align="left">to</th>
<th align="right">estimate</th>
<th align="right">conf.low</th>
<th align="right">conf.high</th>
<th align="left">type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">femme vs. homme</td>
<td align="left">entrée en soins</td>
<td align="left">State 1</td>
<td align="left">State 2</td>
<td align="right">1.8855</td>
<td align="right">1.7060</td>
<td align="right">2.084</td>
<td align="left">Transition ascendante</td>
</tr>
<tr class="even">
<td align="left">femme vs. homme</td>
<td align="left">sortie de soins</td>
<td align="left">State 2</td>
<td align="left">State 1</td>
<td align="right">0.9246</td>
<td align="right">0.7656</td>
<td align="right">1.117</td>
<td align="left">Transition descendante</td>
</tr>
<tr class="odd">
<td align="left">femme vs. homme</td>
<td align="left">initiation traitement</td>
<td align="left">State 2</td>
<td align="left">State 3</td>
<td align="right">0.9016</td>
<td align="right">0.8044</td>
<td align="right">1.010</td>
<td align="left">Transition ascendante</td>
</tr>
<tr class="even">
<td align="left">femme vs. homme</td>
<td align="left">arrêt traitement</td>
<td align="left">State 3</td>
<td align="left">State 2</td>
<td align="right">1.0960</td>
<td align="right">0.8855</td>
<td align="right">1.357</td>
<td align="left">Transition descendante</td>
</tr>
<tr class="odd">
<td align="left">femme vs. homme</td>
<td align="left">contrôle infection</td>
<td align="left">State 3</td>
<td align="left">State 4</td>
<td align="right">1.3985</td>
<td align="right">1.2301</td>
<td align="right">1.590</td>
<td align="left">Transition ascendante</td>
</tr>
<tr class="even">
<td align="left">femme vs. homme</td>
<td align="left">échec virologique</td>
<td align="left">State 4</td>
<td align="left">State 3</td>
<td align="right">0.8610</td>
<td align="right">0.6679</td>
<td align="right">1.110</td>
<td align="left">Transition descendante</td>
</tr>
</tbody>
</table>
<p>Vu le nombre de coefficients (un risque relatif par covariable et par transition), on va organiser le graphique en distinguant les transitions acsendantes et les transitions descendantes, d’une part, et en regroupant les risques relatifs d’une même covariable, d’autre part. Pour alléger le graphique, nous allons également retirer la covariable <code>timeperiod</code> créé par l’argument <code>pci</code>, en ayant recours à <code data-pkg="stringr">str_detect</code> de l’extension <code class="pkg">stringr</code> pour repérer les lignes en questions (voir le chapitre sur la <a href="manipuler-du-texte.html#str_detect">manipulation de texte</a>).</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb134-1" title="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> hr[<span class="op">!</span><span class="kw">str_detect</span>(hr<span class="op">$</span>term, <span class="st">&quot;time&quot;</span>), ]) <span class="op">+</span></a>
<a class="sourceLine" id="cb134-2" title="2"><span class="st">  </span><span class="kw">aes</span>(</a>
<a class="sourceLine" id="cb134-3" title="3">    <span class="dt">x =</span> <span class="kw">fct_rev</span>(term), <span class="dt">y =</span> estimate, <span class="dt">color =</span> <span class="kw">fct_rev</span>(transition),</a>
<a class="sourceLine" id="cb134-4" title="4">    <span class="dt">ymin =</span> conf.low, <span class="dt">ymax =</span> conf.high </a>
<a class="sourceLine" id="cb134-5" title="5">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb134-6" title="6"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">1</span>, <span class="dt">color =</span> <span class="st">&quot;gray25&quot;</span>, <span class="dt">linetype =</span> <span class="st">&quot;dotted&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb134-7" title="7"><span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="fl">0.5</span>), <span class="dt">width =</span> <span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb134-8" title="8"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="fl">0.5</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb134-9" title="9"><span class="st">  </span><span class="kw">scale_y_log10</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb134-10" title="10"><span class="st">  </span><span class="kw">facet_grid</span>(<span class="op">~</span><span class="st"> </span>type) <span class="op">+</span></a>
<a class="sourceLine" id="cb134-11" title="11"><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb134-12" title="12"><span class="st">  </span><span class="kw">theme_classic</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb134-13" title="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb134-14" title="14"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;risque relatif&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb134-15" title="15"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">color =</span> <span class="st">&quot;Transition&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb134-16" title="16"><span class="st">  </span><span class="kw">scale_color_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Paired&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb134-17" title="17"><span class="st">  </span><span class="kw">guides</span>(<span class="dt">color =</span> <span class="kw">guide_legend</span>(<span class="dt">reverse =</span> <span class="ot">TRUE</span>))</a></code></pre></div>
<p><img src="graphs/trajectoires-de-soins/unnamed-chunk-88-1.png" width="1200" /></p>
<p>Ce modèle de survie multi-états permet de mettre en évidence des effets différenciés selon la transition considérée. Par exemple, les femmes sont plus rapides en matière d’entrée en soins et de contrôle de l’infection (une fois le traitement initié) mais plus lentes à démarrer le traitement (une fois entrées en soins). Par contre, le sexe ne semble pas jouer sur les transitions descendantes (échec virologique, arrête du traitement ou sortie de soins).</p>
<!--

## Résumé

<!-- indiquer avec chaque approche la question qui a été posée -->
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Pour plus de détails sur les tableaux croisés et le test du Chi², voir le chapitre sur la <a href="statistique-bivariee.html#deux-variables-qualitatives">statisque bivariée</a> et le chapitre sur les <a href="comparaisons-moyennes-et-proportions.html#chi2">tests de comparaison</a>.<a href="#fnref1" class="footnote-back">↩</a></p></li>
<li id="fn2"><p>Cette extension n’est disponible que sur <a href="https://github.com/larmarange/JLutils">GitHub</a>. On peut l’installer avec la commande suivante : <code>source("https://install-github.me/larmarange/JLutils")</code><a href="#fnref2" class="footnote-back">↩</a></p></li>
<li id="fn3"><p>Comme par exemple <code class="pkg">msSurv</code> pour une estimation non-paramétrique.<a href="#fnref3" class="footnote-back">↩</a></p></li>
<li id="fn4"><p>avant l’éventuelle intégration diretement dans <code class="pkg">msm</code> d’un <em>tidier</em> officiel.<a href="#fnref4" class="footnote-back">↩</a></p></li>
</ol>
</div>

</article>
</div>

<div class="col-sm-3" role="complementary">
<nav class="hidden-print hidden-xs" id="nav_sidebar">
</nav>
</div>

</div>

<script>
// manage active state of menu based on current page
$(document).ready(function () {

    // active menu
    href = window.location.pathname;
    href = href.substr(href.lastIndexOf('/') + 1);
    if (href=='') href = 'index.html';
    $('a[href="' + href + '"]').parent().addClass('active');
    $('a[href="' + href + '"]').parent().parents('li').addClass('active');

    // élargir la page d'accueil
    if (href=='index.html') $('.col-sm-9').attr('class','col-sm-12');

    // rechercher
    $("#rechercher").submit(function(event) {
      $('input[name="q"]').val($('input[name="q"]').val() + ' site:larmarange.github.io/analyse-R');
    });

    // sidebar
    $("#nav_sidebar").append($("#TOC").html());
    $("#nav_sidebar ul").addClass("nav nav-stacked");
    $("#TOC").addClass("visible-xs-block");
    $('body').scrollspy({
      target: '#nav_sidebar',
      offset: 40
    });

    // Identifier les <pre> fermant
    $('pre').next("*:not(pre)").prev().addClass('last'); // Dernier <pre> de chaque groupe contigu de <pre>
    $('pre').parent().each(function (){
      $(this).children('pre').last().addClass('last');
    }); // Si <pre> est le dernier enfant de son parent

    // Ajout liens rdocumentation et tooltip
    $("code[data-pkg]").each(function( index ) {
      pkg = $(this).attr('data-pkg');
      if ($(this).attr('data-rdoc') !== undefined) {
        rdocumentation = $(this).attr('data-rdoc');
      } else {
        rdocumentation = $(this).text();
      }
      fonction = $(this).text();
      //$(this).wrap('<a href="http://www.rdocumentation.org/packages/'+pkg+'/functions/'+rdocumentation+'">');
      $(this).wrap('<a href="http://rdrr.io/pkg/'+pkg+'/sym/'+rdocumentation+'">');
      $(this).attr('data-toggle','tooltip');
      $(this).attr('data-placement','top');
      $(this).attr('title','package : ' + pkg);
      $('[data-toggle="tooltip"]').tooltip();
    });

    $("code.pkg").each(function( index ) {
      //$(this).wrap('<a href="http://www.rdocumentation.org/packages/'+$(this).text()+'">');
      $(this).wrap('<a href="http://rdrr.io/pkg/'+$(this).text()+'">');
    });

    // Figures
    $("figure").each(function( index ) {
      if ($(this).children("figcaption").length > 0)
        $(this).children("figcaption:first").prepend('<span class="figure-number">Figure '+(index+1)+'.</span> ');
      else
        $(this).append($("<figcaption>").append('<span class="figure-number">Figure '+(index+1)+'</span>'));
    });

    // Colorbox

    /*----
    jQuery('article div img').colorbox({
      maxWidth: '90%',
      maxHeight: '90%',
      rel: 'figures',
      current: "",
      href: function(){
        return $(this).attr('src');
      },
      title: function(){
        return $(this).attr('alt');
      }
    });
    jQuery('article div img').css('cursor', 'pointer');
    jQuery('figure img').colorbox({
      maxWidth: '90%',
      maxHeight: '90%',
      rel: 'figures',
      current: "",
      href: function(){
        return $(this).attr('src');
      },
      title: function(){
        return $(this).parent().children("figcaption").text();
      }
    });
    jQuery('figure img').css('cursor', 'pointer');

    -----*/

    /* Clipboard --------------------------*/

  function changeTooltipMessage(element, msg) {
    var tooltipOriginalTitle=element.getAttribute('data-original-title');
    element.setAttribute('data-original-title', msg);
    $(element).tooltip('show');
    element.setAttribute('data-original-title', tooltipOriginalTitle);
  }

  if(ClipboardJS.isSupported()) {
    $(document).ready(function() {
      var copyButton = "<button type='button' class='btn btn-primary btn-copy-ex' type = 'submit' title='Copier dans le presse-papier' aria-label='Copier dans le presse-papier' data-toggle='tooltip' data-placement='left auto' data-trigger='hover' data-clipboard-copy><i class='fa fa-copy'></i></button>";

      $(".examples, div.sourceCode").addClass("hasCopyButton");

      // Insert copy buttons:
      $(copyButton).prependTo(".hasCopyButton");

      // Initialize tooltips:
      $('.btn-copy-ex').tooltip({container: 'body'});

      // Initialize clipboard:
      var clipboardBtnCopies = new ClipboardJS('[data-clipboard-copy]', {
        text: function(trigger) {
          return trigger.parentNode.textContent;
        }
      });

      clipboardBtnCopies.on('success', function(e) {
        changeTooltipMessage(e.trigger, 'Copié !');
        e.clearSelection();
      });

      clipboardBtnCopies.on('error', function() {
        changeTooltipMessage(e.trigger,'Appuyez sur Ctrl+C ou Command+C pour copier');
      });
    });
  }

  // Bigfoot
  $(".footnotes > li").addClass("footnote");
  $.bigfoot({
    activateOnHover: true,
    actionOriginalFN: "ignore"
});
});
</script>

<!-- Utterances comments --->
<script src="https://utteranc.es/client.js"
        repo="larmarange/analyse-R"
        issue-term="pathname"
        label="commentaires"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>

<!-- disqus -->
<!---
<div class="row">
  <div id="disqus_thread" class="col-sm-9" role="complementary"></div>
</div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'analyse-r'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Veuillez activer JavaScript pour voir les <a href="http://disqus.com/?ref_noscript">les commentaires gérés avec Disqus.</a></noscript>
    <!--<a href="http://disqus.com" class="dsq-brlink">Les commentaires sont hébergés par <span class="logo-disqus">Disqus</span>.</a>-->

<footer>
  <div class="row">
    <div class="col-lg-12">
      <p>Contenus sous licence <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/fr/" rel="nofollow">Creative Commons Attribution - Pas d’utilisation commerciale - Partage dans les mêmes conditions</a>.<br />
      Propulsé par <a href="http://www.r-project.org/" rel="nofollow">R</a>, </a><a href="http://www.rstudio.com/" rel="nofollow">RStudio</a>, <a href="http://rmarkdown.rstudio.com/" rel="nofollow">R Markdown</a>, <a href="http://yihui.name/knitr/" rel="nofollow">knitr</a>, <a href="http://pandoc.org/" rel="nofollow">pandoc</a> et <a href="http://www.princexml.com/" rel="nofollow">Prince XML</a>. Hébergé par <a href="https://github.com/" rel="nofollow">GitHub</a>.<br />
      <a href="https://www.zenodo.org/badge/latestdoi/34986666"><img src="https://www.zenodo.org/badge/34986666.svg" alt="DOI"></a></p>
    </div>
  </div>
</footer>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->



</body>
</html>
