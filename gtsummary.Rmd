---
title: "Tableaux statistiques avancés avec gtsummary"
---

```{r options_communes, include=FALSE}
source("options_communes.R")
```

L'extension `gtsummary`{.pkg} a déjà été abordée dans d'autres chapitres, notamment via les fonctions `tbl_summary`{data_pkg="gtsummary"} et `tbl_svysummary`{data_pkg="gtsummary"} dans le chapitre sur la [statistique bivariée](statistique-bivariee.html) ou la fonction `tbl_regression`{data_pkg="gtsummary"} dans le chapitre sur la [régression logistique](regression-logistique.html).

Dans ce chapitre, nous allons explorer plus en profondeur les différentes options offertes `gtsummary`{.pkg} pour la réalisation de tableaux statistiques prêts à être publiés.

Les personnes anglophones pourront également se référer à l'excellent site de documentation du package : <https://www.danieldsjoberg.com/gtsummary/>

```{r, results='hide'}
library(gtsummary)
```


## Remarques sur les types de variables et les sélecteurs associés {#type_variables}

`gtsummary`{.pkg} permets de réaliser des tableaux statistiques combinant plusieurs variables, l'affichage des résultats pouvant dépendre du type de variables. 

Par défaut, `gtsummary`{.pkg} considère qu'une variable est **catégorielle** s'il s'agit d'un facteur, d'une variable textuelle ou d'une variable numérique ayant moins de 10 valeurs différentes.

Une variable sera considérée comme **dichotomique** (variable catégorielle à seulement deux modalités) s'il s'agit d'un vecteur logique (`TRUE`/`FALSE`), d'une variable textuelle codée `yes`/`no` ou d'une variable numérique codée `0`/`1`.

Dans les autres cas, une variable numérique sera considérée comme **continue**.

Nous verrons plus loin qu'il est possible de forcer le type d'une variable et l'existence d'autres types de variables.

`gtsummary`{.pkg} fournit des sélecteurs qui pourront être utilisés dans les options des différentes fonctions, en particulier `all_continuous`{data_pkg="gtsummary"} pour les variables continues, `all_dichotolous`{data_pkg="gtsummary"} pour les variables dichotomiques et `all_categorical`{data_pkg="gtsummary"} pour les variables catégorielles (incluant les variables dichotomiques, utiliser `all_categorical(dichotomous = FALSE)` pour sélectionner les variables catégorielles en excluant les variables dichotomiques).

Dans le cadre des tableaux présentant les résultats d'un modèle statistique, il existe en plus d'autres sélecteurs pour sélectionner certains termes spécifiques : `all_intercepts`{data_pkg="gtsummary"} (pour sélectionner seulement le ou les *intercepts* du modèle), `all_interaction`{data_pkg="gtsummary"} pour les termes d'interactions entre plusieurs variables, `all_contrasts`{data_pkg="gtsummary"} pour sélectionner les variables catégorielles codées avec un contraste particulier.

## Remarques sur la syntaxe des options

De nombreuses options des fonctions de `gtsummary`{.pkg} peuvent s'appliquer seulement à une ou certaines variables. Pour ces options-là, `gtsummary`{.pkg} attends une formule de la forme `variables concernées ~ valeur de l'option` ou bien une liste de formules ayant cette forme.

Par exemple, pour modifier l'étiquette associée à une certaine variable, on peut utiliser l'option `label` de `tbl_svysummary`{data_pkg="gtsummary"}.

```{r eval=FALSE}
tbl_summary(trial, label = age ~ "Âge")
tbl_summary(trial, label = list(age ~ "Âge", trt ~ "Traitement"))
```

`gtsummary`{.pkg} est très flexible sur la manière d'indiquer la ou les variables concernées. Il peut s'agir du nom de la variable, d'une chaîne de caractères contenant le nom de la variable, ou d'un vecteur contenant le nom de la variable. Les syntaxes ci-dessous sont ainsi équivalentes.

```{r eval=FALSE}
tbl_summary(trial, label = age ~ "Âge")
tbl_summary(trial, label = "age" ~ "Âge")
v <- "age"
tbl_summary(trial, label = v ~ "Âge")
tbl_summary(trial, label = vars(age) ~ "Âge")
```

Pour appliquer le même changement à plusieurs variables, plusieurs syntaxes sont acceptées pour lister plusieurs variables.

```{r eval=FALSE}
tbl_summary(trial, label = c("age", "trt") ~ "Une même étiquette")
tbl_summary(trial, label = c(age, trt) ~ "Une même étiquette")
tbl_summary(trial, label = vars(age, trt) ~ "Une même étiquette")
```

Il est également possible d'utiliser la syntaxe `tidyselect`{.pkg} et les sélecteurs de `tidyselect`{.pkg} comme `everything`{data-pkg="tidyselect"}, `starts_with`{data-pkg="tidyselect"}, `contains`{data-pkg="tidyselect"} ou `all_of`{data-pkg="tidyselect"}. Ces différents sélecteurs peuvent être combinés au sein d'un `c()` ou de `vars()`.

```{r eval=FALSE}
tbl_summary(trial, label = everything() ~ "Une même étiquette")
tbl_summary(trial, label = starts_with("a") ~ "Une même étiquette")
tbl_summary(trial, label = c(everything(), -age, -trt) ~ "Une même étiquette")
tbl_summary(trial, label = age:trt ~ "Une même étiquette")
```

Bien sûr, il est possible d'utiliser les sélecteurs propres à `gtsummary`{.pkg}.

```{r eval=FALSE}
tbl_summary(trial, label = all_continuous() ~ "Une même étiquette")
tbl_summary(trial, label = list(
  all_continuous() ~ "Variable continue",
  all_dichotomous() ~ "Variable dichotomique",
  all_categorical(dichotomous = FALSE) ~ "Variable catégorielle"
))
```

Enfin, si l'on ne précise rien à gauche du `~`, ce sera considéré comme équivalent à `everything()`. Les deux syntaxes ci-dessous sont donc équivalentes.

```{r eval=FALSE}
tbl_summary(trial, label = ~ "Une même étiquette")
tbl_summary(trial, label = everything() ~ "Une même étiquette")
```

## Thèmes

`gtsummary`{.pkg} fournit plusieurs fonctions préfixées `theme_gtsummary_*()` permettant de modifier l'affichage par défaut des tableaux.

La fonction `theme_gtsummary_journal`{data-pkg="gtsummary"} permets d'adopter les standards de certaines grandes revues scientifiques telles que *JAMA* (*Journal of the American Medical Association*), *The Lancet* ou encore le *NEJM* (*New England Journal of Medicine*).

Par défaut, `tbl_summarry`{data-pkg="gtsummary"} utilise la médiane et l'intervalle interquartile pour les variables continues. Si on applique `theme_gtsummary_mean_sd`{data-pkg="gtsummary"}, la moyenne et l'écart-type seront utilisés par défaut.

Le thème `theme_gtsummary_journal`{data-pkg="gtsummary"} permets de modifier la langue utilisée par défaut dans les tableaux. Les options `decimal.mark` et `big.mark` permettent de définir respectivement le séparateur de décimales et le séparateur des milliers. Ainsi, pour présenter un tableau en français, on appliquera en début de script :

```{r}
theme_gtsummary_language(language = "fr", decimal.mark = ",", big.mark = " ")
```

## Statistiques descriptives avec tbl_summary()

La fonction `tbl_summarry`{data-pkg="gtsummary"} permets de réaliser des tris à plats de plusieurs variables, éventuellement croisés selon une variable catégorielle.

On lui passe en entrée un tableaux de données (*data.frame*) et par défaut toutes les variables sont résumées.

```{r}
trial %>%
  tbl_summary()
```

### Sélection des variables (include)

La paramètre `include` permets de spécifier les variables à inclure dans le tableau (et leur ordre). On peut lui passer un vecteur de noms de variables, ou bien utiliser des sélecteurs *tidyselect* (utiliser `c()` si plusieurs sélecteurs).

```{r}
trial %>%
  tbl_summary(include = c("age", "marker", "response"))

trial %>%
  tbl_summary(include = c(age:stage, starts_with("t")))
```


### En fonction d'une seconde variable (by, add_overall)

Le paramètre `by` permets de résumer chacune des variables inclues en fonction d'une variable catégorielle.

```{r}
trial %>%
  tbl_summary(
    include = c(age, stage, response),
    by = trt
  )
```

La fonction `add_overall`{data-pkg="gtsummary"}, appliquée après `tbl_summarry`{data-pkg="gtsummary"}, permets, lorsqu'une variable `by` a été définie, de rajouter une colonne avec l'ensemble du fichier. L'option `last` permets de spécifier si l'on veut ajouter cette colonne à la droite du tableau et `col_label` permet de personnaliser le titre de la colonne (noter le recours aux `**` pour indiquer ce qui doit être affiché en gras et `{N}` qui sera remplacé par le nombre d'observations).

```{r}
trial %>%
  tbl_summary(
    include = c(age, stage, response),
    by = trt
  ) %>%
  add_overall(last = TRUE, col_label = "**Ensemble** (effectif total: {N})")
```

### Statistiques affichées (statistic, percent, sort)

Le paramètre `statistic` permets de sélectionner les statistiques à afficher pour chaque variable. On indiquera une chaîne de caractères dont les différentes statistiques seront indiquées entre accolades (`{}`).

Pour une **variable continue**, on pourra utiliser `{median}` pour la médiane, `{mean}` pour la moyenne, `{sd}` pour l'écart type, `{var}` pour la variance, `{min}` pour le minimum, `{max}` pour le maximum, ou encore `{p##}` (en remplacant `##` par un nombre entier entre 00 et 100) pour le percentile correspondant (par exemple `p25` et `p75` pour le premier et le troisième quartile). Utilisez `all_continous`{data-pkg="gtsummary"} pour sélectionner toutes les variables continues.

```{r}
trial %>%
  tbl_summary(
    include = c(age, marker),
    statistic = all_continuous() ~ "Moy. : {mean} [min-max : {min}-{max}]"
  )
```

Il est possible d'afficher des statistiques différentes pour chaque variable.

```{r}
trial %>%
  tbl_summary(
    include = c(age, marker),
    statistic = list(
      age ~ "Méd. : {median} [IQR: {p25}-{p75}]",
      marker ~ "Moy. : {mean} (ET : {sd})"
    )
  )
```

Pour les variables continues, il est également possible d'indiquer le nom d'une fonction personnalisée qui prends un vecteur et renvoie une valeur résumé. Par exemple, pour afficher la moyenne des carrés :

```{r}
moy_carres <- function(x) {
  mean(x^2, na.rm = TRUE)
}
trial %>%
  tbl_summary(
    include = marker,
    statistic = ~ "MC : {moy_carres}"
  )
```

Pour une **variable catégorielle**, les statistiques possibles sont `{n}` le nombre d'observations, `{N}` le nombre total d'observations, et `{p}` le pourcentage correspondant. Utilisez `all_categorical`{data-pkg="gtsummary"} pour sélectionner toutes les variables catégorielles.

```{r}
trial %>%
  tbl_summary(
    include = c(stage, response),
    statistic = all_categorical() ~ "{p} % ({n}/{N})"
  )
```

Il est possible, pour une variable catégorielle, de trier les modalités de la plus fréquente à la moins fréquente avec le paramètre `sort`.

```{r}
trial %>%
  tbl_summary(
    include = c(stage, response),
    sort = all_categorical() ~ "frequency"
  )
```

Lorsqu'une variable `by` est définie, on peut utiliser `percent` pour indiquer le type de pourcentages : en ligne avec `"row"`, en colonne avec `"column"` et `"cell"` pour les pourcentages totaux.

```{r}
trial %>%
  tbl_summary(
    include = c(stage, response),
    by = grade,
    statistic = all_categorical() ~ "{p} % ({n}/{N})",
    percent = "row"
  ) %>%
  add_overall(last = TRUE)
```

Pour toutes les variables (catégorielles et continues), les statistiques suivantes sont également disponibles : `{N_obs}` le nombre total d'observations, `{N_miss}` le nombre d'observations manquantes (`NA`), `{N_nonmiss}` le nombre d'observations non manquantes, `{p_miss}` le pourcentage d'observations manquantes (i.e. `N_miss / N_obs`) et `{p_nonmiss}` le pourcentage d'observations non manquantes (i.e. `N_nonmiss / N_obs`).

### Affichage du nom des statistiques (add_stat_label)

Lorsque l'on affiche de multiples statistiques, la liste des statistiques est regroupée dans une note de tableau qui peut vite devenir un peu confuse.

```{r}
tbl <- trial %>%
  tbl_summary(
    include = c(age, marker, grade),
    by = trt,
    statistic = list(
      age ~ "{median} [{p25}-{p75}]",
      marker ~ "{mean} ({sd})"
    )
  )
tbl
```

La fonction `add_stat_label`{data-pkg="gtsummary"} permets d'indiquer le type de statistique à côté du nom des variables ou bien dans une colonne dédiée, plutôt qu'en note de tableau.

```{r}
tbl %>% add_stat_label()
tbl %>% add_stat_label(location = "column")
```

### Forcer le type de variable (type, value)

Comme [abordé plus haut](#type_variables), `gtsummary`{.pkg} détermine automatiquement le type de chaque variable. Par défaut, la variabe `age` est traitée comme variable continue, `death` comme dichotomique (seule la valeur 1 est affichée) et `grade` comme variable catégorielle.

```{r}
trial %>%
  tbl_summary(
    include = c(grade, age, death)
    )
```

Il est cependant possible de forcer un certain type avec l'argument `type`. Précision, lorsque l'on force une variable en dichotomique, il faut indiquer avec `value` la valeur à afficher (les autres sont alors masquées).

```{r}
trial %>%
  tbl_summary(
    include = c(grade, age, death),
    type = list(
      grade ~ "dichotomous",
      age ~ "categorical",
      death ~ "categorical"
    ),
    value = grade ~ "III",
    label = grade ~ "Grade III"
  )
```


### Afficher des statistiques sur plusieurs lignes (continuous2)

Pour les variables continues, `gtsummary`{.pkg} a introduit un type de variable `"continuous2"`, qui doit être attribué manuellement via `type`, et qui permets d'afficher plusieurs lignes de statistiques (en indiquant plusieurs chaînes de caractères dans `statistic`). À noter le sélecteur dédié `all_continuous2`{data-pkg="gtsummary"}.

```{r}
trial %>%
  tbl_summary(
    include = c(age, marker, ttdeath),
    type = c(age, marker) ~ "continuous2",
    statistic = all_continuous2() ~ c("{median} ({p25} - {p75}", "{mean} ({sd})", "{min} - {max}")
  )
```

### Mise en forme des statistiques (digits)

L'argument `digits` permet de spécifier comment mettre en forme les différentes statistiques. Le plus simple est d'indiquer le nombre de décimales à afficher. Il est important de tenir compte que plusieurs statistiques peuvent être affichées pour une même variable. On peut alors indiquer une valeur différente pour chaque statistique.

```{r}
trial %>%
  tbl_summary(
    include = c(age, stage),
    by = trt,
    digits = list(
      all_continuous() ~ 1,
      all_categorical() ~ c(0, 1)
    )
  )
```

Au lieu d'un nombre de décimales, on peut indiquer plutôt une fonction à appliquer pour mettre en forme le résultat. Par exemple, `gtsummary`{.pkg} fournit les fonctions suivantes : `style_number`{data-pkg="gtsummary} pour les nombres de manière générale, `style_percent`{data-pkg="gtsummary} pour les pourcentages (les valeurs sont multipliées par 100, mais le symbole % n'est pas ajouté), `style_pvalue`{data-pkg="gtsummary} pour les p-valeurs, `style_sigfig`{data-pkg="gtsummary} qui n'affiche (par défaut) que deux chiffres significatifs, ou encore `style_ratio`{data-pkg="gtsummary} qui est une variante de `style_sigfig`{data-pkg="gtsummary} pour les ratios (comme les *odds ratios*) que l'on compare à 1.

Il faiut bien noter que ce qui est attendu par `digits`, c'est une fonction et non le résultat d'une fonction. On indiquera donc le nom de la fonction sans parenthèse.

```{r}
trial %>%
  tbl_summary(include = marker)

trial %>%
  tbl_summary(
    include = marker,
    digits = all_continuous() ~ c(style_percent, style_pvalue, style_ratio)
  )
```

Comme `digits` attends à recevoir une fonction (et non le résultat) d'une fonction, on ne peut pas passer directement des arguments aux fonctions `style_*()` de `gtsummary`{.pkg}. Pour cela il faut créer une fonction à la levée :

```{r}
trial %>%
  tbl_summary(
    include = marker,
    statistic = ~ "{mean} pour 100",
    digits = ~ function(x){style_percent(x, digits = 1)}
  )
```

À noter dans l'exemple précédent que les fonctions `style_*()` de `gtsummary`{.pkg} tiennent compte du thème défini (ici la virgule comme séparateur de décimale). 

Pour une mise en forme plus avancée des nombres, il faut se tourner vers l'extension `scales`{.pkg} (choir le [chapitre dédié](formater-nombres.html)). ATTENTION : les fonctions de `scales`{.pkg} n'héritent pas des paramètres du thème gtsummary actif. Il faut donc personnaliser le séparateur de décimal dans l'appel à la fonction.

```{r}
trial %>%
  tbl_summary(
    include = marker,
    statistic = ~ "{mean}",
    digits = ~ scales::label_number(accuracy = .01, suffix = " ng/mL", decimal.mark = ",")
  )
```

### Données manquantes (missing, missing_text)

Le paramètre `missing` permets d'indiquer s'il faut afficher le nombre d'observations manquantes (c'est-à-dire égales à `NA`) : `"ifany"` (valeur par défaut) affiche ce nombre seulement s'il y en a, `"no"` masque ce nombre et `"always"` force l'affichage de ce nombre même s'il n'y pas de valeur manquante. Le paramètre `missing_text` permets de personnaliser le texte affiché.

```{r}
trial %>%
  tbl_summary(include = c(trt, age))
trial %>%
  tbl_summary(
    include = c(trt, age),
    missing = "always",
    missing_text = "Nbre observations manquantes"
  )
```

Il est à noter, pour les variables catégorielles, que les valeurs manquantes ne sont jamais pris en compte pour le calcul des pourcentages. Pour les inclure dans le calcul, il faut les transformer en valeurs explicites, par exemple avec `fct_explicit_na`{data-pkg="forcats"} de `forcats`{.pkg}.

```{r}
trial %>%
  tbl_summary(include = response, type = response ~ "categorical")
trial %>%
  mutate(response = response %>% as.factor() %>% forcats::fct_explicit_na(na_level = "non observé")) %>%
  tbl_summary(include = response)
```

### Étiquettes des variables (label)

`gtsummary`, par défaut, prends en compte les étiquettes de variables, si elles existent, et sinon utilisera le nom de chaque variable dans le tableau. Pour rappel, les étiquettes de variables peuvent être manipulées avec l'extension `labelled`{.pkg} et les fonctions `var_label`{data-pkg="labelled"} et `set_variable_labels`{data-pkg="labelled"}.

Il est aussi possible d'utiliser l'option `label` de `tbl_summary`{data-pkg="gtsummary"} pour indiquer des étiquettes personnalisées.

```{r}
iris %>%
  labelled::set_variable_labels(
    Petal.Length = "Longueur du pétale",
    Petal.Width = "Largeur du pétale"
  ) %>%
  tbl_summary(label = Species ~ "Espèce")
```

Pour modifier les modalités d'une variable catégorielle, il faut modifier en amont les niveaux du facteur correspondant.

### Afficher les effectifs (add_n)

La fonction `add_n`{data-pkg="gtsummary"} permets d'ajouter une colonne avec le nombre d'observations (non manquantes par défaut). Plusieurs options permettent de personnaliser le résultat : `col_label` pour modifier l'intitulé de la colonne; `statistic` pour personnaliser la ou les statistiques affichées (la liste des statistiques disponibles est disponible dans le fichier d'aide `add_n.tbl_summary`{data-pkg="gtsummary"}); `last` pour la positition de la colonne; `footnote` pour l'ajout d'une note de tableau.


```{r}
trial %>%
  tbl_summary(include = c(age, marker)) %>%
  add_n()
trial %>%
  tbl_summary(
    include = c(age, marker),
    by = trt,
    missing = "no"
  ) %>%
  add_n(
    statistic = "{n}/{N}",
    col_label = "**Effectifs** (observés / total)",
    last = TRUE,
    footnote = TRUE
  ) %>%
  add_overall(last = TRUE)
```


### Mise en forme du tableau (bold_labels, italicize_levels)

Les fonctions `bold_labels`{data-pkg="gtsummary"}, `bold_levels`{data-pkg="gtsummary"}, `italicize_labels`{data-pkg="gtsummary"} et `italicize_levels`{data-pkg="gtsummary"} permettent d'afficher les étiquettes de variables et les modalités des variables catégorielles en gras ou en italique.

```{r}
trial %>%
  tbl_summary(
    include = c(marker, grade, stage),
    by = trt
  ) %>%
  bold_labels() %>%
  italicize_levels()
```

### Tests de comparaisons (add_p, separate_p_footnotes)

Lorsqu'une variable `by` est définie, la fonction `add_p`{data-pkg="gtsummary"} permets d'ajouter des tests de comparaisons entre les groupes et d'afficher les p-valeurs.

```{r}
trial %>%
  tbl_summary(
    include = c(trt, marker, age, response, stage),
    by = trt
  ) %>%
  add_p()
```

Par défaut, pour les **variables continues**, un <dfn>test de Kruskal-Wallis</dfn> calculé avec la fonction `kruskal.test`{data-pkg="stats"} est utilisé lorsqu'il y a trois groupes ou plus, et un <dfn>test de Wilcoxon-Mann-Whitney</dfn> calculé avec `wilcox.test`{data-pkg="stats"} (test de comparaison des rangs) lorsqu'il n'y a que deux groupes.

Si l'on affiche des moyennes, il serait plus juste d'utiliser un <dfn>test t de Student</dfn> (test de compairaison des moyennes) calculé avec `t.test`{data-pkg="stats"}.

Pour les **variables catégorielles**, un <dfn>test du Chi²</dfn> calculé avec `chisq.test`{data-pkg="stats"} est utilisé par défaut lorsque les effectifs théoriques sont supérieurs à 5, sinon un <dfn>test de Fosher</dfn> calculé avec `fisher.test`{data-pkg="stats"} est utilisé.

D'autres tests sont disponibles et sont détaillés dans le fichier d'aide `add_p.tbl_summary`{data-pkg="gtsummary"}. 

Le paramètre `test` permets de spécifier pour chaque variable le type de tests à utiliser. La fonction `separate_p_footnotes`{data-pkg="gtsummary"} peut être utilisée pour créer une note de tableau différente pour chaque test. Le paramètre `pvalue_fun` permet d'indiquer une fonction personnalisée pour la mise en forme des p-valeurs.

```{r}
trial %>%
  tbl_summary(
    include = c(trt, marker, age, response, stage),
    statistic = age ~ "{mean} ({sd})",
    by = trt
  ) %>%
  add_stat_label() %>%
  add_p(
    test = list(
      response ~ "fisher.test",
      age ~ "t.test"
    ),
    pvalue_fun = scales::label_pvalue(accuracy = .0001)
  ) %>%
  separate_p_footnotes()
```


### Intervalles de confiance (add_ci)

La fonction `add_ci`{data-pkg="gtsummary"} permets d'ajouter des intervalles de confiance dans des colonnes additionnelles. ATTENTION : par défaut, pour les variables continues, cela calcule les intervalles de confiance d'une moyenne et non d'une médiane. Le type d'intervalle peut être modifié avec `method` (par exemple `"wilcox.test"` pour l'intervalle de confiance d'une médiane). `statistic` permet de personnaliser la présentation de l'intervalle. `conf.level` permets de changer le niveau de confiance. `style_fun` permets de modifier la fonction de formatage des 


```{r}
trial %>%
  tbl_summary(
    include = c(age, stage),
    by = trt,
    statistic = all_continuous() ~ "{mean}"
  ) %>%
  add_overall() %>%
  add_ci()

trial %>%
  tbl_summary(
    include = c(age, marker), 
    statistic = ~ "{median}"
  ) %>%
  add_ci(
    method = ~ "wilcox.test",
    statistic = ~ "entre {conf.low} et {conf.high}",
    conf.level = .9,
    style_fun = ~ scales::label_number(accuracy = .01, decimal.mark = ",")
  )
```

### Différences entre groupes (add_difference)

Si la variable spécfiée dans `by` a exactement 2 niveaux, il est possible de calculer la différence entre deux moyennes (variable continue) ou entre deux proportions (variables dichotomiques uniquement, pas les variables catégorielles), d'afficher l'intervalle de confiance de cette différence et la p-valeur associée (la différence est-elle significativement différente de 0) avec `add_difference`{data-pkg="gtsummary"}.


```{r}
trial %>%
  tbl_summary(
    include = c(age, marker, response),
    by = trt,
    statistic = list(
      all_continuous() ~ "{mean}",
      all_categorical() ~ "{p}%"
    ),
    digits = list(
      all_continuous() ~ 2,
      all_categorical() ~ 1
    )
  ) %>%
  add_difference()
```

D'autres options sont disponibles (comme la possibilité de calculer des différences ajustées sur d'autres variables) et sont explicitées dans le fichier d'aide de `add_difference`{data-pkg="gtsummary"}.

## Tableau croisé avec tbl_cross()

La fonction `tbl_cross`{data-pkg="gtsummary"} est une variation de `tbl_summary`{data-pkg="gtsummary"} permettant de croiser deux variables spécfiées avec les arguments `row` et `col`. Le type de pourcentage peut-être précisé avec l'arguement `percent`. Il est possible d'ajouter le résultat d'un test du Chi² avec `add_p.tbl_cross`{data-pkg="gtsummary"}.

```{r}
trial %>%
  tbl_cross(
    row = grade,
    col = trt,
    percent = "row"
  ) %>%
  add_p(source_note = TRUE)
```


## Données pondérées et tbl_svysummary()

La fonction `tbl_svysummary`{data-pkg="gtsummary"} est similaire à `tbl_summary`{data-pkg="gtsummary"} à l'exception qu'elle prend en entrée un objet de type `survey`{.pkg} défini avec l'extension homonyme. Cela permet de définir une pondération des observations et un plan d'échantillonnage complexe. Les options de `tbl_svysummary`{data-pkg="gtsummary"} sont similaires et il est possible d'utiliser les autres fonctions de `gtsummary`{.pkg} telles que `add_overall`{data-pkg="gtsummary"}, `add_p`{data-pkg="gtsummary"}, `add_n`{data-pkg="gtsummary"}, `add_stat_label`{data-pkg="gtsummary"}, etc.

Il faut noter que les tests statistiques disponibles ne sont pas les mêmes et sont détaillés dans le fichier d'aide de `add_p.tbl_svysummary`{data-pkg="gtsummary"}.

```{r}
Titanic %>%
  as.data.frame() %>%
  survey::svydesign(~ 1, data = ., weights = ~Freq) %>%
  tbl_svysummary(
    by = Survived, 
    percent = "row"
  ) %>%
  add_stat_label(location = "column") %>%
  add_n() %>%
  add_overall(last = TRUE) %>%
  add_p() %>%
  separate_p_footnotes()
```

## Statistiques personnalisées avec tbl_continous() et tbl_custom_summary()

### tbl_continuous()



### tbl_custom_summary()

### add_stat()

## Résultats d'un modèle avec tbl_regression()

include et label générique

### Exponentiation des coefficients (exponentiate)

### Afficher des étoiles de signification (add_significance_stars)

### Variables dichotomiques sur une ligne (show_single_row)

### Afficher l'intercept (intercept)

### Mise en forme des coefficients (estimate_fun, pvalue_fun)

### Afficher les coefficients pour les références (add_estimate_to_reference_rows)

### P-valeurs globales (add_global_p)

### Ajouter les VIF (add_vif)

### Représenter graphiquement le modèle (plot)

### Afficher des statistiques globales du modèle (add_glance_table, add_glance_source_note)

## Régressions univariées multiples avec tbl_uvregression()

## Tables de survie avec tbl_survfit()

## Modifier un tableau

### Modifier les titres de colonne (modify_header)

### Afficher/Masquer une colonne (modify_column_hide, modify_column_unhide)

### Ajouter un titre global (modify_caption)

### Regrouper des colonnes (modify_spanning_header)

### Modifier les notes (modify_footnote)

## Combiner des tableaux

### tbl_stack()

### tbl_merge()

### tbl_strata()


### tbl_split()




## Exporter un tableau

![Formats d'export d'un tableau gtsummary](images/gtsummary_output_formats.png)

```{r, eval=FALSE}
tbl %>%
  as_gt() %>%
  gt::gtsave(filename = ".") # use extensions .html .tex .ltx .rtf

tbl %>%
  as_flex_table() %>%
  flextable::save_as_docx()
```



## Plus d'options avec bstfun

### tbl_likert()

### Ajouter un graphique de tendances (add_sparkline)

### Représentation graphique des coefficients dans le tableau (add_inline_forest_plot)

### Forest plot (as_forest_plot)
